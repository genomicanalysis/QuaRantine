<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 3 Packages and the ‘tidyverse’ | 40 Days and 40 Nights</title>
  <meta name="description" content="<p>An ad hoc course to learn R for bioinformatics, using the
COVID-19 epidemic as an excuse.</p>" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 3 Packages and the ‘tidyverse’ | 40 Days and 40 Nights" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="<p>An ad hoc course to learn R for bioinformatics, using the
COVID-19 epidemic as an excuse.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 3 Packages and the ‘tidyverse’ | 40 Days and 40 Nights" />
  
  <meta name="twitter:description" content="<p>An ad hoc course to learn R for bioinformatics, using the
COVID-19 epidemic as an excuse.</p>" />
  

<meta name="author" content="Martin Morgan" />
<meta name="author" content="L. Shawn Matott" />


<meta name="date" content="2020-04-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="two.html"/>
<link rel="next" href="four.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">QuaRantine</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Motivation</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect"><i class="fa fa-check"></i>What to expect</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="one.html"><a href="one.html"><i class="fa fa-check"></i><b>1</b> Basics</a><ul>
<li class="chapter" data-level="1.1" data-path="one.html"><a href="one.html#day-1-monday-zoom-orientation"><i class="fa fa-check"></i><b>1.1</b> Day 1 (Monday) Zoom orientation</a><ul>
<li class="chapter" data-level="1.1.1" data-path="one.html"><a href="one.html#logistics-10-minutes"><i class="fa fa-check"></i><b>1.1.1</b> Logistics (10 minutes)</a></li>
<li class="chapter" data-level="1.1.2" data-path="one.html"><a href="one.html#installing-r-and-rstudio-25-minutes-shawn"><i class="fa fa-check"></i><b>1.1.2</b> Installing <em>R</em> and <em>RStudio</em> (25 minutes, Shawn)</a></li>
<li class="chapter" data-level="1.1.3" data-path="one.html"><a href="one.html#basics-of-r-25-minutes"><i class="fa fa-check"></i><b>1.1.3</b> Basics of <em>R</em> (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="one.html"><a href="one.html#day-2-vectors-and-variables"><i class="fa fa-check"></i><b>1.2</b> Day 2: Vectors and variables</a></li>
<li class="chapter" data-level="1.3" data-path="one.html"><a href="one.html#day-3-factor-date-and-na"><i class="fa fa-check"></i><b>1.3</b> Day 3: <code>factor()</code>, <code>Date()</code>, and <code>NA</code></a></li>
<li class="chapter" data-level="1.4" data-path="one.html"><a href="one.html#day-4-working-with-variables"><i class="fa fa-check"></i><b>1.4</b> Day 4: Working with variables</a></li>
<li class="chapter" data-level="1.5" data-path="one.html"><a href="one.html#day-5-friday-zoom-check-in"><i class="fa fa-check"></i><b>1.5</b> Day 5 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="1.5.1" data-path="one.html"><a href="one.html#logistics"><i class="fa fa-check"></i><b>1.5.1</b> Logistics</a></li>
<li class="chapter" data-level="1.5.2" data-path="one.html"><a href="one.html#review-and-trouble-shoot-25-minutes-martin"><i class="fa fa-check"></i><b>1.5.2</b> Review and trouble shoot (25 minutes; Martin)</a></li>
<li class="chapter" data-level="1.5.3" data-path="one.html"><a href="one.html#weekend-activities-25-minutes-shawn"><i class="fa fa-check"></i><b>1.5.3</b> Weekend activities (25 minutes; Shawn)</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="one.html"><a href="one.html#day-6-r-scripts"><i class="fa fa-check"></i><b>1.6</b> Day 6: <em>R</em> scripts</a></li>
<li class="chapter" data-level="1.7" data-path="one.html"><a href="one.html#day-7-saving-data"><i class="fa fa-check"></i><b>1.7</b> Day 7: Saving data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="two.html"><a href="two.html"><i class="fa fa-check"></i><b>2</b> The data frame</a><ul>
<li class="chapter" data-level="2.1" data-path="two.html"><a href="two.html#day-8-monday-zoom-check-in"><i class="fa fa-check"></i><b>2.1</b> Day 8 (Monday) Zoom check-in</a><ul>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#logistics-1"><i class="fa fa-check"></i>Logistics</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#review-and-troubleshoot-15-minutes"><i class="fa fa-check"></i>Review and troubleshoot (15 minutes)</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#the-data-frame-40-minutes"><i class="fa fa-check"></i>The data frame (40 minutes)</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#this-weeks-activities-5-minutes"><i class="fa fa-check"></i>This week’s activities (5 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="two.html"><a href="two.html#day-9-creation-and-manipulation"><i class="fa fa-check"></i><b>2.2</b> Day 9: Creation and manipulation</a><ul>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#creation"><i class="fa fa-check"></i>Creation</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#column-selection"><i class="fa fa-check"></i>Column selection</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#adding-or-updating-columns"><i class="fa fa-check"></i>Adding or updating columns</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#reading-and-writing"><i class="fa fa-check"></i>Reading and writing</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#reading-from-a-remote-file"><i class="fa fa-check"></i>Reading from a remote file (!)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="two.html"><a href="two.html#day-10-subset-with-and-within"><i class="fa fa-check"></i><b>2.3</b> Day 10: <code>subset()</code>, <code>with()</code>, and <code>within()</code></a><ul>
<li><a href="two.html#subset"><code>subset()</code></a></li>
<li><a href="two.html#with"><code>with()</code></a></li>
<li><a href="two.html#within"><code>within()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="two.html"><a href="two.html#day-11-aggregate-and-an-initial-work-flow"><i class="fa fa-check"></i><b>2.4</b> Day 11: <code>aggregate()</code> and an initial work flow</a><ul>
<li><a href="two.html#aggregate-for-summarizing-columns-by-group"><code>aggregate()</code> for summarizing columns by group</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#an-initial-work-flow"><i class="fa fa-check"></i>An initial work flow</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="two.html"><a href="two.html#day-12-friday-zoom-check-in"><i class="fa fa-check"></i><b>2.5</b> Day 12 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#review-and-troubleshoot-20-minutes"><i class="fa fa-check"></i>Review and troubleshoot (20 minutes)</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#user-defined-functions"><i class="fa fa-check"></i>User-defined functions</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#plotting-data"><i class="fa fa-check"></i>Plotting data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="two.html"><a href="two.html#day-13-basic-visualization"><i class="fa fa-check"></i><b>2.6</b> Day 13: Basic visualization</a></li>
<li class="chapter" data-level="2.7" data-path="two.html"><a href="two.html#day-14-functions"><i class="fa fa-check"></i><b>2.7</b> Day 14: Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="three.html"><a href="three.html"><i class="fa fa-check"></i><b>3</b> Packages and the ‘tidyverse’</a><ul>
<li class="chapter" data-level="3.1" data-path="three.html"><a href="three.html#day-15-monday-zoom-check-in"><i class="fa fa-check"></i><b>3.1</b> Day 15 (Monday) Zoom check-in</a><ul>
<li><a href="three.html#cran"><span>CRAN</span></a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#installing-and-attaching-packages"><i class="fa fa-check"></i>Installing and attaching packages</a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#the-tidyverse-of-packages"><i class="fa fa-check"></i>The ‘tidyverse’ of packages</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="three.html"><a href="three.html#day-16-key-tidyverse-packages-readr-and-dplyr"><i class="fa fa-check"></i><b>3.2</b> Day 16 Key tidyverse packages: <span>readr</span> and <span>dplyr</span></a></li>
<li class="chapter" data-level="3.3" data-path="three.html"><a href="three.html#day-17-visualization-with-ggplot2"><i class="fa fa-check"></i><b>3.3</b> Day 17 Visualization with <span>ggplot2</span></a></li>
<li class="chapter" data-level="3.4" data-path="three.html"><a href="three.html#day-18-worldwide-covid-data"><i class="fa fa-check"></i><b>3.4</b> Day 18 Worldwide COVID data</a></li>
<li class="chapter" data-level="3.5" data-path="three.html"><a href="three.html#day-19-friday-zoom-check-in"><i class="fa fa-check"></i><b>3.5</b> Day 19 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="3.5.1" data-path="three.html"><a href="three.html#review-and-trouble-shoot-25-minutes"><i class="fa fa-check"></i><b>3.5.1</b> Review and trouble shoot (25 minutes)</a></li>
<li class="chapter" data-level="3.5.2" data-path="three.html"><a href="three.html#next-week-25-minutes"><i class="fa fa-check"></i><b>3.5.2</b> Next week (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="three.html"><a href="three.html#day-20-exploring-the-course-of-pandemic-in-different-regions"><i class="fa fa-check"></i><b>3.6</b> Day 20 Exploring the course of pandemic in different regions</a></li>
<li class="chapter" data-level="3.7" data-path="three.html"><a href="three.html#day-21"><i class="fa fa-check"></i><b>3.7</b> Day 21</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="four.html"><a href="four.html"><i class="fa fa-check"></i><b>4</b> Machine learning</a><ul>
<li class="chapter" data-level="4.1" data-path="four.html"><a href="four.html#day-22-monday-zoom-check-in"><i class="fa fa-check"></i><b>4.1</b> Day 22 (Monday) Zoom check-in</a></li>
<li class="chapter" data-level="4.2" data-path="four.html"><a href="four.html#day-23"><i class="fa fa-check"></i><b>4.2</b> Day 23</a></li>
<li class="chapter" data-level="4.3" data-path="four.html"><a href="four.html#day-24"><i class="fa fa-check"></i><b>4.3</b> Day 24</a></li>
<li class="chapter" data-level="4.4" data-path="four.html"><a href="four.html#day-25"><i class="fa fa-check"></i><b>4.4</b> Day 25</a></li>
<li class="chapter" data-level="4.5" data-path="four.html"><a href="four.html#day-26-friday-zoom-check-in"><i class="fa fa-check"></i><b>4.5</b> Day 26 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="4.5.1" data-path="four.html"><a href="four.html#review-and-trouble-shoot-25-minutes-1"><i class="fa fa-check"></i><b>4.5.1</b> Review and trouble shoot (25 minutes)</a></li>
<li class="chapter" data-level="4.5.2" data-path="four.html"><a href="four.html#next-week-25-minutes-1"><i class="fa fa-check"></i><b>4.5.2</b> Next week (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="four.html"><a href="four.html#day-27"><i class="fa fa-check"></i><b>4.6</b> Day 27</a></li>
<li class="chapter" data-level="4.7" data-path="four.html"><a href="four.html#day-28"><i class="fa fa-check"></i><b>4.7</b> Day 28</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="five.html"><a href="five.html"><i class="fa fa-check"></i><b>5</b> Bioinformatics with <span>Bioconductor</span></a><ul>
<li class="chapter" data-level="5.1" data-path="five.html"><a href="five.html#day-29-monday-zoom-check-in"><i class="fa fa-check"></i><b>5.1</b> Day 29 (Monday) Zoom check-in</a></li>
<li class="chapter" data-level="5.2" data-path="five.html"><a href="five.html#day-30"><i class="fa fa-check"></i><b>5.2</b> Day 30</a></li>
<li class="chapter" data-level="5.3" data-path="five.html"><a href="five.html#day-31"><i class="fa fa-check"></i><b>5.3</b> Day 31</a></li>
<li class="chapter" data-level="5.4" data-path="five.html"><a href="five.html#day-32"><i class="fa fa-check"></i><b>5.4</b> Day 32</a></li>
<li class="chapter" data-level="5.5" data-path="five.html"><a href="five.html#day-33-friday-zoom-check-in"><i class="fa fa-check"></i><b>5.5</b> Day 33 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="5.5.1" data-path="five.html"><a href="five.html#review-and-trouble-shoot-25-minutes-2"><i class="fa fa-check"></i><b>5.5.1</b> Review and trouble shoot (25 minutes)</a></li>
<li class="chapter" data-level="5.5.2" data-path="five.html"><a href="five.html#next-week-25-minutes-2"><i class="fa fa-check"></i><b>5.5.2</b> Next week (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="five.html"><a href="five.html#day-34"><i class="fa fa-check"></i><b>5.6</b> Day 34</a></li>
<li class="chapter" data-level="5.7" data-path="five.html"><a href="five.html#day-35"><i class="fa fa-check"></i><b>5.7</b> Day 35</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="six.html"><a href="six.html"><i class="fa fa-check"></i><b>6</b> Collaboration</a><ul>
<li class="chapter" data-level="6.1" data-path="six.html"><a href="six.html#days-monday-zoom-check-in"><i class="fa fa-check"></i><b>6.1</b> 5 Days (Monday) Zoom check-in</a></li>
<li class="chapter" data-level="6.2" data-path="six.html"><a href="six.html#days"><i class="fa fa-check"></i><b>6.2</b> 4 Days</a></li>
<li class="chapter" data-level="6.3" data-path="six.html"><a href="six.html#days-1"><i class="fa fa-check"></i><b>6.3</b> 3 Days</a></li>
<li class="chapter" data-level="6.4" data-path="six.html"><a href="six.html#days-2"><i class="fa fa-check"></i><b>6.4</b> 2 Days</a></li>
<li class="chapter" data-level="6.5" data-path="six.html"><a href="six.html#today-friday-zoom-check-in"><i class="fa fa-check"></i><b>6.5</b> Today! (Friday) Zoom check-in</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="frequently-asked-questions.html"><a href="frequently-asked-questions.html"><i class="fa fa-check"></i>Frequently asked questions</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">40 Days and 40 Nights</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="three" class="section level1">
<h1><span class="header-section-number">Week 3</span> Packages and the ‘tidyverse’</h1>
<div id="day-15-monday-zoom-check-in" class="section level2">
<h2><span class="header-section-number">3.1</span> Day 15 (Monday) Zoom check-in</h2>
<div id="cran" class="section level3 unnumbered">
<h3><a href="https://cran.r-project.org">CRAN</a></h3>
</div>
<div id="installing-and-attaching-packages" class="section level3 unnumbered">
<h3>Installing and attaching packages</h3>
</div>
<div id="the-tidyverse-of-packages" class="section level3 unnumbered">
<h3>The ‘tidyverse’ of packages</h3>
<p><a href="https://cran.r-project.org/package=readr">readr</a> for fast data input</p>
<ul>
<li><p>The <code>tibble</code>: a nicer <code>data.frame</code></p></li>
<li><p>Example: US COVID data. N.B., <code>readr::read_csv()</code> rather than <code>read.csv()</code></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb208-2" title="2"></a>
<a class="sourceLine" id="cb208-3" title="3">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb208-4" title="4">us &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url)</a>
<a class="sourceLine" id="cb208-5" title="5"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb208-6" title="6"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb208-7" title="7"><span class="co">##   date = col_date(format = &quot;&quot;),</span></a>
<a class="sourceLine" id="cb208-8" title="8"><span class="co">##   county = col_character(),</span></a>
<a class="sourceLine" id="cb208-9" title="9"><span class="co">##   state = col_character(),</span></a>
<a class="sourceLine" id="cb208-10" title="10"><span class="co">##   fips = col_character(),</span></a>
<a class="sourceLine" id="cb208-11" title="11"><span class="co">##   cases = col_double(),</span></a>
<a class="sourceLine" id="cb208-12" title="12"><span class="co">##   deaths = col_double()</span></a>
<a class="sourceLine" id="cb208-13" title="13"><span class="co">## )</span></a>
<a class="sourceLine" id="cb208-14" title="14">us</a>
<a class="sourceLine" id="cb208-15" title="15"><span class="co">## # A tibble: 84,143 x 6</span></a>
<a class="sourceLine" id="cb208-16" title="16"><span class="co">##    date       county      state      fips  cases deaths</span></a>
<a class="sourceLine" id="cb208-17" title="17"><span class="co">##    &lt;date&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb208-18" title="18"><span class="co">##  1 2020-01-21 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb208-19" title="19"><span class="co">##  2 2020-01-22 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb208-20" title="20"><span class="co">##  3 2020-01-23 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb208-21" title="21"><span class="co">##  4 2020-01-24 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb208-22" title="22"><span class="co">##  5 2020-01-24 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb208-23" title="23"><span class="co">##  6 2020-01-25 Orange      California 06059     1      0</span></a>
<a class="sourceLine" id="cb208-24" title="24"><span class="co">##  7 2020-01-25 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb208-25" title="25"><span class="co">##  8 2020-01-25 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb208-26" title="26"><span class="co">##  9 2020-01-26 Maricopa    Arizona    04013     1      0</span></a>
<a class="sourceLine" id="cb208-27" title="27"><span class="co">## 10 2020-01-26 Los Angeles California 06037     1      0</span></a>
<a class="sourceLine" id="cb208-28" title="28"><span class="co">## # ... with 84,133 more rows</span></a></code></pre></div></li>
<li><p>Note that</p>
<ul>
<li><code>date</code> has been deduced correctly</li>
<li><code>read_csv()</code> does not coerce inputs to <code>factor</code> (no need to use <code>stringsAsFactors = FALSE</code>)</li>
<li>The tibble displays nicely (first ten lines, with an indication of total lines)</li>
</ul></li>
</ul>
<p><a href="https://cran.r-project.org/package=dplyr">dplyr</a> for data manipulation</p>
<ul>
<li><p>load</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb209-2" title="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb209-3" title="3"><span class="co">## Attaching package: &#39;dplyr&#39;</span></a>
<a class="sourceLine" id="cb209-4" title="4"><span class="co">## The following objects are masked from &#39;package:stats&#39;:</span></a>
<a class="sourceLine" id="cb209-5" title="5"><span class="co">## </span></a>
<a class="sourceLine" id="cb209-6" title="6"><span class="co">##     filter, lag</span></a>
<a class="sourceLine" id="cb209-7" title="7"><span class="co">## The following objects are masked from &#39;package:base&#39;:</span></a>
<a class="sourceLine" id="cb209-8" title="8"><span class="co">## </span></a>
<a class="sourceLine" id="cb209-9" title="9"><span class="co">##     intersect, setdiff, setequal, union</span></a></code></pre></div></li>
<li><p>The pipe, <code>%&gt;%</code></p></li>
<li><p>Verbs for data transformation</p>
<ul>
<li>A small set of functions that allow very rich data transformation</li>
<li>All have the same first argument – the <code>tibble</code> to be transformed</li>
<li>All allow ‘non-standard’ evaluation – use the variable name without quotes <code>"</code>.</li>
</ul></li>
<li><p><code>filter()</code> rows that meet specific criteria</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-2" title="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb210-3" title="3"><span class="co">## # A tibble: 40 x 6</span></a>
<a class="sourceLine" id="cb210-4" title="4"><span class="co">##    date       county state    fips  cases deaths</span></a>
<a class="sourceLine" id="cb210-5" title="5"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb210-6" title="6"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0</span></a>
<a class="sourceLine" id="cb210-7" title="7"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0</span></a>
<a class="sourceLine" id="cb210-8" title="8"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb210-9" title="9"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb210-10" title="10"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0</span></a>
<a class="sourceLine" id="cb210-11" title="11"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0</span></a>
<a class="sourceLine" id="cb210-12" title="12"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0</span></a>
<a class="sourceLine" id="cb210-13" title="13"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0</span></a>
<a class="sourceLine" id="cb210-14" title="14"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0</span></a>
<a class="sourceLine" id="cb210-15" title="15"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0</span></a>
<a class="sourceLine" id="cb210-16" title="16"><span class="co">## # ... with 30 more rows</span></a></code></pre></div></li>
<li><p><code>select()</code> specific columns</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb211-2" title="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb211-3" title="3"><span class="st">    </span><span class="kw">select</span>(state, county, date, cases)</a>
<a class="sourceLine" id="cb211-4" title="4"><span class="co">## # A tibble: 40 x 4</span></a>
<a class="sourceLine" id="cb211-5" title="5"><span class="co">##    state    county date       cases</span></a>
<a class="sourceLine" id="cb211-6" title="6"><span class="co">##    &lt;chr&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb211-7" title="7"><span class="co">##  1 New York Erie   2020-03-15     3</span></a>
<a class="sourceLine" id="cb211-8" title="8"><span class="co">##  2 New York Erie   2020-03-16     6</span></a>
<a class="sourceLine" id="cb211-9" title="9"><span class="co">##  3 New York Erie   2020-03-17     7</span></a>
<a class="sourceLine" id="cb211-10" title="10"><span class="co">##  4 New York Erie   2020-03-18     7</span></a>
<a class="sourceLine" id="cb211-11" title="11"><span class="co">##  5 New York Erie   2020-03-19    28</span></a>
<a class="sourceLine" id="cb211-12" title="12"><span class="co">##  6 New York Erie   2020-03-20    31</span></a>
<a class="sourceLine" id="cb211-13" title="13"><span class="co">##  7 New York Erie   2020-03-21    38</span></a>
<a class="sourceLine" id="cb211-14" title="14"><span class="co">##  8 New York Erie   2020-03-22    54</span></a>
<a class="sourceLine" id="cb211-15" title="15"><span class="co">##  9 New York Erie   2020-03-23    87</span></a>
<a class="sourceLine" id="cb211-16" title="16"><span class="co">## 10 New York Erie   2020-03-24   107</span></a>
<a class="sourceLine" id="cb211-17" title="17"><span class="co">## # ... with 30 more rows</span></a></code></pre></div></li>
<li><p>Other common verbs (see tomorrow’s quarantine)</p></li>
<li><p><code>mutate()</code> (add or update) columns</p></li>
<li><p><code>summarize()</code> one or more columns</p></li>
<li><p><code>group_by()</code> one or more variables when performing computations. <code>ungroup()</code> removes the grouping.</p></li>
<li><p><code>arrange()</code> rows based on values in particular column(s); <code>desc()</code> in descending order.</p></li>
<li><p><code>count()</code> the number of times values occur</p></li>
</ul>
</div>
</div>
<div id="day-16-key-tidyverse-packages-readr-and-dplyr" class="section level2">
<h2><span class="header-section-number">3.2</span> Day 16 Key tidyverse packages: <a href="https://cran.r-project.org/package=readr">readr</a> and <a href="https://cran.r-project.org/package=dplyr">dplyr</a></h2>
<p>Start a script for today. In the script</p>
<ul>
<li><p>Load the libraries that we will use</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb212-2" title="2"><span class="kw">library</span>(dplyr)</a></code></pre></div></li>
<li><p>If <em>R</em> responds with (similarly for <a href="https://cran.r-project.org/package=dplyr">dplyr</a>)</p>
<pre><code>Error in library(readr) : there is no package called &#39;readr&#39;</code></pre>
<p>then you’ll need to install (just once per <em>R</em> installation) the <a href="https://cran.r-project.org/package=readr">readr</a> pacakge</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;readr&quot;</span>, <span class="dt">repos =</span> <span class="st">&quot;https://cran.r-project.org&quot;</span>)</a></code></pre></div></li>
</ul>
<p>Work through the following commands, adding appropriate lines to your script</p>
<ul>
<li><p>Read US COVID data. N.B., <code>readr::read_csv()</code> rather than <code>read.csv()</code></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" title="1">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb215-2" title="2">us &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url)</a>
<a class="sourceLine" id="cb215-3" title="3"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb215-4" title="4"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb215-5" title="5"><span class="co">##   date = col_date(format = &quot;&quot;),</span></a>
<a class="sourceLine" id="cb215-6" title="6"><span class="co">##   county = col_character(),</span></a>
<a class="sourceLine" id="cb215-7" title="7"><span class="co">##   state = col_character(),</span></a>
<a class="sourceLine" id="cb215-8" title="8"><span class="co">##   fips = col_character(),</span></a>
<a class="sourceLine" id="cb215-9" title="9"><span class="co">##   cases = col_double(),</span></a>
<a class="sourceLine" id="cb215-10" title="10"><span class="co">##   deaths = col_double()</span></a>
<a class="sourceLine" id="cb215-11" title="11"><span class="co">## )</span></a>
<a class="sourceLine" id="cb215-12" title="12">us</a>
<a class="sourceLine" id="cb215-13" title="13"><span class="co">## # A tibble: 84,143 x 6</span></a>
<a class="sourceLine" id="cb215-14" title="14"><span class="co">##    date       county      state      fips  cases deaths</span></a>
<a class="sourceLine" id="cb215-15" title="15"><span class="co">##    &lt;date&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb215-16" title="16"><span class="co">##  1 2020-01-21 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb215-17" title="17"><span class="co">##  2 2020-01-22 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb215-18" title="18"><span class="co">##  3 2020-01-23 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb215-19" title="19"><span class="co">##  4 2020-01-24 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb215-20" title="20"><span class="co">##  5 2020-01-24 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb215-21" title="21"><span class="co">##  6 2020-01-25 Orange      California 06059     1      0</span></a>
<a class="sourceLine" id="cb215-22" title="22"><span class="co">##  7 2020-01-25 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb215-23" title="23"><span class="co">##  8 2020-01-25 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb215-24" title="24"><span class="co">##  9 2020-01-26 Maricopa    Arizona    04013     1      0</span></a>
<a class="sourceLine" id="cb215-25" title="25"><span class="co">## 10 2020-01-26 Los Angeles California 06037     1      0</span></a>
<a class="sourceLine" id="cb215-26" title="26"><span class="co">## # ... with 84,133 more rows</span></a></code></pre></div></li>
<li><p><code>filter()</code> rows that meet specific criteria</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-2" title="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb216-3" title="3"><span class="co">## # A tibble: 40 x 6</span></a>
<a class="sourceLine" id="cb216-4" title="4"><span class="co">##    date       county state    fips  cases deaths</span></a>
<a class="sourceLine" id="cb216-5" title="5"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb216-6" title="6"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0</span></a>
<a class="sourceLine" id="cb216-7" title="7"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0</span></a>
<a class="sourceLine" id="cb216-8" title="8"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb216-9" title="9"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb216-10" title="10"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0</span></a>
<a class="sourceLine" id="cb216-11" title="11"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0</span></a>
<a class="sourceLine" id="cb216-12" title="12"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0</span></a>
<a class="sourceLine" id="cb216-13" title="13"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0</span></a>
<a class="sourceLine" id="cb216-14" title="14"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0</span></a>
<a class="sourceLine" id="cb216-15" title="15"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0</span></a>
<a class="sourceLine" id="cb216-16" title="16"><span class="co">## # ... with 30 more rows</span></a></code></pre></div></li>
<li><p><code>select()</code> specific columns</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" title="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb217-2" title="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb217-3" title="3"><span class="st">    </span><span class="kw">select</span>(state, county, date, cases)</a>
<a class="sourceLine" id="cb217-4" title="4"><span class="co">## # A tibble: 40 x 4</span></a>
<a class="sourceLine" id="cb217-5" title="5"><span class="co">##    state    county date       cases</span></a>
<a class="sourceLine" id="cb217-6" title="6"><span class="co">##    &lt;chr&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb217-7" title="7"><span class="co">##  1 New York Erie   2020-03-15     3</span></a>
<a class="sourceLine" id="cb217-8" title="8"><span class="co">##  2 New York Erie   2020-03-16     6</span></a>
<a class="sourceLine" id="cb217-9" title="9"><span class="co">##  3 New York Erie   2020-03-17     7</span></a>
<a class="sourceLine" id="cb217-10" title="10"><span class="co">##  4 New York Erie   2020-03-18     7</span></a>
<a class="sourceLine" id="cb217-11" title="11"><span class="co">##  5 New York Erie   2020-03-19    28</span></a>
<a class="sourceLine" id="cb217-12" title="12"><span class="co">##  6 New York Erie   2020-03-20    31</span></a>
<a class="sourceLine" id="cb217-13" title="13"><span class="co">##  7 New York Erie   2020-03-21    38</span></a>
<a class="sourceLine" id="cb217-14" title="14"><span class="co">##  8 New York Erie   2020-03-22    54</span></a>
<a class="sourceLine" id="cb217-15" title="15"><span class="co">##  9 New York Erie   2020-03-23    87</span></a>
<a class="sourceLine" id="cb217-16" title="16"><span class="co">## 10 New York Erie   2020-03-24   107</span></a>
<a class="sourceLine" id="cb217-17" title="17"><span class="co">## # ... with 30 more rows</span></a></code></pre></div></li>
<li><p><code>mutate()</code> (add or update) columns</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1">erie &lt;-</a>
<a class="sourceLine" id="cb218-2" title="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-3" title="3"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb218-4" title="4">erie <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-5" title="5"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases)))</a>
<a class="sourceLine" id="cb218-6" title="6"><span class="co">## # A tibble: 40 x 7</span></a>
<a class="sourceLine" id="cb218-7" title="7"><span class="co">##    date       county state    fips  cases deaths new_cases</span></a>
<a class="sourceLine" id="cb218-8" title="8"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb218-9" title="9"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0         3</span></a>
<a class="sourceLine" id="cb218-10" title="10"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0         3</span></a>
<a class="sourceLine" id="cb218-11" title="11"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0         1</span></a>
<a class="sourceLine" id="cb218-12" title="12"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0         0</span></a>
<a class="sourceLine" id="cb218-13" title="13"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0        21</span></a>
<a class="sourceLine" id="cb218-14" title="14"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0         3</span></a>
<a class="sourceLine" id="cb218-15" title="15"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0         7</span></a>
<a class="sourceLine" id="cb218-16" title="16"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0        16</span></a>
<a class="sourceLine" id="cb218-17" title="17"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0        33</span></a>
<a class="sourceLine" id="cb218-18" title="18"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0        20</span></a>
<a class="sourceLine" id="cb218-19" title="19"><span class="co">## # ... with 30 more rows</span></a></code></pre></div></li>
<li><p><code>summarize()</code> one or more columns</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" title="1">erie <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb219-2" title="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb219-3" title="3"><span class="st">    </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb219-4" title="4">        <span class="dt">duration =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb219-5" title="5">        <span class="dt">total_cases =</span> <span class="kw">max</span>(cases),</a>
<a class="sourceLine" id="cb219-6" title="6">        <span class="dt">max_new_cases_per_day =</span> <span class="kw">max</span>(new_cases),</a>
<a class="sourceLine" id="cb219-7" title="7">        <span class="dt">mean_new_cases_per_day =</span> <span class="kw">mean</span>(new_cases),</a>
<a class="sourceLine" id="cb219-8" title="8">        <span class="dt">median_new_cases_per_day =</span> <span class="kw">median</span>(new_cases)</a>
<a class="sourceLine" id="cb219-9" title="9">    )</a>
<a class="sourceLine" id="cb219-10" title="10"><span class="co">## # A tibble: 1 x 5</span></a>
<a class="sourceLine" id="cb219-11" title="11"><span class="co">##   duration total_cases max_new_cases_per~ mean_new_cases_per~ median_new_cases_~</span></a>
<a class="sourceLine" id="cb219-12" title="12"><span class="co">##      &lt;int&gt;       &lt;dbl&gt;              &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb219-13" title="13"><span class="co">## 1       40        2450                217                61.2                 50</span></a></code></pre></div></li>
<li><p><code>group_by()</code> one or more variables when performing computations</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1">us_county_cases &lt;-</a>
<a class="sourceLine" id="cb220-2" title="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-3" title="3"><span class="st">    </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-4" title="4"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_cases =</span> <span class="kw">max</span>(cases))</a>
<a class="sourceLine" id="cb220-5" title="5"></a>
<a class="sourceLine" id="cb220-6" title="6">us_state_cases &lt;-</a>
<a class="sourceLine" id="cb220-7" title="7"><span class="st">    </span>us_county_cases <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-8" title="8"><span class="st">    </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-9" title="9"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases))</a></code></pre></div></li>
<li><p><code>arrange()</code> based on a particular column; <code>desc()</code> in descending order.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1">us_county_cases <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-2" title="2"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_cases))</a>
<a class="sourceLine" id="cb221-3" title="3"><span class="co">## # A tibble: 2,836 x 3</span></a>
<a class="sourceLine" id="cb221-4" title="4"><span class="co">## # Groups:   county [1,665]</span></a>
<a class="sourceLine" id="cb221-5" title="5"><span class="co">##    county        state      total_cases</span></a>
<a class="sourceLine" id="cb221-6" title="6"><span class="co">##    &lt;chr&gt;         &lt;chr&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb221-7" title="7"><span class="co">##  1 New York City New York        145855</span></a>
<a class="sourceLine" id="cb221-8" title="8"><span class="co">##  2 Nassau        New York         32124</span></a>
<a class="sourceLine" id="cb221-9" title="9"><span class="co">##  3 Suffolk       New York         29567</span></a>
<a class="sourceLine" id="cb221-10" title="10"><span class="co">##  4 Westchester   New York         25959</span></a>
<a class="sourceLine" id="cb221-11" title="11"><span class="co">##  5 Cook          Illinois         25811</span></a>
<a class="sourceLine" id="cb221-12" title="12"><span class="co">##  6 Los Angeles   California       17508</span></a>
<a class="sourceLine" id="cb221-13" title="13"><span class="co">##  7 Wayne         Michigan         14994</span></a>
<a class="sourceLine" id="cb221-14" title="14"><span class="co">##  8 Bergen        New Jersey       14049</span></a>
<a class="sourceLine" id="cb221-15" title="15"><span class="co">##  9 Hudson        New Jersey       12645</span></a>
<a class="sourceLine" id="cb221-16" title="16"><span class="co">## 10 Essex         New Jersey       11811</span></a>
<a class="sourceLine" id="cb221-17" title="17"><span class="co">## # ... with 2,826 more rows</span></a>
<a class="sourceLine" id="cb221-18" title="18"></a>
<a class="sourceLine" id="cb221-19" title="19">us_state_cases <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-20" title="20"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_cases))</a>
<a class="sourceLine" id="cb221-21" title="21"><span class="co">## # A tibble: 55 x 2</span></a>
<a class="sourceLine" id="cb221-22" title="22"><span class="co">##    state         total_cases</span></a>
<a class="sourceLine" id="cb221-23" title="23"><span class="co">##    &lt;chr&gt;               &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb221-24" title="24"><span class="co">##  1 New York           265557</span></a>
<a class="sourceLine" id="cb221-25" title="25"><span class="co">##  2 New Jersey         103747</span></a>
<a class="sourceLine" id="cb221-26" title="26"><span class="co">##  3 Massachusetts       46215</span></a>
<a class="sourceLine" id="cb221-27" title="27"><span class="co">##  4 California          39540</span></a>
<a class="sourceLine" id="cb221-28" title="28"><span class="co">##  5 Pennsylvania        38350</span></a>
<a class="sourceLine" id="cb221-29" title="29"><span class="co">##  6 Illinois            36958</span></a>
<a class="sourceLine" id="cb221-30" title="30"><span class="co">##  7 Michigan            35262</span></a>
<a class="sourceLine" id="cb221-31" title="31"><span class="co">##  8 Florida             29656</span></a>
<a class="sourceLine" id="cb221-32" title="32"><span class="co">##  9 Louisiana           25744</span></a>
<a class="sourceLine" id="cb221-33" title="33"><span class="co">## 10 Connecticut         23115</span></a>
<a class="sourceLine" id="cb221-34" title="34"><span class="co">## # ... with 45 more rows</span></a></code></pre></div></li>
<li><p><code>count()</code> the number of times values occur (duration of the pandemic?)</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-2" title="2"><span class="st">    </span><span class="kw">count</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-3" title="3"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a>
<a class="sourceLine" id="cb222-4" title="4"><span class="co">## # A tibble: 2,836 x 3</span></a>
<a class="sourceLine" id="cb222-5" title="5"><span class="co">##    county        state             n</span></a>
<a class="sourceLine" id="cb222-6" title="6"><span class="co">##    &lt;chr&gt;         &lt;chr&gt;         &lt;int&gt;</span></a>
<a class="sourceLine" id="cb222-7" title="7"><span class="co">##  1 Snohomish     Washington       94</span></a>
<a class="sourceLine" id="cb222-8" title="8"><span class="co">##  2 Cook          Illinois         91</span></a>
<a class="sourceLine" id="cb222-9" title="9"><span class="co">##  3 Orange        California       90</span></a>
<a class="sourceLine" id="cb222-10" title="10"><span class="co">##  4 Los Angeles   California       89</span></a>
<a class="sourceLine" id="cb222-11" title="11"><span class="co">##  5 Maricopa      Arizona          89</span></a>
<a class="sourceLine" id="cb222-12" title="12"><span class="co">##  6 Santa Clara   California       84</span></a>
<a class="sourceLine" id="cb222-13" title="13"><span class="co">##  7 Suffolk       Massachusetts    83</span></a>
<a class="sourceLine" id="cb222-14" title="14"><span class="co">##  8 San Francisco California       82</span></a>
<a class="sourceLine" id="cb222-15" title="15"><span class="co">##  9 Dane          Wisconsin        79</span></a>
<a class="sourceLine" id="cb222-16" title="16"><span class="co">## 10 San Diego     California       74</span></a>
<a class="sourceLine" id="cb222-17" title="17"><span class="co">## # ... with 2,826 more rows</span></a></code></pre></div></li>
</ul>
</div>
<div id="day-17-visualization-with-ggplot2" class="section level2">
<h2><span class="header-section-number">3.3</span> Day 17 Visualization with <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a></h2>
</div>
<div id="day-18-worldwide-covid-data" class="section level2">
<h2><span class="header-section-number">3.4</span> Day 18 Worldwide COVID data</h2>
<p>Setup</p>
<ul>
<li><p>Start a new script and load the packages we’ll use</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb223-2" title="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb223-3" title="3"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb223-4" title="4"><span class="kw">library</span>(tidyr)     <span class="co"># specialized functions for transforming tibbles</span></a></code></pre></div>
<p>These packages should have been installed during previous quarantines.</p></li>
</ul>
<p>Source</p>
<ul>
<li><p>CSSE at Johns Hopkins University, available on github</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">hopkins =<span class="st"> &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;</span></a>
<a class="sourceLine" id="cb224-2" title="2">csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(hopkins)</a>
<a class="sourceLine" id="cb224-3" title="3"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb224-4" title="4"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb224-5" title="5"><span class="co">##   .default = col_double(),</span></a>
<a class="sourceLine" id="cb224-6" title="6"><span class="co">##   `Province/State` = col_character(),</span></a>
<a class="sourceLine" id="cb224-7" title="7"><span class="co">##   `Country/Region` = col_character()</span></a>
<a class="sourceLine" id="cb224-8" title="8"><span class="co">## )</span></a>
<a class="sourceLine" id="cb224-9" title="9"><span class="co">## See spec(...) for full column specifications.</span></a></code></pre></div></li>
</ul>
<p>‘Tidy’ data</p>
<ul>
<li><p>The data has initial columns describing region, and then a column for each date of the pandemic. There are 264 rows, corresponding to the different regions covered by the database.</p></li>
<li><p>We want instead to ‘pivot’ the data, so that each row represents cases in a particular region on a particular date, analogous to the way the US data we have been investigating earlier has been arranged.</p></li>
<li><p><a href="https://cran.r-project.org/package=tidyr">tidyr</a> provides functions for manipulating a <code>tibble</code> into ‘tidy’ format.</p></li>
<li><p><code>tidyr::pivot_longer()</code> takes a ‘wide’ data frame like <code>csv</code>, and allows us to transform it to the ‘long’ format we are interested in.</p>
<ul>
<li><p>I discovered how to work with <code>pivot_longer()</code> using its help page <code>?tidyr::pivot_longer</code></p></li>
<li><p>The first argument represents columns to pivot or, as a convenience when these are negative values, columns we <em>do not</em> want to pivot. We <em>do not</em> want to pivot columns 1 through 4, so this argument will be <code>-(1:4)</code>.</p></li>
<li><p>The <code>names_to</code> argument is the column name we want to use to refer to the names of the columns that we <em>do</em> pivot. We’ll pivot the columns that have a date in them, so it makes sense to use <code>names_to = "date"</code>.</p></li>
<li><p>The <code>values_to</code> argument is the column name we want to use for the pivoted values. Since the values in the main part of <code>csv</code> are the number of cases observed, we’ll use <code>values_to = "cases"</code></p></li>
</ul></li>
<li><p>Here’s what we have after pivoting</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" title="1">csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-2" title="2"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>)</a>
<a class="sourceLine" id="cb225-3" title="3"><span class="co">## # A tibble: 24,552 x 6</span></a>
<a class="sourceLine" id="cb225-4" title="4"><span class="co">##    `Province/State` `Country/Region`   Lat  Long date    cases</span></a>
<a class="sourceLine" id="cb225-5" title="5"><span class="co">##    &lt;chr&gt;            &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb225-6" title="6"><span class="co">##  1 &lt;NA&gt;             Afghanistan         33    65 1/22/20     0</span></a>
<a class="sourceLine" id="cb225-7" title="7"><span class="co">##  2 &lt;NA&gt;             Afghanistan         33    65 1/23/20     0</span></a>
<a class="sourceLine" id="cb225-8" title="8"><span class="co">##  3 &lt;NA&gt;             Afghanistan         33    65 1/24/20     0</span></a>
<a class="sourceLine" id="cb225-9" title="9"><span class="co">##  4 &lt;NA&gt;             Afghanistan         33    65 1/25/20     0</span></a>
<a class="sourceLine" id="cb225-10" title="10"><span class="co">##  5 &lt;NA&gt;             Afghanistan         33    65 1/26/20     0</span></a>
<a class="sourceLine" id="cb225-11" title="11"><span class="co">##  6 &lt;NA&gt;             Afghanistan         33    65 1/27/20     0</span></a>
<a class="sourceLine" id="cb225-12" title="12"><span class="co">##  7 &lt;NA&gt;             Afghanistan         33    65 1/28/20     0</span></a>
<a class="sourceLine" id="cb225-13" title="13"><span class="co">##  8 &lt;NA&gt;             Afghanistan         33    65 1/29/20     0</span></a>
<a class="sourceLine" id="cb225-14" title="14"><span class="co">##  9 &lt;NA&gt;             Afghanistan         33    65 1/30/20     0</span></a>
<a class="sourceLine" id="cb225-15" title="15"><span class="co">## 10 &lt;NA&gt;             Afghanistan         33    65 1/31/20     0</span></a>
<a class="sourceLine" id="cb225-16" title="16"><span class="co">## # ... with 24,542 more rows</span></a></code></pre></div></li>
<li><p>We’d like to further clean this up data</p>
<ul>
<li><p>Format our newly created ‘date’ column (using <code>as.Date()</code>, but with a <code>format=</code> argument appropriate for the format of the dates in this data set)</p></li>
<li><p>Re-name, for convenience, the <code>County/Region</code> column as just <code>country</code>.</p></li>
<li><p>Select only columns of interest – <code>country</code>, <code>date</code>, <code>cases</code></p></li>
<li><p>Some countries have multiple rows, because the data is a provincial or state levels, so we would like to sum all cases, grouped by <code>country</code> and <code>date</code></p></li>
</ul>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">world &lt;-</a>
<a class="sourceLine" id="cb226-2" title="2"><span class="st">    </span>csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-3" title="3"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-4" title="4"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb226-5" title="5">        <span class="dt">country =</span> <span class="st">`</span><span class="dt">Country/Region</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb226-6" title="6">        <span class="dt">date =</span> <span class="kw">as.Date</span>(date, <span class="dt">format =</span> <span class="st">&quot;%m/%d/%y&quot;</span>)</a>
<a class="sourceLine" id="cb226-7" title="7">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-8" title="8"><span class="st">    </span><span class="kw">group_by</span>(country, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-9" title="9"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases))</a>
<a class="sourceLine" id="cb226-10" title="10">world</a>
<a class="sourceLine" id="cb226-11" title="11"><span class="co">## # A tibble: 17,205 x 3</span></a>
<a class="sourceLine" id="cb226-12" title="12"><span class="co">## # Groups:   country [185]</span></a>
<a class="sourceLine" id="cb226-13" title="13"><span class="co">##    country     date       cases</span></a>
<a class="sourceLine" id="cb226-14" title="14"><span class="co">##    &lt;chr&gt;       &lt;date&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb226-15" title="15"><span class="co">##  1 Afghanistan 2020-01-22     0</span></a>
<a class="sourceLine" id="cb226-16" title="16"><span class="co">##  2 Afghanistan 2020-01-23     0</span></a>
<a class="sourceLine" id="cb226-17" title="17"><span class="co">##  3 Afghanistan 2020-01-24     0</span></a>
<a class="sourceLine" id="cb226-18" title="18"><span class="co">##  4 Afghanistan 2020-01-25     0</span></a>
<a class="sourceLine" id="cb226-19" title="19"><span class="co">##  5 Afghanistan 2020-01-26     0</span></a>
<a class="sourceLine" id="cb226-20" title="20"><span class="co">##  6 Afghanistan 2020-01-27     0</span></a>
<a class="sourceLine" id="cb226-21" title="21"><span class="co">##  7 Afghanistan 2020-01-28     0</span></a>
<a class="sourceLine" id="cb226-22" title="22"><span class="co">##  8 Afghanistan 2020-01-29     0</span></a>
<a class="sourceLine" id="cb226-23" title="23"><span class="co">##  9 Afghanistan 2020-01-30     0</span></a>
<a class="sourceLine" id="cb226-24" title="24"><span class="co">## 10 Afghanistan 2020-01-31     0</span></a>
<a class="sourceLine" id="cb226-25" title="25"><span class="co">## # ... with 17,195 more rows</span></a></code></pre></div></li>
<li><p>Let’s also calculate <code>new_cases</code> by country</p>
<ul>
<li>Use <code>group_by()</code> to perform the <code>new_cases</code> computation for each country</li>
<li>Use <code>mutate()</code> to calculate the new variable</li>
<li>Use <code>ungroup()</code> to remove the grouping variable, so it doesn’t unexpectedly influence other calculations</li>
<li>re-assign the updated <code>tibble</code> to the variable <code>world</code></li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" title="1">world &lt;-</a>
<a class="sourceLine" id="cb227-2" title="2"><span class="st">    </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-3" title="3"><span class="st">    </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-4" title="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-5" title="5"><span class="st">    </span><span class="kw">ungroup</span>()</a></code></pre></div></li>
</ul>
<p>Exploration</p>
<ul>
<li><p>Use <code>group_by()</code> and <code>summarize()</code> to find the maximum (total) number of cases, and <code>arrange() these in</code>desc()`ending order</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1">world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-2" title="2"><span class="st">    </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-3" title="3"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">max</span>(cases)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-4" title="4"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a>
<a class="sourceLine" id="cb228-5" title="5"><span class="co">## # A tibble: 185 x 2</span></a>
<a class="sourceLine" id="cb228-6" title="6"><span class="co">##    country             n</span></a>
<a class="sourceLine" id="cb228-7" title="7"><span class="co">##    &lt;chr&gt;           &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb228-8" title="8"><span class="co">##  1 US             869170</span></a>
<a class="sourceLine" id="cb228-9" title="9"><span class="co">##  2 Spain          213024</span></a>
<a class="sourceLine" id="cb228-10" title="10"><span class="co">##  3 Italy          189973</span></a>
<a class="sourceLine" id="cb228-11" title="11"><span class="co">##  4 France         159460</span></a>
<a class="sourceLine" id="cb228-12" title="12"><span class="co">##  5 Germany        153129</span></a>
<a class="sourceLine" id="cb228-13" title="13"><span class="co">##  6 United Kingdom 139246</span></a>
<a class="sourceLine" id="cb228-14" title="14"><span class="co">##  7 Turkey         101790</span></a>
<a class="sourceLine" id="cb228-15" title="15"><span class="co">##  8 Iran            87026</span></a>
<a class="sourceLine" id="cb228-16" title="16"><span class="co">##  9 China           83884</span></a>
<a class="sourceLine" id="cb228-17" title="17"><span class="co">## 10 Russia          62773</span></a>
<a class="sourceLine" id="cb228-18" title="18"><span class="co">## # ... with 175 more rows</span></a></code></pre></div></li>
</ul>
<p>Visualization</p>
<ul>
<li><p>Start by creating a subset, e.g., the US</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" title="1">country &lt;-<span class="st"> &quot;US&quot;</span></a>
<a class="sourceLine" id="cb229-2" title="2">us &lt;-</a>
<a class="sourceLine" id="cb229-3" title="3"><span class="st">    </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb229-4" title="4"><span class="st">    </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;US&quot;</span>)</a></code></pre></div></li>
<li><p>Use <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> to visualize the progression of the pandemic</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1"><span class="kw">ggplot</span>(us, <span class="kw">aes</span>(date, new_cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb230-2" title="2"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb230-3" title="3"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb230-4" title="4"><span class="st">    </span><span class="kw">geom_smooth</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb230-5" title="5"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Country:&quot;</span>, country))</a>
<a class="sourceLine" id="cb230-6" title="6"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb230-7" title="7"></a>
<a class="sourceLine" id="cb230-8" title="8"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb230-9" title="9"><span class="co">## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></a>
<a class="sourceLine" id="cb230-10" title="10"><span class="co">## Warning: Removed 25 rows containing non-finite values (stat_smooth).</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p></li>
</ul>
<p>It seems like it would be convenient to capture our data cleaning and visualization steps into separate functions that can be re-used, e.g., on different days or for different visualizations.</p>
<ul>
<li><p>write a function for data retrieval and cleaning</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" title="1">get_world_data &lt;-</a>
<a class="sourceLine" id="cb231-2" title="2"><span class="st">    </span><span class="cf">function</span>()</a>
<a class="sourceLine" id="cb231-3" title="3">{</a>
<a class="sourceLine" id="cb231-4" title="4">    <span class="co">## read data from Hopkins&#39; github repository</span></a>
<a class="sourceLine" id="cb231-5" title="5">    hopkins =<span class="st"> &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;</span></a>
<a class="sourceLine" id="cb231-6" title="6">    csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(hopkins)</a>
<a class="sourceLine" id="cb231-7" title="7"></a>
<a class="sourceLine" id="cb231-8" title="8">    <span class="co">## &#39;tidy&#39; the data</span></a>
<a class="sourceLine" id="cb231-9" title="9">    world &lt;-</a>
<a class="sourceLine" id="cb231-10" title="10"><span class="st">        </span>csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-11" title="11"><span class="st">        </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-12" title="12"><span class="st">        </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb231-13" title="13">            <span class="dt">country =</span> <span class="st">`</span><span class="dt">Country/Region</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb231-14" title="14">            <span class="dt">date =</span> <span class="kw">as.Date</span>(date, <span class="dt">format =</span> <span class="st">&quot;%m/%d/%y&quot;</span>)</a>
<a class="sourceLine" id="cb231-15" title="15">        )</a>
<a class="sourceLine" id="cb231-16" title="16"></a>
<a class="sourceLine" id="cb231-17" title="17">    <span class="co">## sum cases across regions within aa country</span></a>
<a class="sourceLine" id="cb231-18" title="18">    world &lt;-</a>
<a class="sourceLine" id="cb231-19" title="19"><span class="st">        </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-20" title="20"><span class="st">        </span><span class="kw">group_by</span>(country, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-21" title="21"><span class="st">        </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases))</a>
<a class="sourceLine" id="cb231-22" title="22"></a>
<a class="sourceLine" id="cb231-23" title="23">    <span class="co">## add `new_cases`, and return the result</span></a>
<a class="sourceLine" id="cb231-24" title="24">    world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-25" title="25"><span class="st">        </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-26" title="26"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-27" title="27"><span class="st">        </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb231-28" title="28">}</a></code></pre></div></li>
<li><p>…and for plotting by country</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1">plot_country &lt;-</a>
<a class="sourceLine" id="cb232-2" title="2"><span class="st">    </span><span class="cf">function</span>(tbl, <span class="dt">view_country =</span> <span class="st">&quot;US&quot;</span>)</a>
<a class="sourceLine" id="cb232-3" title="3">{</a>
<a class="sourceLine" id="cb232-4" title="4">    country_title &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Country:&quot;</span>, view_country)</a>
<a class="sourceLine" id="cb232-5" title="5"></a>
<a class="sourceLine" id="cb232-6" title="6">    <span class="co">## subset to just this country</span></a>
<a class="sourceLine" id="cb232-7" title="7">    country_data &lt;-</a>
<a class="sourceLine" id="cb232-8" title="8"><span class="st">        </span>tbl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-9" title="9"><span class="st">        </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> </span>view_country)</a>
<a class="sourceLine" id="cb232-10" title="10"></a>
<a class="sourceLine" id="cb232-11" title="11">    <span class="co">## plot</span></a>
<a class="sourceLine" id="cb232-12" title="12">    country_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-13" title="13"><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>new_cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb232-14" title="14"><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb232-15" title="15"><span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb232-16" title="16"><span class="st">        </span><span class="co">## add method and formula to quieten message</span></a>
<a class="sourceLine" id="cb232-17" title="17"><span class="st">        </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x) <span class="op">+</span></a>
<a class="sourceLine" id="cb232-18" title="18"><span class="st">        </span><span class="kw">ggtitle</span>(country_title)</a>
<a class="sourceLine" id="cb232-19" title="19">}</a></code></pre></div></li>
<li><p>Note that, because the first argument of <code>plot_country()</code> is a tibble, the output of <code>get_world_data()</code> can be used as the input of <code>plot_country()</code>, and can be piped together, e.g.,</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1">world &lt;-<span class="st"> </span><span class="kw">get_world_data</span>()</a>
<a class="sourceLine" id="cb233-2" title="2"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb233-3" title="3"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb233-4" title="4"><span class="co">##   .default = col_double(),</span></a>
<a class="sourceLine" id="cb233-5" title="5"><span class="co">##   `Province/State` = col_character(),</span></a>
<a class="sourceLine" id="cb233-6" title="6"><span class="co">##   `Country/Region` = col_character()</span></a>
<a class="sourceLine" id="cb233-7" title="7"><span class="co">## )</span></a>
<a class="sourceLine" id="cb233-8" title="8"><span class="co">## See spec(...) for full column specifications.</span></a>
<a class="sourceLine" id="cb233-9" title="9">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Korea, South&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p></li>
</ul>
</div>
<div id="day-19-friday-zoom-check-in" class="section level2">
<h2><span class="header-section-number">3.5</span> Day 19 (Friday) Zoom check-in</h2>
<div id="review-and-trouble-shoot-25-minutes" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Review and trouble shoot (25 minutes)</h3>
</div>
<div id="next-week-25-minutes" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Next week (25 minutes)</h3>
</div>
</div>
<div id="day-20-exploring-the-course-of-pandemic-in-different-regions" class="section level2">
<h2><span class="header-section-number">3.6</span> Day 20 Exploring the course of pandemic in different regions</h2>
<p>Use the data and functions from quarantine day 18 to place the pandemic into quantitative perspective. Start by retrieving the current data</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1">world &lt;-<span class="st"> </span><span class="kw">get_world_data</span>()</a></code></pre></div>
<p>Start with the United States</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;US&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<ul>
<li><p>When did ‘stay at home’ orders come into effect? Did they appear to be effective?</p></li>
<li><p>When would the data suggest that the pandemic might be considered ‘under control’, and country-wide stay-at-home orders might be relaxed?</p></li>
</ul>
<p>Explore other countries.</p>
<ul>
<li><p>The longest trajectory is probably displayed by China</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;China&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p></li>
<li><p>Italy and Spain were hit very hard, and relatively early, by the pandemic</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Italy&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Spain&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-29-2.png" width="672" /></p></li>
<li><p>Austria relaxed quarantine very early, in the middle of April; does that seem like a good idea?</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Austria&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p></li>
<li><p>Germany also had strong leadership (e.g., chancellor Angela Merkel provided clear and unambiguous rules for Germans to follow, and then self-isolated when her doctor, whom she had recently visited, tested positive) and an effective screening campaign (e.g., to make effective use of limited testing resources, in some instances pools of samples were screened, and only if the pool indicated infection were the individuals in the pool screened.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Germany&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p></li>
<li><p>At the start of the pandemic, Singapore had excellent surveillance (detecting individuals with symptoms) and contact tracing (identifying and placing in quarantine those individuals coming in contact with the infected individuals). New cases were initially very low, despite proximity to China, and Singapore managed the pandemic through only moderate social distancing (e.g., workers were encouraged to operate in shifts; stores and restaurants remained open). Unfortunately, Singaporeans returning from Europe (after travel restrictions were in place there) introduced new cases that appear to have overwhelmed the surveillance network. Later, the virus spread to large, densely populated migrant work housing. Singapore’s initial success at containing the virus seems to have fallen apart in the face of this wider spread, and more severe restrictions on economic and social life were imposed.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Singapore&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p></li>
<li><p>South Korea had a very ‘acute’ spike in cases associated with a large church. The response was to deploy very extensive testing and use modern approaches to tracking (e.g., cell phone apps) coupled with transparent accounting. South Korea imposed relatively modest social and economic restrictions. It seems like this has effectively ‘flattened the curve’ without pausing the economy.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Korea, South&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p></li>
</ul>
<p>Where does your own exploration of the data take you?</p>
</div>
<div id="day-21" class="section level2">
<h2><span class="header-section-number">3.7</span> Day 21</h2>
<p>Self-directed activities.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="two.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="four.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["QuaRantine.pdf", "QuaRantine.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
