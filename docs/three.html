<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Week 3 Packages and the ‘tidyverse’ | 40 Days and 40 Nights</title>
  <meta name="description" content="An ad hoc course to learn R for bioinformatics, using the
COVID-19 epidemic as an excuse." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Week 3 Packages and the ‘tidyverse’ | 40 Days and 40 Nights" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An ad hoc course to learn R for bioinformatics, using the
COVID-19 epidemic as an excuse." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Week 3 Packages and the ‘tidyverse’ | 40 Days and 40 Nights" />
  
  <meta name="twitter:description" content="An ad hoc course to learn R for bioinformatics, using the
COVID-19 epidemic as an excuse." />
  

<meta name="author" content="Martin Morgan" />
<meta name="author" content="L. Shawn Matott" />


<meta name="date" content="2020-05-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="two.html"/>
<link rel="next" href="four.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">QuaRantine</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Motivation</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-to-expect"><i class="fa fa-check"></i>What to expect</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="one.html"><a href="one.html"><i class="fa fa-check"></i><b>1</b> Basics</a><ul>
<li class="chapter" data-level="1.1" data-path="one.html"><a href="one.html#day-1-monday-zoom-orientation"><i class="fa fa-check"></i><b>1.1</b> Day 1 (Monday) Zoom orientation</a><ul>
<li class="chapter" data-level="1.1.1" data-path="one.html"><a href="one.html#logistics-10-minutes"><i class="fa fa-check"></i><b>1.1.1</b> Logistics (10 minutes)</a></li>
<li class="chapter" data-level="1.1.2" data-path="one.html"><a href="one.html#installing-r-and-rstudio-25-minutes-shawn"><i class="fa fa-check"></i><b>1.1.2</b> Installing <em>R</em> and <em>RStudio</em> (25 minutes, Shawn)</a></li>
<li class="chapter" data-level="1.1.3" data-path="one.html"><a href="one.html#basics-of-r-25-minutes"><i class="fa fa-check"></i><b>1.1.3</b> Basics of <em>R</em> (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="one.html"><a href="one.html#day-2-vectors-and-variables"><i class="fa fa-check"></i><b>1.2</b> Day 2: Vectors and variables</a></li>
<li class="chapter" data-level="1.3" data-path="one.html"><a href="one.html#day-3-factor-date-and-na"><i class="fa fa-check"></i><b>1.3</b> Day 3: <code>factor()</code>, <code>Date()</code>, and <code>NA</code></a></li>
<li class="chapter" data-level="1.4" data-path="one.html"><a href="one.html#day-4-working-with-variables"><i class="fa fa-check"></i><b>1.4</b> Day 4: Working with variables</a></li>
<li class="chapter" data-level="1.5" data-path="one.html"><a href="one.html#day-5-friday-zoom-check-in"><i class="fa fa-check"></i><b>1.5</b> Day 5 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="1.5.1" data-path="one.html"><a href="one.html#logistics"><i class="fa fa-check"></i><b>1.5.1</b> Logistics</a></li>
<li class="chapter" data-level="1.5.2" data-path="one.html"><a href="one.html#review-and-trouble-shoot-25-minutes-martin"><i class="fa fa-check"></i><b>1.5.2</b> Review and trouble shoot (25 minutes; Martin)</a></li>
<li class="chapter" data-level="1.5.3" data-path="one.html"><a href="one.html#weekend-activities-25-minutes-shawn"><i class="fa fa-check"></i><b>1.5.3</b> Weekend activities (25 minutes; Shawn)</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="one.html"><a href="one.html#day-6-r-scripts"><i class="fa fa-check"></i><b>1.6</b> Day 6: <em>R</em> scripts</a></li>
<li class="chapter" data-level="1.7" data-path="one.html"><a href="one.html#day-7-saving-data"><i class="fa fa-check"></i><b>1.7</b> Day 7: Saving data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="two.html"><a href="two.html"><i class="fa fa-check"></i><b>2</b> The data frame</a><ul>
<li class="chapter" data-level="2.1" data-path="two.html"><a href="two.html#day-8-monday-zoom-check-in"><i class="fa fa-check"></i><b>2.1</b> Day 8 (Monday) Zoom check-in</a><ul>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#logistics-1"><i class="fa fa-check"></i>Logistics</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#review-and-troubleshoot-15-minutes"><i class="fa fa-check"></i>Review and troubleshoot (15 minutes)</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#the-data-frame-40-minutes"><i class="fa fa-check"></i>The data frame (40 minutes)</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#this-weeks-activities-5-minutes"><i class="fa fa-check"></i>This week’s activities (5 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="two.html"><a href="two.html#day-9-creation-and-manipulation"><i class="fa fa-check"></i><b>2.2</b> Day 9: Creation and manipulation</a><ul>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#creation"><i class="fa fa-check"></i>Creation</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#column-selection"><i class="fa fa-check"></i>Column selection</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#adding-or-updating-columns"><i class="fa fa-check"></i>Adding or updating columns</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#reading-and-writing"><i class="fa fa-check"></i>Reading and writing</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#reading-from-a-remote-file"><i class="fa fa-check"></i>Reading from a remote file (!)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="two.html"><a href="two.html#day-10-subset-with-and-within"><i class="fa fa-check"></i><b>2.3</b> Day 10: <code>subset()</code>, <code>with()</code>, and <code>within()</code></a><ul>
<li><a href="two.html#subset"><code>subset()</code></a></li>
<li><a href="two.html#with"><code>with()</code></a></li>
<li><a href="two.html#within"><code>within()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="two.html"><a href="two.html#day-11-aggregate-and-an-initial-work-flow"><i class="fa fa-check"></i><b>2.4</b> Day 11: <code>aggregate()</code> and an initial work flow</a><ul>
<li><a href="two.html#aggregate-for-summarizing-columns-by-group"><code>aggregate()</code> for summarizing columns by group</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#an-initial-work-flow"><i class="fa fa-check"></i>An initial work flow</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="two.html"><a href="two.html#day-12-friday-zoom-check-in"><i class="fa fa-check"></i><b>2.5</b> Day 12 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#review-and-troubleshoot-20-minutes"><i class="fa fa-check"></i>Review and troubleshoot (20 minutes)</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#user-defined-functions"><i class="fa fa-check"></i>User-defined functions</a></li>
<li class="chapter" data-level="" data-path="two.html"><a href="two.html#plotting-data"><i class="fa fa-check"></i>Plotting data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="two.html"><a href="two.html#day-13-basic-visualization"><i class="fa fa-check"></i><b>2.6</b> Day 13: Basic visualization</a></li>
<li class="chapter" data-level="2.7" data-path="two.html"><a href="two.html#day-14-functions"><i class="fa fa-check"></i><b>2.7</b> Day 14: Functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="three.html"><a href="three.html"><i class="fa fa-check"></i><b>3</b> Packages and the ‘tidyverse’</a><ul>
<li class="chapter" data-level="3.1" data-path="three.html"><a href="three.html#day-15-monday-zoom-check-in"><i class="fa fa-check"></i><b>3.1</b> Day 15 (Monday) Zoom check-in</a><ul>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#review-and-troubleshoot-15-minutes-1"><i class="fa fa-check"></i>Review and troubleshoot (15 minutes)</a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#packages-20-minutes"><i class="fa fa-check"></i>Packages (20 minutes)</a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#the-tidyverse-of-packages-20-minutes"><i class="fa fa-check"></i>The ‘tidyverse’ of packages (20 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="three.html"><a href="three.html#day-16-key-tidyverse-packages-readr-and-dplyr"><i class="fa fa-check"></i><b>3.2</b> Day 16 Key tidyverse packages: <span>readr</span> and <span>dplyr</span></a></li>
<li class="chapter" data-level="3.3" data-path="three.html"><a href="three.html#day-17-visualization-with-ggplot2"><i class="fa fa-check"></i><b>3.3</b> Day 17 Visualization with <span>ggplot2</span></a><ul>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#setup"><i class="fa fa-check"></i>Setup</a></li>
<li><a href="three.html#ggplot2-essentials"><span>ggplot2</span> essentials</a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#covid-19-in-erie-county"><i class="fa fa-check"></i>COVID-19 in Erie county</a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#covid-19-in-new-york-state"><i class="fa fa-check"></i>COVID-19 in New York State</a></li>
<li class="chapter" data-level="" data-path="three.html"><a href="three.html#covid-19-nationally"><i class="fa fa-check"></i>COVID-19 nationally</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="three.html"><a href="three.html#day-18-worldwide-covid-data"><i class="fa fa-check"></i><b>3.4</b> Day 18 Worldwide COVID data</a></li>
<li class="chapter" data-level="3.5" data-path="three.html"><a href="three.html#day-19-friday-zoom-check-in"><i class="fa fa-check"></i><b>3.5</b> Day 19 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="3.5.1" data-path="three.html"><a href="three.html#logistics-2"><i class="fa fa-check"></i><b>3.5.1</b> Logistics</a></li>
<li class="chapter" data-level="3.5.2" data-path="three.html"><a href="three.html#review-and-trouble-shoot-40-minutes"><i class="fa fa-check"></i><b>3.5.2</b> Review and trouble shoot (40 minutes)</a></li>
<li class="chapter" data-level="3.5.3" data-path="three.html"><a href="three.html#weekend-activities-15-minutes"><i class="fa fa-check"></i><b>3.5.3</b> Weekend activities (15 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="three.html"><a href="three.html#day-20-exploring-the-course-of-pandemic-in-different-regions"><i class="fa fa-check"></i><b>3.6</b> Day 20 Exploring the course of pandemic in different regions</a></li>
<li class="chapter" data-level="3.7" data-path="three.html"><a href="three.html#day-21-critical-evaluation"><i class="fa fa-check"></i><b>3.7</b> Day 21 Critical evaluation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="four.html"><a href="four.html"><i class="fa fa-check"></i><b>4</b> Machine learning</a><ul>
<li class="chapter" data-level="4.1" data-path="four.html"><a href="four.html#day-22-monday-zoom-check-in"><i class="fa fa-check"></i><b>4.1</b> Day 22 (Monday) Zoom check-in</a><ul>
<li class="chapter" data-level="4.1.1" data-path="four.html"><a href="four.html#a-covid-19-dataset-for-machine-learning"><i class="fa fa-check"></i><b>4.1.1</b> A COVID-19 Dataset for Machine Learning</a></li>
<li class="chapter" data-level="4.1.2" data-path="four.html"><a href="four.html#a-machine-learning-primer"><i class="fa fa-check"></i><b>4.1.2</b> A Machine Learning Primer</a></li>
<li class="chapter" data-level="4.1.3" data-path="four.html"><a href="four.html#the-random-forest-algorithm"><i class="fa fa-check"></i><b>4.1.3</b> The Random Forest Algorithm</a></li>
<li class="chapter" data-level="4.1.4" data-path="four.html"><a href="four.html#a-random-forest-example-using-covid-19-data"><i class="fa fa-check"></i><b>4.1.4</b> A Random Forest Example Using COVID-19 Data</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="four.html"><a href="four.html#day-23---support-vector-machines"><i class="fa fa-check"></i><b>4.2</b> Day 23 - Support Vector Machines</a><ul>
<li class="chapter" data-level="4.2.1" data-path="four.html"><a href="four.html#an-svm-example-using-covid-19"><i class="fa fa-check"></i><b>4.2.1</b> An SVM Example using COVID-19</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="four.html"><a href="four.html#day-24---the-k-nearest-neighbors-algorithm"><i class="fa fa-check"></i><b>4.3</b> Day 24 - the <span class="math inline">\(k\)</span>-Nearest Neighbors Algorithm</a></li>
<li class="chapter" data-level="4.4" data-path="four.html"><a href="four.html#day-25---exploring-the-knn-algorithm"><i class="fa fa-check"></i><b>4.4</b> Day 25 - Exploring the KNN Algorithm</a></li>
<li class="chapter" data-level="4.5" data-path="four.html"><a href="four.html#day-26-friday-zoom-check-in"><i class="fa fa-check"></i><b>4.5</b> Day 26 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="4.5.1" data-path="four.html"><a href="four.html#review-and-trouble-shoot-25-minutes"><i class="fa fa-check"></i><b>4.5.1</b> Review and trouble shoot (25 minutes)</a></li>
<li class="chapter" data-level="4.5.2" data-path="four.html"><a href="four.html#this-weekend-25-minutes"><i class="fa fa-check"></i><b>4.5.2</b> This weekend (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="four.html"><a href="four.html#day-27"><i class="fa fa-check"></i><b>4.6</b> Day 27</a></li>
<li class="chapter" data-level="4.7" data-path="four.html"><a href="four.html#day-28"><i class="fa fa-check"></i><b>4.7</b> Day 28</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="five.html"><a href="five.html"><i class="fa fa-check"></i><b>5</b> Bioinformatics with <span>Bioconductor</span></a><ul>
<li class="chapter" data-level="5.1" data-path="five.html"><a href="five.html#day-29-monday-zoom-check-in"><i class="fa fa-check"></i><b>5.1</b> Day 29 (Monday) Zoom check-in</a><ul>
<li class="chapter" data-level="5.1.1" data-path="five.html"><a href="five.html#review-and-trouble-shoot"><i class="fa fa-check"></i><b>5.1.1</b> Review and trouble shoot</a></li>
<li class="chapter" data-level="5.1.2" data-path="five.html"><a href="five.html#bioconductor-packages-and-biological-data"><i class="fa fa-check"></i><b>5.1.2</b> <span>Bioconductor</span>, packages, and biological data</a></li>
<li class="chapter" data-level="5.1.3" data-path="five.html"><a href="five.html#this-week-sars-cov-2-sequence-and-human-tissue-specific-gene-expression-data"><i class="fa fa-check"></i><b>5.1.3</b> This week: SARS-CoV-2 sequence and human tissue-specific gene expression data</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="five.html"><a href="five.html#day-30-dna-sequences-and-annotations"><i class="fa fa-check"></i><b>5.2</b> Day 30 DNA sequences and annotations</a><ul>
<li class="chapter" data-level="5.2.1" data-path="five.html"><a href="five.html#setup-1"><i class="fa fa-check"></i><b>5.2.1</b> Setup</a></li>
<li class="chapter" data-level="5.2.2" data-path="five.html"><a href="five.html#representing-dna-sequences"><i class="fa fa-check"></i><b>5.2.2</b> Representing DNA sequences</a></li>
<li class="chapter" data-level="5.2.3" data-path="five.html"><a href="five.html#working-with-genbankrecord-objects"><i class="fa fa-check"></i><b>5.2.3</b> Working with <code>GenBankRecord</code> objects</a></li>
<li class="chapter" data-level="5.2.4" data-path="five.html"><a href="five.html#genomic-ranges-and-dna-sequences"><i class="fa fa-check"></i><b>5.2.4</b> Genomic ranges and DNA sequences</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="five.html"><a href="five.html#day-31-sequence-alignment-and-visualization"><i class="fa fa-check"></i><b>5.3</b> Day 31 Sequence alignment and visualization</a><ul>
<li class="chapter" data-level="5.3.1" data-path="five.html"><a href="five.html#s-gene-exploration"><i class="fa fa-check"></i><b>5.3.1</b> ‘S’ gene exploration</a></li>
<li class="chapter" data-level="5.3.2" data-path="five.html"><a href="five.html#sequence-alignment"><i class="fa fa-check"></i><b>5.3.2</b> Sequence alignment</a></li>
<li class="chapter" data-level="5.3.3" data-path="five.html"><a href="five.html#phylogenetic-tree-visualization"><i class="fa fa-check"></i><b>5.3.3</b> Phylogenetic tree visualization</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="five.html"><a href="five.html#day-32-single-cell-expression-data"><i class="fa fa-check"></i><b>5.4</b> Day 32 Single-cell expression data</a><ul>
<li class="chapter" data-level="5.4.1" data-path="five.html"><a href="five.html#setup-2"><i class="fa fa-check"></i><b>5.4.1</b> Setup</a></li>
<li class="chapter" data-level="5.4.2" data-path="five.html"><a href="five.html#data-input-and-exploration"><i class="fa fa-check"></i><b>5.4.2</b> Data input and exploration</a></li>
<li class="chapter" data-level="5.4.3" data-path="five.html"><a href="five.html#coordinating-cell-and-expression-data"><i class="fa fa-check"></i><b>5.4.3</b> Coordinating cell and expression data</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="five.html"><a href="five.html#day-33-friday-zoom-check-in"><i class="fa fa-check"></i><b>5.5</b> Day 33 (Friday) Zoom check-in</a><ul>
<li class="chapter" data-level="5.5.1" data-path="five.html"><a href="five.html#monday-troubles-10-minutes"><i class="fa fa-check"></i><b>5.5.1</b> Monday troubles (10 minutes)</a></li>
<li class="chapter" data-level="5.5.2" data-path="five.html"><a href="five.html#review-and-trouble-shoot-40-minutes-1"><i class="fa fa-check"></i><b>5.5.2</b> Review and trouble shoot (40 minutes)</a></li>
<li class="chapter" data-level="5.5.3" data-path="five.html"><a href="five.html#this-weekend-10-minutes"><i class="fa fa-check"></i><b>5.5.3</b> This weekend (10 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="five.html"><a href="five.html#day-34-revising-tree-visualization"><i class="fa fa-check"></i><b>5.6</b> Day 34 Revising tree visualization</a></li>
<li class="chapter" data-level="5.7" data-path="five.html"><a href="five.html#day-35-exploring-bioconductor"><i class="fa fa-check"></i><b>5.7</b> Day 35 Exploring <span>Bioconductor</span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="six.html"><a href="six.html"><i class="fa fa-check"></i><b>6</b> Collaboration</a><ul>
<li class="chapter" data-level="6.1" data-path="six.html"><a href="six.html#days-monday-zoom-check-in"><i class="fa fa-check"></i><b>6.1</b> 5 Days (Monday) Zoom check-in</a><ul>
<li class="chapter" data-level="6.1.1" data-path="six.html"><a href="six.html#weekend-review-5-minutes"><i class="fa fa-check"></i><b>6.1.1</b> Weekend review (5 minutes)</a></li>
<li class="chapter" data-level="6.1.2" data-path="six.html"><a href="six.html#vignettes-25-minutes-shawn"><i class="fa fa-check"></i><b>6.1.2</b> Vignettes (25 minutes; Shawn)</a></li>
<li class="chapter" data-level="6.1.3" data-path="six.html"><a href="six.html#writing-and-documenting-r-functions-25-minutes"><i class="fa fa-check"></i><b>6.1.3</b> Writing and documenting R functions (25 minutes)</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="six.html"><a href="six.html#days-write-a-vignette"><i class="fa fa-check"></i><b>6.2</b> 4 Days Write a vignette!</a></li>
<li class="chapter" data-level="6.3" data-path="six.html"><a href="six.html#days-create-documented-reusable-functions"><i class="fa fa-check"></i><b>6.3</b> 3 Days Create documented, reusable functions!</a></li>
<li class="chapter" data-level="6.4" data-path="six.html"><a href="six.html#days-share-your-work-as-a-package"><i class="fa fa-check"></i><b>6.4</b> 2 Days Share your work as a package!</a></li>
<li class="chapter" data-level="6.5" data-path="six.html"><a href="six.html#today-friday-zoom-check-in"><i class="fa fa-check"></i><b>6.5</b> Today! (Friday) Zoom check-in</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="frequently-asked-questions.html"><a href="frequently-asked-questions.html"><i class="fa fa-check"></i>Frequently asked questions</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">40 Days and 40 Nights</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="three" class="section level1">
<h1><span class="header-section-number">Week 3</span> Packages and the ‘tidyverse’</h1>
<div id="day-15-monday-zoom-check-in" class="section level2">
<h2><span class="header-section-number">3.1</span> Day 15 (Monday) Zoom check-in</h2>
<div id="review-and-troubleshoot-15-minutes-1" class="section level3 unnumbered">
<h3>Review and troubleshoot (15 minutes)</h3>
<p>Over the weekend, I wrote two functions. The first retrieves and ‘cleans’ the US data set.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">get_US_data &lt;-</a>
<a class="sourceLine" id="cb208-2" data-line-number="2"><span class="st">    </span><span class="cf">function</span>()</a>
<a class="sourceLine" id="cb208-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb208-4" data-line-number="4">    <span class="co">## retrieve data from the internet</span></a>
<a class="sourceLine" id="cb208-5" data-line-number="5">    url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb208-6" data-line-number="6">    us &lt;-<span class="st"> </span><span class="kw">read.csv</span>(url, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb208-7" data-line-number="7"></a>
<a class="sourceLine" id="cb208-8" data-line-number="8">    <span class="co">## update &#39;date&#39; from character vector to &#39;Date&#39;.  this is the</span></a>
<a class="sourceLine" id="cb208-9" data-line-number="9">    <span class="co">## last line of executed code in the function, so the return</span></a>
<a class="sourceLine" id="cb208-10" data-line-number="10">    <span class="co">## value (the updated &#39;us&#39; object) is returned by the functino</span></a>
<a class="sourceLine" id="cb208-11" data-line-number="11">    <span class="kw">within</span>(us, {</a>
<a class="sourceLine" id="cb208-12" data-line-number="12">        date =<span class="st"> </span><span class="kw">as.Date</span>(date, <span class="dt">format =</span> <span class="st">&quot;%Y-%m-%d&quot;</span>)</a>
<a class="sourceLine" id="cb208-13" data-line-number="13">    })</a>
<a class="sourceLine" id="cb208-14" data-line-number="14">}</a></code></pre></div>
<p>The second plots data for a particular county and state</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1">plot_county &lt;-</a>
<a class="sourceLine" id="cb209-2" data-line-number="2"><span class="st">    </span><span class="cf">function</span>(us_data, <span class="dt">county_of_interest =</span> <span class="st">&quot;Erie&quot;</span>, <span class="dt">state_of_interest =</span> <span class="st">&quot;New York&quot;</span>)</a>
<a class="sourceLine" id="cb209-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb209-4" data-line-number="4">    <span class="co">## create the title for the plot</span></a>
<a class="sourceLine" id="cb209-5" data-line-number="5">    main_title &lt;-<span class="st"> </span><span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb209-6" data-line-number="6">        <span class="st">&quot;New Cases,&quot;</span>, county_of_interest, <span class="st">&quot;County&quot;</span>, state_of_interest</a>
<a class="sourceLine" id="cb209-7" data-line-number="7">    )</a>
<a class="sourceLine" id="cb209-8" data-line-number="8"></a>
<a class="sourceLine" id="cb209-9" data-line-number="9">    <span class="co">## subset the us data to just the county and state of interest</span></a>
<a class="sourceLine" id="cb209-10" data-line-number="10">    county_data &lt;-<span class="st"> </span><span class="kw">subset</span>(</a>
<a class="sourceLine" id="cb209-11" data-line-number="11">        us_data,</a>
<a class="sourceLine" id="cb209-12" data-line-number="12">        (county <span class="op">==</span><span class="st"> </span>county_of_interest) <span class="op">&amp;</span><span class="st"> </span>(state <span class="op">==</span><span class="st"> </span>state_of_interest)</a>
<a class="sourceLine" id="cb209-13" data-line-number="13">    )</a>
<a class="sourceLine" id="cb209-14" data-line-number="14"></a>
<a class="sourceLine" id="cb209-15" data-line-number="15">    <span class="co">## calculate new cases for particular county and state</span></a>
<a class="sourceLine" id="cb209-16" data-line-number="16">    county_data &lt;-<span class="st"> </span><span class="kw">within</span>(county_data, {</a>
<a class="sourceLine" id="cb209-17" data-line-number="17">        new_cases &lt;-<span class="st"> </span><span class="kw">diff</span>( <span class="kw">c</span>(<span class="dv">0</span>, cases) )</a>
<a class="sourceLine" id="cb209-18" data-line-number="18">    })</a>
<a class="sourceLine" id="cb209-19" data-line-number="19"></a>
<a class="sourceLine" id="cb209-20" data-line-number="20">    <span class="co">## plot</span></a>
<a class="sourceLine" id="cb209-21" data-line-number="21">    <span class="kw">plot</span>( new_cases <span class="op">~</span><span class="st"> </span>date, county_data, <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">main =</span> main_title)</a>
<a class="sourceLine" id="cb209-22" data-line-number="22">}</a></code></pre></div>
<p>I lived in Seattle (King County, Washington), for a while, and this is where the first serious outbreak occurred. Here’s the relevant data:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">us &lt;-<span class="st"> </span><span class="kw">get_US_data</span>()</a>
<a class="sourceLine" id="cb210-2" data-line-number="2"><span class="kw">plot_county</span>(us, <span class="st">&quot;King&quot;</span>, <span class="st">&quot;Washington&quot;</span>)</a>
<a class="sourceLine" id="cb210-3" data-line-number="3"><span class="co">## Warning in xy.coords(x, y, xlabel, ylabel, log): 3 y values &lt;= 0 omitted from</span></a>
<a class="sourceLine" id="cb210-4" data-line-number="4"><span class="co">## logarithmic plot</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="packages-20-minutes" class="section level3 unnumbered">
<h3>Packages (20 minutes)</h3>
<p>Base <em>R</em></p>
<ul>
<li><p><em>R</em> consists of ‘packages’ that implement different functionality. Each package contains <em>functions</em> that we can use, and perhaps data sets (like the <code>mtcars</code>) data set from Friday’s presentation) and other resources.</p></li>
<li><p><em>R</em> comes with several ‘base’ packages installed, and these are available in a new <em>R</em> session.</p></li>
<li><p>Discover packages that are currently available using the <code>search()</code> function. This shows that the ‘stats’, ‘graphics’, ‘grDevices’, ‘utils’, ‘datasets’, ‘methods’, and ‘base’ packages, among others, are available in our current <em>R</em> session.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">search</span>()</a>
<a class="sourceLine" id="cb211-2" data-line-number="2"><span class="co">## [1] &quot;.GlobalEnv&quot;        &quot;package:stats&quot;     &quot;package:graphics&quot;</span></a>
<a class="sourceLine" id="cb211-3" data-line-number="3"><span class="co">## [4] &quot;package:grDevices&quot; &quot;package:utils&quot;     &quot;package:datasets&quot;</span></a>
<a class="sourceLine" id="cb211-4" data-line-number="4"><span class="co">## [7] &quot;package:methods&quot;   &quot;Autoloads&quot;         &quot;package:base&quot;</span></a></code></pre></div></li>
<li><p>When we create a variable like</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a></code></pre></div>
<p><em>R</em> creates a new <em>symbol</em> in the <code>.GlobalEnv</code> location on the search path.</p></li>
<li><p>When we evaluate a function like <code>length(x)</code>…</p>
<ul>
<li><p><em>R</em> searches for the function <code>length()</code> along the <code>search()</code> path. It doesn’t find <code>length()</code> in the <code>.GlobalEnv</code> (because we didn’t define it there), or in the ‘stats’, ‘graphics’, … packages. Eventually, <em>R</em> finds the definition of <code>length</code> in the ‘base’ package.</p></li>
<li><p><em>R</em> then looks for the definition of <code>x</code>, finds it in the
<code>.GlobalEnv</code>.</p></li>
<li><p>Finally, <em>R</em> applies the definition of <code>length</code> found in the base package to the value of <code>x</code> found in the <code>.GlobalEnv</code>.</p></li>
</ul></li>
</ul>
<p>Contributed packages</p>
<ul>
<li><p><em>R</em> would be pretty limited if it could only do things that are defined in the base packages.</p></li>
<li><p>It is ‘easy’ to write a package, and to make the package available for others to use.</p></li>
<li><p>A major repository of contributed packages is <a href="https://cran.r-project.org">CRAN</a> – the Comprehensive <em>R</em> Archive Network. There are more than 15,000 packages in CRAN.</p></li>
<li><p>Many CRAN packages are arranged in <a href="https://cran.r-project.org/web/views/">task views</a> that highlight the most useful packages.</p></li>
</ul>
<p>Installing and attaching packages</p>
<ul>
<li><p>There are too many packages for all to be distributed with <em>R</em>, so it is necessary to <em>install</em> contributed packages that you might find interesting.</p></li>
<li><p>once a package is installed (you only need to install a package once), it can be ‘loaded’ and ‘attached’ to the search path using
<code>library()</code>.</p></li>
<li><p>As an exercise, try to attach the ‘readr’, ‘dplyr’, and ‘ggplot2’ packages</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb213-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb213-3" data-line-number="3"><span class="kw">library</span>(ggplot2)</a></code></pre></div></li>
<li><p>If any of these fails with a message like</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb214-2" data-line-number="2"><span class="co">## Error in library(&quot;dplyr&quot;) : there is no package called &#39;dplyr&#39;</span></a></code></pre></div>
<p>it means that the package has not been installed (or that you have a typo in the name of the library!)</p></li>
<li><p>Install any package that failed when <code>library()</code> was called with</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;readr&quot;</span>, <span class="st">&quot;dplyr&quot;</span>), <span class="dt">repos =</span> <span class="st">&quot;https://cran.r-project.org&quot;</span>)</a></code></pre></div>
<p>Alternatively, use the <em>RStudio</em> interface to select (in the lower right panel, by default) the ‘Packages’ tab, ‘Install’ button.</p>
<p><img src="images/RStudio-install.png" width="1169" /></p></li>
<li><p>One package may use functions from one or more other packages, so when you install, for instance ‘dplyr’, you may actually install <em>several</em> packages.</p></li>
</ul>
</div>
<div id="the-tidyverse-of-packages-20-minutes" class="section level3 unnumbered">
<h3>The ‘tidyverse’ of packages (20 minutes)</h3>
<p>The ‘tidyverse’ of packages provides a very powerful paradigm for working with data.</p>
<ul>
<li><p>Based on the idea that a first step in data analysis is to transform the data into a standard format. Subsequent steps can then be accomplished in a much more straight-forward way, using a small set of functions.</p></li>
<li><p>Hadley Wickham’s ‘<a href="https://vita.had.co.nz/papers/tidy-data.pdf">Tidy Data</a>’ paper provides a kind of manifesto for what constitutes tidy data:</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table</li>
</ol></li>
<li><p>We’ll look at the <a href="https://cran.r-project.org/package=readr">readr</a> package for data input, and the <a href="https://cran.r-project.org/package=dplyr">dplyr</a> package for essential data manipulation.</p></li>
</ul>
<p><a href="https://cran.r-project.org/package=readr">readr</a> for fast data input</p>
<ul>
<li><p>Load (install if necessary!) and attach the <a href="https://cran.r-project.org/package=readr">readr</a> package</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb216-2" data-line-number="2"></a>
<a class="sourceLine" id="cb216-3" data-line-number="3"><span class="co">## if it fails to load, try</span></a>
<a class="sourceLine" id="cb216-4" data-line-number="4"><span class="co">##     install.packages(&quot;readr&quot;, repos = &quot;https://cran.r-project.org&quot;)</span></a></code></pre></div></li>
<li><p>Example: US COVID data. N.B., <code>readr::read_csv()</code> rather than <code>read.csv()</code></p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb217-2" data-line-number="2">us &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url)</a>
<a class="sourceLine" id="cb217-3" data-line-number="3"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb217-4" data-line-number="4"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb217-5" data-line-number="5"><span class="co">##   date = col_date(format = &quot;&quot;),</span></a>
<a class="sourceLine" id="cb217-6" data-line-number="6"><span class="co">##   county = col_character(),</span></a>
<a class="sourceLine" id="cb217-7" data-line-number="7"><span class="co">##   state = col_character(),</span></a>
<a class="sourceLine" id="cb217-8" data-line-number="8"><span class="co">##   fips = col_character(),</span></a>
<a class="sourceLine" id="cb217-9" data-line-number="9"><span class="co">##   cases = col_double(),</span></a>
<a class="sourceLine" id="cb217-10" data-line-number="10"><span class="co">##   deaths = col_double()</span></a>
<a class="sourceLine" id="cb217-11" data-line-number="11"><span class="co">## )</span></a>
<a class="sourceLine" id="cb217-12" data-line-number="12">us</a>
<a class="sourceLine" id="cb217-13" data-line-number="13"><span class="co">## # A tibble: 141,403 x 6</span></a>
<a class="sourceLine" id="cb217-14" data-line-number="14"><span class="co">##    date       county      state      fips  cases deaths</span></a>
<a class="sourceLine" id="cb217-15" data-line-number="15"><span class="co">##    &lt;date&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb217-16" data-line-number="16"><span class="co">##  1 2020-01-21 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb217-17" data-line-number="17"><span class="co">##  2 2020-01-22 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb217-18" data-line-number="18"><span class="co">##  3 2020-01-23 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb217-19" data-line-number="19"><span class="co">##  4 2020-01-24 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb217-20" data-line-number="20"><span class="co">##  5 2020-01-24 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb217-21" data-line-number="21"><span class="co">##  6 2020-01-25 Orange      California 06059     1      0</span></a>
<a class="sourceLine" id="cb217-22" data-line-number="22"><span class="co">##  7 2020-01-25 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb217-23" data-line-number="23"><span class="co">##  8 2020-01-25 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb217-24" data-line-number="24"><span class="co">##  9 2020-01-26 Maricopa    Arizona    04013     1      0</span></a>
<a class="sourceLine" id="cb217-25" data-line-number="25"><span class="co">## 10 2020-01-26 Los Angeles California 06037     1      0</span></a>
<a class="sourceLine" id="cb217-26" data-line-number="26"><span class="co">## # … with 141,393 more rows</span></a></code></pre></div></li>
<li><p>The <code>us</code> data is now represented as a <code>tibble</code>: a nicer <code>data.frame</code></p></li>
<li><p>Note that</p>
<ul>
<li><code>date</code> has been deduced correctly</li>
<li><code>read_csv()</code> does not coerce inputs to <code>factor</code> (no need to use
<code>stringsAsFactors = FALSE</code>)</li>
<li>The tibble displays nicely (first ten lines, with an indication of total lines)</li>
</ul></li>
</ul>
<p><a href="https://cran.r-project.org/package=dplyr">dplyr</a> for data manipulation</p>
<ul>
<li><p>Load and attach the <a href="https://cran.r-project.org/package=dplyr">dplyr</a> package.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a></code></pre></div></li>
<li><p><a href="https://cran.r-project.org/package=dplyr">dplyr</a> implements a small number of <em>verbs</em> for data transformation</p>
<ul>
<li>A small set of functions that allow very rich data transformation</li>
<li>All have the same first argument – the <code>tibble</code> to be transformed</li>
<li>All allow ‘non-standard’ evaluation – use the variable name without quotes <code>&quot;</code>.</li>
</ul></li>
<li><p><code>filter()</code> rows that meet specific criteria</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1"><span class="kw">filter</span>(us, state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb219-2" data-line-number="2"><span class="co">## # A tibble: 60 x 6</span></a>
<a class="sourceLine" id="cb219-3" data-line-number="3"><span class="co">##    date       county state    fips  cases deaths</span></a>
<a class="sourceLine" id="cb219-4" data-line-number="4"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb219-5" data-line-number="5"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0</span></a>
<a class="sourceLine" id="cb219-6" data-line-number="6"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0</span></a>
<a class="sourceLine" id="cb219-7" data-line-number="7"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb219-8" data-line-number="8"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb219-9" data-line-number="9"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0</span></a>
<a class="sourceLine" id="cb219-10" data-line-number="10"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0</span></a>
<a class="sourceLine" id="cb219-11" data-line-number="11"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0</span></a>
<a class="sourceLine" id="cb219-12" data-line-number="12"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0</span></a>
<a class="sourceLine" id="cb219-13" data-line-number="13"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0</span></a>
<a class="sourceLine" id="cb219-14" data-line-number="14"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0</span></a>
<a class="sourceLine" id="cb219-15" data-line-number="15"><span class="co">## # … with 50 more rows</span></a></code></pre></div></li>
<li><p><a href="https://cran.r-project.org/package=dplyr">dplyr</a> uses the ‘pipe’ <code>%&gt;%</code> as a way to chain data and functions together</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb220-3" data-line-number="3"><span class="co">## # A tibble: 60 x 6</span></a>
<a class="sourceLine" id="cb220-4" data-line-number="4"><span class="co">##    date       county state    fips  cases deaths</span></a>
<a class="sourceLine" id="cb220-5" data-line-number="5"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb220-6" data-line-number="6"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0</span></a>
<a class="sourceLine" id="cb220-7" data-line-number="7"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0</span></a>
<a class="sourceLine" id="cb220-8" data-line-number="8"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb220-9" data-line-number="9"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb220-10" data-line-number="10"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0</span></a>
<a class="sourceLine" id="cb220-11" data-line-number="11"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0</span></a>
<a class="sourceLine" id="cb220-12" data-line-number="12"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0</span></a>
<a class="sourceLine" id="cb220-13" data-line-number="13"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0</span></a>
<a class="sourceLine" id="cb220-14" data-line-number="14"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0</span></a>
<a class="sourceLine" id="cb220-15" data-line-number="15"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0</span></a>
<a class="sourceLine" id="cb220-16" data-line-number="16"><span class="co">## # … with 50 more rows</span></a></code></pre></div>
<ul>
<li><p>The pipe works by transforming whatever is on the left-hand side of the <code>%&gt;%</code> to the first argument of the function on the right-hand side.</p></li>
<li><p>Like <code>filter()</code>, most <a href="https://cran.r-project.org/package=dplyr">dplyr</a> functions take as their first argument a tibble, and return a tibble. So the functions can be chained together, as in the following example.</p></li>
</ul></li>
<li><p><code>select()</code> specific columns</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-3" data-line-number="3"><span class="st">    </span><span class="kw">select</span>(state, county, date, cases)</a>
<a class="sourceLine" id="cb221-4" data-line-number="4"><span class="co">## # A tibble: 60 x 4</span></a>
<a class="sourceLine" id="cb221-5" data-line-number="5"><span class="co">##    state    county date       cases</span></a>
<a class="sourceLine" id="cb221-6" data-line-number="6"><span class="co">##    &lt;chr&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb221-7" data-line-number="7"><span class="co">##  1 New York Erie   2020-03-15     3</span></a>
<a class="sourceLine" id="cb221-8" data-line-number="8"><span class="co">##  2 New York Erie   2020-03-16     6</span></a>
<a class="sourceLine" id="cb221-9" data-line-number="9"><span class="co">##  3 New York Erie   2020-03-17     7</span></a>
<a class="sourceLine" id="cb221-10" data-line-number="10"><span class="co">##  4 New York Erie   2020-03-18     7</span></a>
<a class="sourceLine" id="cb221-11" data-line-number="11"><span class="co">##  5 New York Erie   2020-03-19    28</span></a>
<a class="sourceLine" id="cb221-12" data-line-number="12"><span class="co">##  6 New York Erie   2020-03-20    31</span></a>
<a class="sourceLine" id="cb221-13" data-line-number="13"><span class="co">##  7 New York Erie   2020-03-21    38</span></a>
<a class="sourceLine" id="cb221-14" data-line-number="14"><span class="co">##  8 New York Erie   2020-03-22    54</span></a>
<a class="sourceLine" id="cb221-15" data-line-number="15"><span class="co">##  9 New York Erie   2020-03-23    87</span></a>
<a class="sourceLine" id="cb221-16" data-line-number="16"><span class="co">## 10 New York Erie   2020-03-24   107</span></a>
<a class="sourceLine" id="cb221-17" data-line-number="17"><span class="co">## # … with 50 more rows</span></a></code></pre></div></li>
</ul>
<p>Other common verbs (see tomorrow’s quarantine)</p>
<ul>
<li><code>mutate()</code> (add or update) columns</li>
<li><code>summarize()</code> one or more columns</li>
<li><code>group_by()</code> one or more variables when performing computations. <code>ungroup()</code> removes the grouping.</li>
<li><code>arrange()</code> rows based on values in particular column(s); <code>desc()</code> in descending order.</li>
<li><code>count()</code> the number of times values occur</li>
</ul>
<p>Other ‘tidyverse’ packages</p>
<ul>
<li><p>Packages adopting the ‘tidy’ approach to data representation and management are sometimes referred to as the <a href="https://www.tidyverse.org/">tidyverse</a>.</p></li>
<li><p><a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> implements high-quality data visualization in a way consistent with tidy data representations.</p></li>
<li><p>The <a href="https://cran.r-project.org/package=tidyr">tidyr</a> package implements functions that help to transform data to ‘tidy’ format; we’ll use <code>pivot_longer()</code> later in the week.</p></li>
</ul>
</div>
</div>
<div id="day-16-key-tidyverse-packages-readr-and-dplyr" class="section level2">
<h2><span class="header-section-number">3.2</span> Day 16 Key tidyverse packages: <a href="https://cran.r-project.org/package=readr">readr</a> and <a href="https://cran.r-project.org/package=dplyr">dplyr</a></h2>
<p>Start a script for today. In the script</p>
<ul>
<li><p>Load the libraries that we will use</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb222-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a></code></pre></div></li>
<li><p>If <em>R</em> responds with (similarly for <a href="https://cran.r-project.org/package=dplyr">dplyr</a>)</p>
<pre><code>Error in library(readr) : there is no package called &#39;readr&#39;</code></pre>
<p>then you’ll need to install (just once per <em>R</em> installation) the <a href="https://cran.r-project.org/package=readr">readr</a> pacakge</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;readr&quot;</span>, <span class="dt">repos =</span> <span class="st">&quot;https://cran.r-project.org&quot;</span>)</a></code></pre></div></li>
</ul>
<p>Work through the following commands, adding appropriate lines to your script</p>
<ul>
<li><p>Read US COVID data. N.B., <code>readr::read_csv()</code> rather than <code>read.csv()</code></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb225-2" data-line-number="2">us &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url)</a>
<a class="sourceLine" id="cb225-3" data-line-number="3"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb225-4" data-line-number="4"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb225-5" data-line-number="5"><span class="co">##   date = col_date(format = &quot;&quot;),</span></a>
<a class="sourceLine" id="cb225-6" data-line-number="6"><span class="co">##   county = col_character(),</span></a>
<a class="sourceLine" id="cb225-7" data-line-number="7"><span class="co">##   state = col_character(),</span></a>
<a class="sourceLine" id="cb225-8" data-line-number="8"><span class="co">##   fips = col_character(),</span></a>
<a class="sourceLine" id="cb225-9" data-line-number="9"><span class="co">##   cases = col_double(),</span></a>
<a class="sourceLine" id="cb225-10" data-line-number="10"><span class="co">##   deaths = col_double()</span></a>
<a class="sourceLine" id="cb225-11" data-line-number="11"><span class="co">## )</span></a>
<a class="sourceLine" id="cb225-12" data-line-number="12">us</a>
<a class="sourceLine" id="cb225-13" data-line-number="13"><span class="co">## # A tibble: 141,403 x 6</span></a>
<a class="sourceLine" id="cb225-14" data-line-number="14"><span class="co">##    date       county      state      fips  cases deaths</span></a>
<a class="sourceLine" id="cb225-15" data-line-number="15"><span class="co">##    &lt;date&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb225-16" data-line-number="16"><span class="co">##  1 2020-01-21 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb225-17" data-line-number="17"><span class="co">##  2 2020-01-22 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb225-18" data-line-number="18"><span class="co">##  3 2020-01-23 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb225-19" data-line-number="19"><span class="co">##  4 2020-01-24 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb225-20" data-line-number="20"><span class="co">##  5 2020-01-24 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb225-21" data-line-number="21"><span class="co">##  6 2020-01-25 Orange      California 06059     1      0</span></a>
<a class="sourceLine" id="cb225-22" data-line-number="22"><span class="co">##  7 2020-01-25 Cook        Illinois   17031     1      0</span></a>
<a class="sourceLine" id="cb225-23" data-line-number="23"><span class="co">##  8 2020-01-25 Snohomish   Washington 53061     1      0</span></a>
<a class="sourceLine" id="cb225-24" data-line-number="24"><span class="co">##  9 2020-01-26 Maricopa    Arizona    04013     1      0</span></a>
<a class="sourceLine" id="cb225-25" data-line-number="25"><span class="co">## 10 2020-01-26 Los Angeles California 06037     1      0</span></a>
<a class="sourceLine" id="cb225-26" data-line-number="26"><span class="co">## # … with 141,393 more rows</span></a></code></pre></div></li>
<li><p><code>filter()</code> rows that meet specific criteria</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb226-3" data-line-number="3"><span class="co">## # A tibble: 60 x 6</span></a>
<a class="sourceLine" id="cb226-4" data-line-number="4"><span class="co">##    date       county state    fips  cases deaths</span></a>
<a class="sourceLine" id="cb226-5" data-line-number="5"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb226-6" data-line-number="6"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0</span></a>
<a class="sourceLine" id="cb226-7" data-line-number="7"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0</span></a>
<a class="sourceLine" id="cb226-8" data-line-number="8"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb226-9" data-line-number="9"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0</span></a>
<a class="sourceLine" id="cb226-10" data-line-number="10"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0</span></a>
<a class="sourceLine" id="cb226-11" data-line-number="11"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0</span></a>
<a class="sourceLine" id="cb226-12" data-line-number="12"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0</span></a>
<a class="sourceLine" id="cb226-13" data-line-number="13"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0</span></a>
<a class="sourceLine" id="cb226-14" data-line-number="14"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0</span></a>
<a class="sourceLine" id="cb226-15" data-line-number="15"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0</span></a>
<a class="sourceLine" id="cb226-16" data-line-number="16"><span class="co">## # … with 50 more rows</span></a></code></pre></div></li>
<li><p><code>select()</code> specific columns</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-2" data-line-number="2"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-3" data-line-number="3"><span class="st">    </span><span class="kw">select</span>(state, county, date, cases)</a>
<a class="sourceLine" id="cb227-4" data-line-number="4"><span class="co">## # A tibble: 60 x 4</span></a>
<a class="sourceLine" id="cb227-5" data-line-number="5"><span class="co">##    state    county date       cases</span></a>
<a class="sourceLine" id="cb227-6" data-line-number="6"><span class="co">##    &lt;chr&gt;    &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb227-7" data-line-number="7"><span class="co">##  1 New York Erie   2020-03-15     3</span></a>
<a class="sourceLine" id="cb227-8" data-line-number="8"><span class="co">##  2 New York Erie   2020-03-16     6</span></a>
<a class="sourceLine" id="cb227-9" data-line-number="9"><span class="co">##  3 New York Erie   2020-03-17     7</span></a>
<a class="sourceLine" id="cb227-10" data-line-number="10"><span class="co">##  4 New York Erie   2020-03-18     7</span></a>
<a class="sourceLine" id="cb227-11" data-line-number="11"><span class="co">##  5 New York Erie   2020-03-19    28</span></a>
<a class="sourceLine" id="cb227-12" data-line-number="12"><span class="co">##  6 New York Erie   2020-03-20    31</span></a>
<a class="sourceLine" id="cb227-13" data-line-number="13"><span class="co">##  7 New York Erie   2020-03-21    38</span></a>
<a class="sourceLine" id="cb227-14" data-line-number="14"><span class="co">##  8 New York Erie   2020-03-22    54</span></a>
<a class="sourceLine" id="cb227-15" data-line-number="15"><span class="co">##  9 New York Erie   2020-03-23    87</span></a>
<a class="sourceLine" id="cb227-16" data-line-number="16"><span class="co">## 10 New York Erie   2020-03-24   107</span></a>
<a class="sourceLine" id="cb227-17" data-line-number="17"><span class="co">## # … with 50 more rows</span></a></code></pre></div></li>
<li><p><code>mutate()</code> (add or update) columns</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">erie &lt;-</a>
<a class="sourceLine" id="cb228-2" data-line-number="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>, county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>)</a>
<a class="sourceLine" id="cb228-4" data-line-number="4">erie <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-5" data-line-number="5"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases)))</a>
<a class="sourceLine" id="cb228-6" data-line-number="6"><span class="co">## # A tibble: 60 x 7</span></a>
<a class="sourceLine" id="cb228-7" data-line-number="7"><span class="co">##    date       county state    fips  cases deaths new_cases</span></a>
<a class="sourceLine" id="cb228-8" data-line-number="8"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb228-9" data-line-number="9"><span class="co">##  1 2020-03-15 Erie   New York 36029     3      0         3</span></a>
<a class="sourceLine" id="cb228-10" data-line-number="10"><span class="co">##  2 2020-03-16 Erie   New York 36029     6      0         3</span></a>
<a class="sourceLine" id="cb228-11" data-line-number="11"><span class="co">##  3 2020-03-17 Erie   New York 36029     7      0         1</span></a>
<a class="sourceLine" id="cb228-12" data-line-number="12"><span class="co">##  4 2020-03-18 Erie   New York 36029     7      0         0</span></a>
<a class="sourceLine" id="cb228-13" data-line-number="13"><span class="co">##  5 2020-03-19 Erie   New York 36029    28      0        21</span></a>
<a class="sourceLine" id="cb228-14" data-line-number="14"><span class="co">##  6 2020-03-20 Erie   New York 36029    31      0         3</span></a>
<a class="sourceLine" id="cb228-15" data-line-number="15"><span class="co">##  7 2020-03-21 Erie   New York 36029    38      0         7</span></a>
<a class="sourceLine" id="cb228-16" data-line-number="16"><span class="co">##  8 2020-03-22 Erie   New York 36029    54      0        16</span></a>
<a class="sourceLine" id="cb228-17" data-line-number="17"><span class="co">##  9 2020-03-23 Erie   New York 36029    87      0        33</span></a>
<a class="sourceLine" id="cb228-18" data-line-number="18"><span class="co">## 10 2020-03-24 Erie   New York 36029   107      0        20</span></a>
<a class="sourceLine" id="cb228-19" data-line-number="19"><span class="co">## # … with 50 more rows</span></a></code></pre></div></li>
<li><p><code>summarize()</code> one or more columns</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1">erie <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb229-2" data-line-number="2"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb229-3" data-line-number="3"><span class="st">    </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb229-4" data-line-number="4">        <span class="dt">duration =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb229-5" data-line-number="5">        <span class="dt">total_cases =</span> <span class="kw">max</span>(cases),</a>
<a class="sourceLine" id="cb229-6" data-line-number="6">        <span class="dt">max_new_cases_per_day =</span> <span class="kw">max</span>(new_cases),</a>
<a class="sourceLine" id="cb229-7" data-line-number="7">        <span class="dt">mean_new_cases_per_day =</span> <span class="kw">mean</span>(new_cases),</a>
<a class="sourceLine" id="cb229-8" data-line-number="8">        <span class="dt">median_new_cases_per_day =</span> <span class="kw">median</span>(new_cases)</a>
<a class="sourceLine" id="cb229-9" data-line-number="9">    )</a>
<a class="sourceLine" id="cb229-10" data-line-number="10"><span class="co">## # A tibble: 1 x 5</span></a>
<a class="sourceLine" id="cb229-11" data-line-number="11"><span class="co">##   duration total_cases max_new_cases_per… mean_new_cases_per… median_new_cases_…</span></a>
<a class="sourceLine" id="cb229-12" data-line-number="12"><span class="co">##      &lt;int&gt;       &lt;dbl&gt;              &lt;dbl&gt;               &lt;dbl&gt;              &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb229-13" data-line-number="13"><span class="co">## 1       60        4606                217                76.8               74.5</span></a></code></pre></div></li>
<li><p><code>group_by()</code> one or more variables when performing computations</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">us_county_cases &lt;-</a>
<a class="sourceLine" id="cb230-2" data-line-number="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-4" data-line-number="4"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_cases =</span> <span class="kw">max</span>(cases))</a>
<a class="sourceLine" id="cb230-5" data-line-number="5"></a>
<a class="sourceLine" id="cb230-6" data-line-number="6">us_state_cases &lt;-</a>
<a class="sourceLine" id="cb230-7" data-line-number="7"><span class="st">    </span>us_county_cases <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-8" data-line-number="8"><span class="st">    </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-9" data-line-number="9"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases))</a></code></pre></div></li>
<li><p><code>arrange()</code> based on a particular column; <code>desc()</code> in descending order.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">us_county_cases <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_cases))</a>
<a class="sourceLine" id="cb231-3" data-line-number="3"><span class="co">## # A tibble: 2,937 x 3</span></a>
<a class="sourceLine" id="cb231-4" data-line-number="4"><span class="co">## # Groups:   county [1,717]</span></a>
<a class="sourceLine" id="cb231-5" data-line-number="5"><span class="co">##    county        state         total_cases</span></a>
<a class="sourceLine" id="cb231-6" data-line-number="6"><span class="co">##    &lt;chr&gt;         &lt;chr&gt;               &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb231-7" data-line-number="7"><span class="co">##  1 New York City New York           192394</span></a>
<a class="sourceLine" id="cb231-8" data-line-number="8"><span class="co">##  2 Cook          Illinois            56406</span></a>
<a class="sourceLine" id="cb231-9" data-line-number="9"><span class="co">##  3 Nassau        New York            38587</span></a>
<a class="sourceLine" id="cb231-10" data-line-number="10"><span class="co">##  4 Suffolk       New York            37305</span></a>
<a class="sourceLine" id="cb231-11" data-line-number="11"><span class="co">##  5 Los Angeles   California          34428</span></a>
<a class="sourceLine" id="cb231-12" data-line-number="12"><span class="co">##  6 Westchester   New York            31610</span></a>
<a class="sourceLine" id="cb231-13" data-line-number="13"><span class="co">##  7 Philadelphia  Pennsylvania        18779</span></a>
<a class="sourceLine" id="cb231-14" data-line-number="14"><span class="co">##  8 Wayne         Michigan            18389</span></a>
<a class="sourceLine" id="cb231-15" data-line-number="15"><span class="co">##  9 Middlesex     Massachusetts       18201</span></a>
<a class="sourceLine" id="cb231-16" data-line-number="16"><span class="co">## 10 Bergen        New Jersey          17150</span></a>
<a class="sourceLine" id="cb231-17" data-line-number="17"><span class="co">## # … with 2,927 more rows</span></a>
<a class="sourceLine" id="cb231-18" data-line-number="18"></a>
<a class="sourceLine" id="cb231-19" data-line-number="19">us_state_cases <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-20" data-line-number="20"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(total_cases))</a>
<a class="sourceLine" id="cb231-21" data-line-number="21"><span class="co">## # A tibble: 55 x 2</span></a>
<a class="sourceLine" id="cb231-22" data-line-number="22"><span class="co">##    state         total_cases</span></a>
<a class="sourceLine" id="cb231-23" data-line-number="23"><span class="co">##    &lt;chr&gt;               &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb231-24" data-line-number="24"><span class="co">##  1 New York           347919</span></a>
<a class="sourceLine" id="cb231-25" data-line-number="25"><span class="co">##  2 New Jersey         145764</span></a>
<a class="sourceLine" id="cb231-26" data-line-number="26"><span class="co">##  3 Illinois            85260</span></a>
<a class="sourceLine" id="cb231-27" data-line-number="27"><span class="co">##  4 Massachusetts       81214</span></a>
<a class="sourceLine" id="cb231-28" data-line-number="28"><span class="co">##  5 California          73250</span></a>
<a class="sourceLine" id="cb231-29" data-line-number="29"><span class="co">##  6 Pennsylvania        62211</span></a>
<a class="sourceLine" id="cb231-30" data-line-number="30"><span class="co">##  7 Michigan            48366</span></a>
<a class="sourceLine" id="cb231-31" data-line-number="31"><span class="co">##  8 Texas               43863</span></a>
<a class="sourceLine" id="cb231-32" data-line-number="32"><span class="co">##  9 Florida             42424</span></a>
<a class="sourceLine" id="cb231-33" data-line-number="33"><span class="co">## 10 Connecticut         35142</span></a>
<a class="sourceLine" id="cb231-34" data-line-number="34"><span class="co">## # … with 45 more rows</span></a></code></pre></div></li>
<li><p><code>count()</code> the number of times values occur (duration of the pandemic?)</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-2" data-line-number="2"><span class="st">    </span><span class="kw">count</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-3" data-line-number="3"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a>
<a class="sourceLine" id="cb232-4" data-line-number="4"><span class="co">## # A tibble: 2,937 x 3</span></a>
<a class="sourceLine" id="cb232-5" data-line-number="5"><span class="co">##    county        state             n</span></a>
<a class="sourceLine" id="cb232-6" data-line-number="6"><span class="co">##    &lt;chr&gt;         &lt;chr&gt;         &lt;int&gt;</span></a>
<a class="sourceLine" id="cb232-7" data-line-number="7"><span class="co">##  1 Snohomish     Washington      114</span></a>
<a class="sourceLine" id="cb232-8" data-line-number="8"><span class="co">##  2 Cook          Illinois        111</span></a>
<a class="sourceLine" id="cb232-9" data-line-number="9"><span class="co">##  3 Orange        California      110</span></a>
<a class="sourceLine" id="cb232-10" data-line-number="10"><span class="co">##  4 Los Angeles   California      109</span></a>
<a class="sourceLine" id="cb232-11" data-line-number="11"><span class="co">##  5 Maricopa      Arizona         109</span></a>
<a class="sourceLine" id="cb232-12" data-line-number="12"><span class="co">##  6 Santa Clara   California      104</span></a>
<a class="sourceLine" id="cb232-13" data-line-number="13"><span class="co">##  7 Suffolk       Massachusetts   103</span></a>
<a class="sourceLine" id="cb232-14" data-line-number="14"><span class="co">##  8 San Francisco California      102</span></a>
<a class="sourceLine" id="cb232-15" data-line-number="15"><span class="co">##  9 Dane          Wisconsin        99</span></a>
<a class="sourceLine" id="cb232-16" data-line-number="16"><span class="co">## 10 San Diego     California       94</span></a>
<a class="sourceLine" id="cb232-17" data-line-number="17"><span class="co">## # … with 2,927 more rows</span></a></code></pre></div></li>
</ul>
</div>
<div id="day-17-visualization-with-ggplot2" class="section level2">
<h2><span class="header-section-number">3.3</span> Day 17 Visualization with <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a></h2>
<div id="setup" class="section level3 unnumbered">
<h3>Setup</h3>
<p>Load packages we’ll use today</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb233-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb233-3" data-line-number="3"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb233-4" data-line-number="4"><span class="kw">library</span>(tidyr)</a></code></pre></div>
<p>Remember that packages need to be installed before loading; if you see…</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb234-2" data-line-number="2"><span class="co">## Error in library(ggplot2) : there is no package called &#39;ggplot2&#39;</span></a></code></pre></div>
<p>…then you’ll need to install the package and try again</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>, <span class="dt">repos =</span> <span class="st">&quot;https://cran.r-project.org&quot;</span>)</a>
<a class="sourceLine" id="cb235-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
<p>Input data using <code>readr::read_csv()</code></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb236-2" data-line-number="2">us &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url)</a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb236-5" data-line-number="5"><span class="co">##   date = col_date(format = &quot;&quot;),</span></a>
<a class="sourceLine" id="cb236-6" data-line-number="6"><span class="co">##   county = col_character(),</span></a>
<a class="sourceLine" id="cb236-7" data-line-number="7"><span class="co">##   state = col_character(),</span></a>
<a class="sourceLine" id="cb236-8" data-line-number="8"><span class="co">##   fips = col_character(),</span></a>
<a class="sourceLine" id="cb236-9" data-line-number="9"><span class="co">##   cases = col_double(),</span></a>
<a class="sourceLine" id="cb236-10" data-line-number="10"><span class="co">##   deaths = col_double()</span></a>
<a class="sourceLine" id="cb236-11" data-line-number="11"><span class="co">## )</span></a></code></pre></div>
<p>Create the Erie county subset, with columns <code>new_cases</code> and <code>new_deaths</code></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">erie &lt;-</a>
<a class="sourceLine" id="cb237-2" data-line-number="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb237-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>, state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb237-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb237-5" data-line-number="5">        <span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases)),</a>
<a class="sourceLine" id="cb237-6" data-line-number="6">        <span class="dt">new_deaths =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, deaths))</a>
<a class="sourceLine" id="cb237-7" data-line-number="7">    )</a></code></pre></div>
</div>
<div id="ggplot2-essentials" class="section level3 unnumbered">
<h3><a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> essentials</h3>
<p>The ‘gg’ in <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a></p>
<ul>
<li><p>‘<a href="https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448">Grammar of Graphics</a>’ – a formal, scholarly system for describing and creating graphics.</p></li>
<li><p>See the <a href="https://ggplot2.tidyverse.org/">usage guide</a>, and the <a href="https://r4ds.had.co.nz/data-visualisation.html">data visualization</a> chapter of <a href="https://r4ds.had.co.nz/">R for Data Science</a>.</p></li>
<li><p>The <a href="https://ggplot2.tidyverse.org/reference/index.html">reference</a> section of the usage guide provides a good entry point</p></li>
</ul>
<p>A first plot</p>
<ul>
<li><p>Specify the data to use. Do this by (a) providing the tibble containing the data (<code>erie</code>) and (b) communicating the ‘aesthetics’ of the overall graph by specifying the <code>x</code> and <code>y</code> data columns – <code>ggplot(erie, aes(x = date, y = new_cases))</code></p></li>
<li><p>Add a <code>geom_</code> describing the geometric object used to represent the data, e.g., use <code>geom_point()</code> to represent the data as points.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1"><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb238-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p></li>
<li><p>Note that the plot is assembled by adding elements using a simple <code>+</code>. Connect the points with <code>geom_line()</code>.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1"><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb239-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb239-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p></li>
<li><p>Plots can actually be captured in a variable, e.g., <code>p</code></p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb240-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p>… and then updated and displayed</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">p <span class="op">+</span></a>
<a class="sourceLine" id="cb241-2" data-line-number="2"><span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Date (2020)&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb241-3" data-line-number="3"><span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Cummulative cases&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb241-4" data-line-number="4"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cases, Erie County, New York&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p></li>
<li><p>Arguments to each <code>geom</code> influece how the geometry is displayed, e.g.,</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">p <span class="op">+</span></a>
<a class="sourceLine" id="cb242-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p></li>
</ul>
</div>
<div id="covid-19-in-erie-county" class="section level3 unnumbered">
<h3>COVID-19 in Erie county</h3>
<p>New cases</p>
<ul>
<li><p>Create a base plot using <code>new_cases)</code></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, new_cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb243-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div></li>
<li><p>Visualize on a linear and a log-transformed y-axis</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">p <span class="co"># linear</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()</a>
<a class="sourceLine" id="cb245-2" data-line-number="2"><span class="co">## Warning in self$trans$transform(x): NaNs produced</span></a>
<a class="sourceLine" id="cb245-3" data-line-number="3"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb245-4" data-line-number="4"><span class="co">## Warning: Removed 1 rows containing missing values (geom_point).</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-37-2.png" width="672" /></p>
<p>Add a smoothed line to the plot. By default the smoothed line is a local regression appropriate for exploratory data analysis. Note the confidence bands displayed in the plot, and how they convey a measure of certainty about the fit.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">p <span class="op">+</span></a>
<a class="sourceLine" id="cb246-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb246-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_smooth</span>()</a>
<a class="sourceLine" id="cb246-4" data-line-number="4"><span class="co">## Warning in self$trans$transform(x): NaNs produced</span></a>
<a class="sourceLine" id="cb246-5" data-line-number="5"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb246-6" data-line-number="6"><span class="co">## Warning in self$trans$transform(x): NaNs produced</span></a>
<a class="sourceLine" id="cb246-7" data-line-number="7"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb246-8" data-line-number="8"><span class="co">## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></a>
<a class="sourceLine" id="cb246-9" data-line-number="9"><span class="co">## Warning: Removed 3 rows containing non-finite values (stat_smooth).</span></a>
<a class="sourceLine" id="cb246-10" data-line-number="10"><span class="co">## Warning: Removed 1 rows containing missing values (geom_point).</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p></li>
<li><p>Reflect on the presentation of data, especially how log-transformation and a clarifies our impression of the local progress of the pandemic.</p></li>
<li><p>The local regression used by <code>geom_smooth()</code> can be replaced by a linear regressin with <code>geom_smooth(method = &quot;lm&quot;)</code>. Create this plot and reflect on the assumptions and suitability of a linear model for this data.</p></li>
</ul>
<p>New cases and mortality</p>
<ul>
<li><p>It’s easy to separately plot <code>deaths</code> by updating the aesthetic in <code>ggplot()</code></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1"><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, deaths)) <span class="op">+</span></a>
<a class="sourceLine" id="cb247-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb247-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb247-4" data-line-number="4"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p></li>
<li><p>What about ploting cases and deaths? Move the <code>aes()</code> argument to the individual geometries. Use different colors for each geometry</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1"><span class="kw">ggplot</span>(erie) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb248-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(date, cases), <span class="dt">shape =</span> <span class="st">&quot;|&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(date, cases), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(date, deaths), <span class="dt">shape =</span> <span class="st">&quot;|&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb248-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(date, deaths))</a>
<a class="sourceLine" id="cb248-7" data-line-number="7"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb248-8" data-line-number="8"></a>
<a class="sourceLine" id="cb248-9" data-line-number="9"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Deaths lag behind cases by a week or so.</p></li>
</ul>
<p>‘Long’ data and an alternative approach to plotting multiple curves.</p>
<ul>
<li><p>Let’s simplify the data to just the columns of interest for this exercise</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">simple &lt;-</a>
<a class="sourceLine" id="cb249-2" data-line-number="2"><span class="st">    </span>erie <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-3" data-line-number="3"><span class="st">    </span><span class="kw">select</span>(date, cases, deaths)</a>
<a class="sourceLine" id="cb249-4" data-line-number="4">simple</a>
<a class="sourceLine" id="cb249-5" data-line-number="5"><span class="co">## # A tibble: 60 x 3</span></a>
<a class="sourceLine" id="cb249-6" data-line-number="6"><span class="co">##    date       cases deaths</span></a>
<a class="sourceLine" id="cb249-7" data-line-number="7"><span class="co">##    &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb249-8" data-line-number="8"><span class="co">##  1 2020-03-15     3      0</span></a>
<a class="sourceLine" id="cb249-9" data-line-number="9"><span class="co">##  2 2020-03-16     6      0</span></a>
<a class="sourceLine" id="cb249-10" data-line-number="10"><span class="co">##  3 2020-03-17     7      0</span></a>
<a class="sourceLine" id="cb249-11" data-line-number="11"><span class="co">##  4 2020-03-18     7      0</span></a>
<a class="sourceLine" id="cb249-12" data-line-number="12"><span class="co">##  5 2020-03-19    28      0</span></a>
<a class="sourceLine" id="cb249-13" data-line-number="13"><span class="co">##  6 2020-03-20    31      0</span></a>
<a class="sourceLine" id="cb249-14" data-line-number="14"><span class="co">##  7 2020-03-21    38      0</span></a>
<a class="sourceLine" id="cb249-15" data-line-number="15"><span class="co">##  8 2020-03-22    54      0</span></a>
<a class="sourceLine" id="cb249-16" data-line-number="16"><span class="co">##  9 2020-03-23    87      0</span></a>
<a class="sourceLine" id="cb249-17" data-line-number="17"><span class="co">## 10 2020-03-24   107      0</span></a>
<a class="sourceLine" id="cb249-18" data-line-number="18"><span class="co">## # … with 50 more rows</span></a></code></pre></div></li>
<li><p>Use <code>tidyr::pivot_longer()</code> to transform the two columns ‘cases’ and ‘deaths’ into a column that indicates ‘name’ and ‘value’; ‘name’ is ‘cases’ when the corresponding ‘value’ came from the ‘cases’ column, and similarly for ‘deaths’. See the help page <code>?tidyr::pivot_longer</code> and tomorrow’s exercises for more on <code>pivot_longer()</code>.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">longer &lt;-</a>
<a class="sourceLine" id="cb250-2" data-line-number="2"><span class="st">    </span>simple <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-3" data-line-number="3"><span class="st">    </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb250-4" data-line-number="4">        <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;deaths&quot;</span>),</a>
<a class="sourceLine" id="cb250-5" data-line-number="5">        <span class="dt">names_to =</span> <span class="st">&quot;metric&quot;</span>,</a>
<a class="sourceLine" id="cb250-6" data-line-number="6">        <span class="dt">values_to =</span> <span class="st">&quot;count&quot;</span></a>
<a class="sourceLine" id="cb250-7" data-line-number="7">    )</a>
<a class="sourceLine" id="cb250-8" data-line-number="8">longer</a>
<a class="sourceLine" id="cb250-9" data-line-number="9"><span class="co">## # A tibble: 120 x 3</span></a>
<a class="sourceLine" id="cb250-10" data-line-number="10"><span class="co">##    date       metric count</span></a>
<a class="sourceLine" id="cb250-11" data-line-number="11"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb250-12" data-line-number="12"><span class="co">##  1 2020-03-15 cases      3</span></a>
<a class="sourceLine" id="cb250-13" data-line-number="13"><span class="co">##  2 2020-03-15 deaths     0</span></a>
<a class="sourceLine" id="cb250-14" data-line-number="14"><span class="co">##  3 2020-03-16 cases      6</span></a>
<a class="sourceLine" id="cb250-15" data-line-number="15"><span class="co">##  4 2020-03-16 deaths     0</span></a>
<a class="sourceLine" id="cb250-16" data-line-number="16"><span class="co">##  5 2020-03-17 cases      7</span></a>
<a class="sourceLine" id="cb250-17" data-line-number="17"><span class="co">##  6 2020-03-17 deaths     0</span></a>
<a class="sourceLine" id="cb250-18" data-line-number="18"><span class="co">##  7 2020-03-18 cases      7</span></a>
<a class="sourceLine" id="cb250-19" data-line-number="19"><span class="co">##  8 2020-03-18 deaths     0</span></a>
<a class="sourceLine" id="cb250-20" data-line-number="20"><span class="co">##  9 2020-03-19 cases     28</span></a>
<a class="sourceLine" id="cb250-21" data-line-number="21"><span class="co">## 10 2020-03-19 deaths     0</span></a>
<a class="sourceLine" id="cb250-22" data-line-number="22"><span class="co">## # … with 110 more rows</span></a></code></pre></div></li>
<li><p>Plot <code>date</code> and <code>value, coloring points by</code>name`</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1"><span class="kw">ggplot</span>(longer, <span class="kw">aes</span>(date, count, <span class="dt">color =</span> metric)) <span class="op">+</span></a>
<a class="sourceLine" id="cb251-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb251-4" data-line-number="4"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p></li>
</ul>
</div>
<div id="covid-19-in-new-york-state" class="section level3 unnumbered">
<h3>COVID-19 in New York State</h3>
<p>We’ll explore ‘facet’ visualizations, which create a panel of related plots</p>
<p>Setup</p>
<ul>
<li><p>From the US data, extract Erie and Westchester counties and New York City. Use <code>coi</code> (‘counties of interest’) as a variable to hold this data</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" data-line-number="1">coi &lt;-</a>
<a class="sourceLine" id="cb252-2" data-line-number="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb252-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb252-4" data-line-number="4">        county <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Erie&quot;</span>, <span class="st">&quot;Westchester&quot;</span>, <span class="st">&quot;New York City&quot;</span>),</a>
<a class="sourceLine" id="cb252-5" data-line-number="5">        state <span class="op">==</span><span class="st"> &quot;New York&quot;</span></a>
<a class="sourceLine" id="cb252-6" data-line-number="6">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb252-7" data-line-number="7"><span class="st">    </span><span class="kw">select</span>(date, county, cases, deaths)</a>
<a class="sourceLine" id="cb252-8" data-line-number="8">coi</a>
<a class="sourceLine" id="cb252-9" data-line-number="9"><span class="co">## # A tibble: 205 x 4</span></a>
<a class="sourceLine" id="cb252-10" data-line-number="10"><span class="co">##    date       county        cases deaths</span></a>
<a class="sourceLine" id="cb252-11" data-line-number="11"><span class="co">##    &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb252-12" data-line-number="12"><span class="co">##  1 2020-03-01 New York City     1      0</span></a>
<a class="sourceLine" id="cb252-13" data-line-number="13"><span class="co">##  2 2020-03-02 New York City     1      0</span></a>
<a class="sourceLine" id="cb252-14" data-line-number="14"><span class="co">##  3 2020-03-03 New York City     2      0</span></a>
<a class="sourceLine" id="cb252-15" data-line-number="15"><span class="co">##  4 2020-03-04 New York City     2      0</span></a>
<a class="sourceLine" id="cb252-16" data-line-number="16"><span class="co">##  5 2020-03-04 Westchester       9      0</span></a>
<a class="sourceLine" id="cb252-17" data-line-number="17"><span class="co">##  6 2020-03-05 New York City     4      0</span></a>
<a class="sourceLine" id="cb252-18" data-line-number="18"><span class="co">##  7 2020-03-05 Westchester      17      0</span></a>
<a class="sourceLine" id="cb252-19" data-line-number="19"><span class="co">##  8 2020-03-06 New York City     5      0</span></a>
<a class="sourceLine" id="cb252-20" data-line-number="20"><span class="co">##  9 2020-03-06 Westchester      33      0</span></a>
<a class="sourceLine" id="cb252-21" data-line-number="21"><span class="co">## 10 2020-03-07 New York City    12      0</span></a>
<a class="sourceLine" id="cb252-22" data-line-number="22"><span class="co">## # … with 195 more rows</span></a></code></pre></div></li>
<li><p>Pivot <code>cases</code> and <code>deaths</code> into long form</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">coi_longer &lt;-</a>
<a class="sourceLine" id="cb253-2" data-line-number="2"><span class="st">    </span>coi <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-3" data-line-number="3"><span class="st">    </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb253-4" data-line-number="4">        <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;deaths&quot;</span>),</a>
<a class="sourceLine" id="cb253-5" data-line-number="5">        <span class="dt">names_to =</span> <span class="st">&quot;metric&quot;</span>,</a>
<a class="sourceLine" id="cb253-6" data-line-number="6">        <span class="dt">values_to =</span> <span class="st">&quot;count&quot;</span></a>
<a class="sourceLine" id="cb253-7" data-line-number="7">    )</a>
<a class="sourceLine" id="cb253-8" data-line-number="8">coi_longer</a>
<a class="sourceLine" id="cb253-9" data-line-number="9"><span class="co">## # A tibble: 410 x 4</span></a>
<a class="sourceLine" id="cb253-10" data-line-number="10"><span class="co">##    date       county        metric count</span></a>
<a class="sourceLine" id="cb253-11" data-line-number="11"><span class="co">##    &lt;date&gt;     &lt;chr&gt;         &lt;chr&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb253-12" data-line-number="12"><span class="co">##  1 2020-03-01 New York City cases      1</span></a>
<a class="sourceLine" id="cb253-13" data-line-number="13"><span class="co">##  2 2020-03-01 New York City deaths     0</span></a>
<a class="sourceLine" id="cb253-14" data-line-number="14"><span class="co">##  3 2020-03-02 New York City cases      1</span></a>
<a class="sourceLine" id="cb253-15" data-line-number="15"><span class="co">##  4 2020-03-02 New York City deaths     0</span></a>
<a class="sourceLine" id="cb253-16" data-line-number="16"><span class="co">##  5 2020-03-03 New York City cases      2</span></a>
<a class="sourceLine" id="cb253-17" data-line-number="17"><span class="co">##  6 2020-03-03 New York City deaths     0</span></a>
<a class="sourceLine" id="cb253-18" data-line-number="18"><span class="co">##  7 2020-03-04 New York City cases      2</span></a>
<a class="sourceLine" id="cb253-19" data-line-number="19"><span class="co">##  8 2020-03-04 New York City deaths     0</span></a>
<a class="sourceLine" id="cb253-20" data-line-number="20"><span class="co">##  9 2020-03-04 Westchester   cases      9</span></a>
<a class="sourceLine" id="cb253-21" data-line-number="21"><span class="co">## 10 2020-03-04 Westchester   deaths     0</span></a>
<a class="sourceLine" id="cb253-22" data-line-number="22"><span class="co">## # … with 400 more rows</span></a></code></pre></div></li>
</ul>
<p>Visualization</p>
<ul>
<li><p>We can plot cases and deaths of each county…</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" data-line-number="1">p &lt;-</a>
<a class="sourceLine" id="cb254-2" data-line-number="2"><span class="st">    </span><span class="kw">ggplot</span>(coi_longer, <span class="kw">aes</span>(date, count, <span class="dt">color =</span> metric)) <span class="op">+</span></a>
<a class="sourceLine" id="cb254-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb254-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb254-5" data-line-number="5">p</a>
<a class="sourceLine" id="cb254-6" data-line-number="6"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>… but this is too confusing.</p></li>
<li><p>Separate each county into a facet</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="dt">rows=</span><span class="kw">vars</span>(county))</a>
<a class="sourceLine" id="cb255-2" data-line-number="2"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-47-1.png" width="672" />
Note the common scales on the x and y axes.</p></li>
<li><p>Plotting counties as ‘rows’ of the graph emphasize temporal comparisons – e.g., the earlier onset of the pandemic in Westchester and New York City compared to Erie, and perhaps longer lag between new cases and deaths in Westchester.</p></li>
<li><p>Plotting countes as ‘columns’ emphasizes comparison between number of cases and deaths – there are many more cases in New York City than in Erie County.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1">p <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="dt">cols=</span><span class="kw">vars</span>(county))</a>
<a class="sourceLine" id="cb256-2" data-line-number="2"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p></li>
</ul>
</div>
<div id="covid-19-nationally" class="section level3 unnumbered">
<h3>COVID-19 nationally</h3>
<p>Setup</p>
<ul>
<li><p>Summarize the total (maximum) number of cases in each county and state</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">county_summary &lt;-</a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-4" data-line-number="4"><span class="st">    </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb257-5" data-line-number="5">        <span class="dt">cases =</span> <span class="kw">max</span>(cases),</a>
<a class="sourceLine" id="cb257-6" data-line-number="6">        <span class="dt">deaths =</span> <span class="kw">max</span>(deaths)</a>
<a class="sourceLine" id="cb257-7" data-line-number="7">    )</a>
<a class="sourceLine" id="cb257-8" data-line-number="8">county_summary</a>
<a class="sourceLine" id="cb257-9" data-line-number="9"><span class="co">## # A tibble: 2,937 x 4</span></a>
<a class="sourceLine" id="cb257-10" data-line-number="10"><span class="co">## # Groups:   county [1,717]</span></a>
<a class="sourceLine" id="cb257-11" data-line-number="11"><span class="co">##    county    state          cases deaths</span></a>
<a class="sourceLine" id="cb257-12" data-line-number="12"><span class="co">##    &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb257-13" data-line-number="13"><span class="co">##  1 Abbeville South Carolina    34      0</span></a>
<a class="sourceLine" id="cb257-14" data-line-number="14"><span class="co">##  2 Acadia    Louisiana        152     11</span></a>
<a class="sourceLine" id="cb257-15" data-line-number="15"><span class="co">##  3 Accomack  Virginia         545      7</span></a>
<a class="sourceLine" id="cb257-16" data-line-number="16"><span class="co">##  4 Ada       Idaho            754     21</span></a>
<a class="sourceLine" id="cb257-17" data-line-number="17"><span class="co">##  5 Adair     Iowa               4      0</span></a>
<a class="sourceLine" id="cb257-18" data-line-number="18"><span class="co">##  6 Adair     Kentucky          88     13</span></a>
<a class="sourceLine" id="cb257-19" data-line-number="19"><span class="co">##  7 Adair     Missouri          12      0</span></a>
<a class="sourceLine" id="cb257-20" data-line-number="20"><span class="co">##  8 Adair     Oklahoma          74      3</span></a>
<a class="sourceLine" id="cb257-21" data-line-number="21"><span class="co">##  9 Adams     Colorado        2374     86</span></a>
<a class="sourceLine" id="cb257-22" data-line-number="22"><span class="co">## 10 Adams     Idaho              3      0</span></a>
<a class="sourceLine" id="cb257-23" data-line-number="23"><span class="co">## # … with 2,927 more rows</span></a></code></pre></div></li>
<li><p>Now summarize the number of cases per state</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1">state_summary &lt;-</a>
<a class="sourceLine" id="cb258-2" data-line-number="2"><span class="st">    </span>county_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb258-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb258-4" data-line-number="4"><span class="st">    </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb258-5" data-line-number="5">        <span class="dt">cases =</span> <span class="kw">sum</span>(cases),</a>
<a class="sourceLine" id="cb258-6" data-line-number="6">        <span class="dt">deaths =</span> <span class="kw">sum</span>(deaths)</a>
<a class="sourceLine" id="cb258-7" data-line-number="7">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb258-8" data-line-number="8"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cases))</a>
<a class="sourceLine" id="cb258-9" data-line-number="9">state_summary</a>
<a class="sourceLine" id="cb258-10" data-line-number="10"><span class="co">## # A tibble: 55 x 3</span></a>
<a class="sourceLine" id="cb258-11" data-line-number="11"><span class="co">##    state          cases deaths</span></a>
<a class="sourceLine" id="cb258-12" data-line-number="12"><span class="co">##    &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb258-13" data-line-number="13"><span class="co">##  1 New York      347919  28628</span></a>
<a class="sourceLine" id="cb258-14" data-line-number="14"><span class="co">##  2 New Jersey    145764   9723</span></a>
<a class="sourceLine" id="cb258-15" data-line-number="15"><span class="co">##  3 Illinois       85260   3820</span></a>
<a class="sourceLine" id="cb258-16" data-line-number="16"><span class="co">##  4 Massachusetts  81214   5325</span></a>
<a class="sourceLine" id="cb258-17" data-line-number="17"><span class="co">##  5 California     73250   3018</span></a>
<a class="sourceLine" id="cb258-18" data-line-number="18"><span class="co">##  6 Pennsylvania   62211   4107</span></a>
<a class="sourceLine" id="cb258-19" data-line-number="19"><span class="co">##  7 Michigan       48366   4716</span></a>
<a class="sourceLine" id="cb258-20" data-line-number="20"><span class="co">##  8 Texas          43863   1209</span></a>
<a class="sourceLine" id="cb258-21" data-line-number="21"><span class="co">##  9 Florida        42424   1862</span></a>
<a class="sourceLine" id="cb258-22" data-line-number="22"><span class="co">## 10 Connecticut    35142   3127</span></a>
<a class="sourceLine" id="cb258-23" data-line-number="23"><span class="co">## # … with 45 more rows</span></a></code></pre></div></li>
<li><p>Plot the relationship between cases and deaths as a scatter plot</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1"><span class="kw">ggplot</span>(state_summary, <span class="kw">aes</span>(cases, deaths)) <span class="op">+</span></a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb259-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p></li>
<li><p>Create a ‘long’ version of the state summary. The transformations include making ‘state’ a factor with the ‘levels’ ordered from most- to least-affected state. This is a ‘trick’ so that states are ordered, when displayed, from most to least affected. The transformations also choose only the 20 most-affected states using <code>head(20)</code>.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">state_longer &lt;-</a>
<a class="sourceLine" id="cb260-2" data-line-number="2"><span class="st">    </span>state_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb260-4" data-line-number="4">        <span class="co">## this &#39;trick&#39; causes &#39;state&#39; to be ordered from most to</span></a>
<a class="sourceLine" id="cb260-5" data-line-number="5">        <span class="co">## least cases, rather than alphabetically</span></a>
<a class="sourceLine" id="cb260-6" data-line-number="6">        <span class="dt">state =</span> <span class="kw">factor</span>(state, <span class="dt">levels =</span> state)</a>
<a class="sourceLine" id="cb260-7" data-line-number="7">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb260-8" data-line-number="8"><span class="st">    </span><span class="kw">head</span>(<span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># look at the 20 states with the most cases</span></a>
<a class="sourceLine" id="cb260-9" data-line-number="9"><span class="st">    </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb260-10" data-line-number="10">        <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;deaths&quot;</span>),</a>
<a class="sourceLine" id="cb260-11" data-line-number="11">        <span class="dt">names_to =</span> <span class="st">&quot;metric&quot;</span>,</a>
<a class="sourceLine" id="cb260-12" data-line-number="12">        <span class="dt">values_to =</span> <span class="st">&quot;count&quot;</span></a>
<a class="sourceLine" id="cb260-13" data-line-number="13">    )</a>
<a class="sourceLine" id="cb260-14" data-line-number="14">state_longer</a>
<a class="sourceLine" id="cb260-15" data-line-number="15"><span class="co">## # A tibble: 40 x 3</span></a>
<a class="sourceLine" id="cb260-16" data-line-number="16"><span class="co">##    state         metric  count</span></a>
<a class="sourceLine" id="cb260-17" data-line-number="17"><span class="co">##    &lt;fct&gt;         &lt;chr&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb260-18" data-line-number="18"><span class="co">##  1 New York      cases  347919</span></a>
<a class="sourceLine" id="cb260-19" data-line-number="19"><span class="co">##  2 New York      deaths  28628</span></a>
<a class="sourceLine" id="cb260-20" data-line-number="20"><span class="co">##  3 New Jersey    cases  145764</span></a>
<a class="sourceLine" id="cb260-21" data-line-number="21"><span class="co">##  4 New Jersey    deaths   9723</span></a>
<a class="sourceLine" id="cb260-22" data-line-number="22"><span class="co">##  5 Illinois      cases   85260</span></a>
<a class="sourceLine" id="cb260-23" data-line-number="23"><span class="co">##  6 Illinois      deaths   3820</span></a>
<a class="sourceLine" id="cb260-24" data-line-number="24"><span class="co">##  7 Massachusetts cases   81214</span></a>
<a class="sourceLine" id="cb260-25" data-line-number="25"><span class="co">##  8 Massachusetts deaths   5325</span></a>
<a class="sourceLine" id="cb260-26" data-line-number="26"><span class="co">##  9 California    cases   73250</span></a>
<a class="sourceLine" id="cb260-27" data-line-number="27"><span class="co">## 10 California    deaths   3018</span></a>
<a class="sourceLine" id="cb260-28" data-line-number="28"><span class="co">## # … with 30 more rows</span></a></code></pre></div></li>
<li><p>Use a dot plot to provide an alternative representation that is more easy to associated statsistics with individual states</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1"><span class="kw">ggplot</span>(state_longer, <span class="kw">aes</span>(<span class="dt">x =</span> count, <span class="dt">y =</span> state, <span class="dt">color =</span> metric)) <span class="op">+</span></a>
<a class="sourceLine" id="cb261-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb261-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p></li>
</ul>
</div>
</div>
<div id="day-18-worldwide-covid-data" class="section level2">
<h2><span class="header-section-number">3.4</span> Day 18 Worldwide COVID data</h2>
<p>Setup</p>
<ul>
<li><p>Start a new script and load the packages we’ll use</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb262-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb262-3" data-line-number="3"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb262-4" data-line-number="4"><span class="kw">library</span>(tidyr)     <span class="co"># specialized functions for transforming tibbles</span></a></code></pre></div>
<p>These packages should have been installed during previous quarantines.</p></li>
</ul>
<p>Source</p>
<ul>
<li><p>CSSE at Johns Hopkins University, available on github</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">hopkins =<span class="st"> &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;</span></a>
<a class="sourceLine" id="cb263-2" data-line-number="2">csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(hopkins)</a>
<a class="sourceLine" id="cb263-3" data-line-number="3"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb263-4" data-line-number="4"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb263-5" data-line-number="5"><span class="co">##   .default = col_double(),</span></a>
<a class="sourceLine" id="cb263-6" data-line-number="6"><span class="co">##   `Province/State` = col_character(),</span></a>
<a class="sourceLine" id="cb263-7" data-line-number="7"><span class="co">##   `Country/Region` = col_character()</span></a>
<a class="sourceLine" id="cb263-8" data-line-number="8"><span class="co">## )</span></a>
<a class="sourceLine" id="cb263-9" data-line-number="9"><span class="co">## See spec(...) for full column specifications.</span></a></code></pre></div></li>
</ul>
<p>‘Tidy’ data</p>
<ul>
<li><p>The data has initial columns describing region, and then a column for each date of the pandemic. There are 266 rows, corresponding to the different regions covered by the database.</p></li>
<li><p>We want instead to ‘pivot’ the data, so that each row represents cases in a particular region on a particular date, analogous to the way the US data we have been investigating earlier has been arranged.</p></li>
<li><p><a href="https://cran.r-project.org/package=tidyr">tidyr</a> provides functions for manipulating a <code>tibble</code> into ‘tidy’ format.</p></li>
<li><p><code>tidyr::pivot_longer()</code> takes a ‘wide’ data frame like <code>csv</code>, and allows us to transform it to the ‘long’ format we are interested in.</p>
<ul>
<li><p>I discovered how to work with <code>pivot_longer()</code> using its help page <code>?tidyr::pivot_longer</code></p></li>
<li><p>The first argument represents columns to pivot or, as a convenience when these are negative values, columns we <em>do not</em> want to pivot. We <em>do not</em> want to pivot columns 1 through 4, so this argument will be <code>-(1:4)</code>.</p></li>
<li><p>The <code>names_to</code> argument is the column name we want to use to refer to the names of the columns that we <em>do</em> pivot. We’ll pivot the columns that have a date in them, so it makes sense to use <code>names_to = &quot;date&quot;</code>.</p></li>
<li><p>The <code>values_to</code> argument is the column name we want to use for the pivoted values. Since the values in the main part of <code>csv</code> are the number of cases observed, we’ll use <code>values_to = &quot;cases&quot;</code></p></li>
</ul></li>
<li><p>Here’s what we have after pivoting</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb264-2" data-line-number="2"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>)</a>
<a class="sourceLine" id="cb264-3" data-line-number="3"><span class="co">## # A tibble: 30,324 x 6</span></a>
<a class="sourceLine" id="cb264-4" data-line-number="4"><span class="co">##    `Province/State` `Country/Region`   Lat  Long date    cases</span></a>
<a class="sourceLine" id="cb264-5" data-line-number="5"><span class="co">##    &lt;chr&gt;            &lt;chr&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb264-6" data-line-number="6"><span class="co">##  1 &lt;NA&gt;             Afghanistan         33    65 1/22/20     0</span></a>
<a class="sourceLine" id="cb264-7" data-line-number="7"><span class="co">##  2 &lt;NA&gt;             Afghanistan         33    65 1/23/20     0</span></a>
<a class="sourceLine" id="cb264-8" data-line-number="8"><span class="co">##  3 &lt;NA&gt;             Afghanistan         33    65 1/24/20     0</span></a>
<a class="sourceLine" id="cb264-9" data-line-number="9"><span class="co">##  4 &lt;NA&gt;             Afghanistan         33    65 1/25/20     0</span></a>
<a class="sourceLine" id="cb264-10" data-line-number="10"><span class="co">##  5 &lt;NA&gt;             Afghanistan         33    65 1/26/20     0</span></a>
<a class="sourceLine" id="cb264-11" data-line-number="11"><span class="co">##  6 &lt;NA&gt;             Afghanistan         33    65 1/27/20     0</span></a>
<a class="sourceLine" id="cb264-12" data-line-number="12"><span class="co">##  7 &lt;NA&gt;             Afghanistan         33    65 1/28/20     0</span></a>
<a class="sourceLine" id="cb264-13" data-line-number="13"><span class="co">##  8 &lt;NA&gt;             Afghanistan         33    65 1/29/20     0</span></a>
<a class="sourceLine" id="cb264-14" data-line-number="14"><span class="co">##  9 &lt;NA&gt;             Afghanistan         33    65 1/30/20     0</span></a>
<a class="sourceLine" id="cb264-15" data-line-number="15"><span class="co">## 10 &lt;NA&gt;             Afghanistan         33    65 1/31/20     0</span></a>
<a class="sourceLine" id="cb264-16" data-line-number="16"><span class="co">## # … with 30,314 more rows</span></a></code></pre></div></li>
<li><p>We’d like to further clean this up data</p>
<ul>
<li><p>Format our newly created ‘date’ column (using <code>as.Date()</code>, but with a <code>format=</code> argument appropriate for the format of the dates in this data set)</p></li>
<li><p>Re-name, for convenience, the <code>County/Region</code> column as just <code>country</code>. This can be done with <code>rename(country = &quot;Country/Region&quot;)</code></p></li>
<li><p>Select only columns of interest – <code>country</code>, <code>date</code>, <code>cases</code></p></li>
<li><p>Some countries have multiple rows, because the data is a provincial or state levels, so we would like to sum all cases, grouped by <code>country</code> and <code>date</code></p></li>
</ul>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">world &lt;-</a>
<a class="sourceLine" id="cb265-2" data-line-number="2"><span class="st">    </span>csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-3" data-line-number="3"><span class="st">    </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date, <span class="dt">format =</span> <span class="st">&quot;%m/%d/%y&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-5" data-line-number="5"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">country =</span> <span class="st">&quot;Country/Region&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-6" data-line-number="6"><span class="st">    </span><span class="kw">group_by</span>(country, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-7" data-line-number="7"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases))</a>
<a class="sourceLine" id="cb265-8" data-line-number="8">world</a>
<a class="sourceLine" id="cb265-9" data-line-number="9"><span class="co">## # A tibble: 21,432 x 3</span></a>
<a class="sourceLine" id="cb265-10" data-line-number="10"><span class="co">## # Groups:   country [188]</span></a>
<a class="sourceLine" id="cb265-11" data-line-number="11"><span class="co">##    country     date       cases</span></a>
<a class="sourceLine" id="cb265-12" data-line-number="12"><span class="co">##    &lt;chr&gt;       &lt;date&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb265-13" data-line-number="13"><span class="co">##  1 Afghanistan 2020-01-22     0</span></a>
<a class="sourceLine" id="cb265-14" data-line-number="14"><span class="co">##  2 Afghanistan 2020-01-23     0</span></a>
<a class="sourceLine" id="cb265-15" data-line-number="15"><span class="co">##  3 Afghanistan 2020-01-24     0</span></a>
<a class="sourceLine" id="cb265-16" data-line-number="16"><span class="co">##  4 Afghanistan 2020-01-25     0</span></a>
<a class="sourceLine" id="cb265-17" data-line-number="17"><span class="co">##  5 Afghanistan 2020-01-26     0</span></a>
<a class="sourceLine" id="cb265-18" data-line-number="18"><span class="co">##  6 Afghanistan 2020-01-27     0</span></a>
<a class="sourceLine" id="cb265-19" data-line-number="19"><span class="co">##  7 Afghanistan 2020-01-28     0</span></a>
<a class="sourceLine" id="cb265-20" data-line-number="20"><span class="co">##  8 Afghanistan 2020-01-29     0</span></a>
<a class="sourceLine" id="cb265-21" data-line-number="21"><span class="co">##  9 Afghanistan 2020-01-30     0</span></a>
<a class="sourceLine" id="cb265-22" data-line-number="22"><span class="co">## 10 Afghanistan 2020-01-31     0</span></a>
<a class="sourceLine" id="cb265-23" data-line-number="23"><span class="co">## # … with 21,422 more rows</span></a></code></pre></div></li>
<li><p>Let’s also calculate <code>new_cases</code> by country</p>
<ul>
<li>Use <code>group_by()</code> to perform the <code>new_cases</code> computation for each country</li>
<li>Use <code>mutate()</code> to calculate the new variable</li>
<li>Use <code>ungroup()</code> to remove the grouping variable, so it doesn’t unexpectedly influence other calculations</li>
<li>re-assign the updated <code>tibble</code> to the variable <code>world</code></li>
</ul>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1">world &lt;-</a>
<a class="sourceLine" id="cb266-2" data-line-number="2"><span class="st">    </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb266-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb266-4" data-line-number="4"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb266-5" data-line-number="5"><span class="st">    </span><span class="kw">ungroup</span>()</a></code></pre></div></li>
</ul>
<p>Exploration</p>
<ul>
<li><p>Use <code>group_by()</code> and <code>summarize()</code> to find the maximum (total) number of cases, and <code>arrange() these in</code>desc()`ending order</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="st">    </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-3" data-line-number="3"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">max</span>(cases)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-4" data-line-number="4"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a>
<a class="sourceLine" id="cb267-5" data-line-number="5"><span class="co">## # A tibble: 188 x 2</span></a>
<a class="sourceLine" id="cb267-6" data-line-number="6"><span class="co">##    country              n</span></a>
<a class="sourceLine" id="cb267-7" data-line-number="7"><span class="co">##    &lt;chr&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb267-8" data-line-number="8"><span class="co">##  1 US             1417774</span></a>
<a class="sourceLine" id="cb267-9" data-line-number="9"><span class="co">##  2 Russia          252245</span></a>
<a class="sourceLine" id="cb267-10" data-line-number="10"><span class="co">##  3 United Kingdom  234440</span></a>
<a class="sourceLine" id="cb267-11" data-line-number="11"><span class="co">##  4 Spain           229540</span></a>
<a class="sourceLine" id="cb267-12" data-line-number="12"><span class="co">##  5 Italy           223096</span></a>
<a class="sourceLine" id="cb267-13" data-line-number="13"><span class="co">##  6 Brazil          203165</span></a>
<a class="sourceLine" id="cb267-14" data-line-number="14"><span class="co">##  7 France          178994</span></a>
<a class="sourceLine" id="cb267-15" data-line-number="15"><span class="co">##  8 Germany         174478</span></a>
<a class="sourceLine" id="cb267-16" data-line-number="16"><span class="co">##  9 Turkey          144749</span></a>
<a class="sourceLine" id="cb267-17" data-line-number="17"><span class="co">## 10 Iran            114533</span></a>
<a class="sourceLine" id="cb267-18" data-line-number="18"><span class="co">## # … with 178 more rows</span></a></code></pre></div></li>
</ul>
<p>Visualization</p>
<ul>
<li><p>Start by creating a subset, e.g., the US</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">country &lt;-<span class="st"> &quot;US&quot;</span></a>
<a class="sourceLine" id="cb268-2" data-line-number="2">us &lt;-</a>
<a class="sourceLine" id="cb268-3" data-line-number="3"><span class="st">    </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb268-4" data-line-number="4"><span class="st">    </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;US&quot;</span>)</a></code></pre></div></li>
<li><p>Use <a href="https://cran.r-project.org/package=ggplot2">ggplot2</a> to visualize the progression of the pandemic</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1"><span class="kw">ggplot</span>(us, <span class="kw">aes</span>(date, new_cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb269-2" data-line-number="2"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb269-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb269-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_smooth</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb269-5" data-line-number="5"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste</span>(<span class="st">&quot;Country:&quot;</span>, country))</a>
<a class="sourceLine" id="cb269-6" data-line-number="6"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb269-7" data-line-number="7"></a>
<a class="sourceLine" id="cb269-8" data-line-number="8"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb269-9" data-line-number="9"><span class="co">## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></a>
<a class="sourceLine" id="cb269-10" data-line-number="10"><span class="co">## Warning: Removed 25 rows containing non-finite values (stat_smooth).</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p></li>
</ul>
<p>It seems like it would be convenient to capture our data cleaning and visualization steps into separate functions that can be re-used, e.g., on different days or for different visualizations.</p>
<ul>
<li><p>write a function for data retrieval and cleaning</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1">get_world_data &lt;-</a>
<a class="sourceLine" id="cb270-2" data-line-number="2"><span class="st">    </span><span class="cf">function</span>()</a>
<a class="sourceLine" id="cb270-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb270-4" data-line-number="4">    <span class="co">## read data from Hopkins&#39; github repository</span></a>
<a class="sourceLine" id="cb270-5" data-line-number="5">    hopkins =<span class="st"> &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;</span></a>
<a class="sourceLine" id="cb270-6" data-line-number="6">    csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(hopkins)</a>
<a class="sourceLine" id="cb270-7" data-line-number="7"></a>
<a class="sourceLine" id="cb270-8" data-line-number="8">    <span class="co">## &#39;tidy&#39; the data</span></a>
<a class="sourceLine" id="cb270-9" data-line-number="9">    world &lt;-</a>
<a class="sourceLine" id="cb270-10" data-line-number="10"><span class="st">        </span>csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-11" data-line-number="11"><span class="st">        </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-12" data-line-number="12"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date, <span class="dt">format =</span> <span class="st">&quot;%m/%d/%y&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-13" data-line-number="13"><span class="st">        </span><span class="kw">rename</span>(<span class="dt">country =</span> <span class="st">&quot;Country/Region&quot;</span>)</a>
<a class="sourceLine" id="cb270-14" data-line-number="14"></a>
<a class="sourceLine" id="cb270-15" data-line-number="15">    <span class="co">## sum cases across regions within aa country</span></a>
<a class="sourceLine" id="cb270-16" data-line-number="16">    world &lt;-</a>
<a class="sourceLine" id="cb270-17" data-line-number="17"><span class="st">        </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-18" data-line-number="18"><span class="st">        </span><span class="kw">group_by</span>(country, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-19" data-line-number="19"><span class="st">        </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases))</a>
<a class="sourceLine" id="cb270-20" data-line-number="20"></a>
<a class="sourceLine" id="cb270-21" data-line-number="21">    <span class="co">## add `new_cases`, and return the result</span></a>
<a class="sourceLine" id="cb270-22" data-line-number="22">    world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-23" data-line-number="23"><span class="st">        </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-24" data-line-number="24"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb270-25" data-line-number="25"><span class="st">        </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb270-26" data-line-number="26">}</a></code></pre></div></li>
<li><p>…and for plotting by country</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">plot_country &lt;-</a>
<a class="sourceLine" id="cb271-2" data-line-number="2"><span class="st">    </span><span class="cf">function</span>(tbl, <span class="dt">view_country =</span> <span class="st">&quot;US&quot;</span>)</a>
<a class="sourceLine" id="cb271-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb271-4" data-line-number="4">    country_title &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Country:&quot;</span>, view_country)</a>
<a class="sourceLine" id="cb271-5" data-line-number="5"></a>
<a class="sourceLine" id="cb271-6" data-line-number="6">    <span class="co">## subset to just this country</span></a>
<a class="sourceLine" id="cb271-7" data-line-number="7">    country_data &lt;-</a>
<a class="sourceLine" id="cb271-8" data-line-number="8"><span class="st">        </span>tbl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb271-9" data-line-number="9"><span class="st">        </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> </span>view_country)</a>
<a class="sourceLine" id="cb271-10" data-line-number="10"></a>
<a class="sourceLine" id="cb271-11" data-line-number="11">    <span class="co">## plot</span></a>
<a class="sourceLine" id="cb271-12" data-line-number="12">    country_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb271-13" data-line-number="13"><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>new_cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb271-14" data-line-number="14"><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb271-15" data-line-number="15"><span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb271-16" data-line-number="16"><span class="st">        </span><span class="co">## add method and formula to quieten message</span></a>
<a class="sourceLine" id="cb271-17" data-line-number="17"><span class="st">        </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x) <span class="op">+</span></a>
<a class="sourceLine" id="cb271-18" data-line-number="18"><span class="st">        </span><span class="kw">ggtitle</span>(country_title)</a>
<a class="sourceLine" id="cb271-19" data-line-number="19">}</a></code></pre></div></li>
<li><p>Note that, because the first argument of <code>plot_country()</code> is a tibble, the output of <code>get_world_data()</code> can be used as the input of <code>plot_country()</code>, and can be piped together, e.g.,</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1">world &lt;-<span class="st"> </span><span class="kw">get_world_data</span>()</a>
<a class="sourceLine" id="cb272-2" data-line-number="2"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb272-3" data-line-number="3"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb272-4" data-line-number="4"><span class="co">##   .default = col_double(),</span></a>
<a class="sourceLine" id="cb272-5" data-line-number="5"><span class="co">##   `Province/State` = col_character(),</span></a>
<a class="sourceLine" id="cb272-6" data-line-number="6"><span class="co">##   `Country/Region` = col_character()</span></a>
<a class="sourceLine" id="cb272-7" data-line-number="7"><span class="co">## )</span></a>
<a class="sourceLine" id="cb272-8" data-line-number="8"><span class="co">## See spec(...) for full column specifications.</span></a>
<a class="sourceLine" id="cb272-9" data-line-number="9">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Korea, South&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p></li>
</ul>
</div>
<div id="day-19-friday-zoom-check-in" class="section level2">
<h2><span class="header-section-number">3.5</span> Day 19 (Friday) Zoom check-in</h2>
<div id="logistics-2" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Logistics</h3>
<ul>
<li><p>Stick around after class to ask any questions.</p></li>
<li><p>Remember Microsoft <a href="https://teams.microsoft.com/l/team/19%3a44e8ed2b03db4d28bac6a212ed67717d%40thread.tacv2/conversations?groupId=02d8c183-5110-4504-b201-ace342eb6e2b&amp;tenantId=08beaa21-c9ff-428a-b8f5-53c03dad1941">Teams</a> for questions during the week.</p></li>
</ul>
</div>
<div id="review-and-trouble-shoot-40-minutes" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Review and trouble shoot (40 minutes)</h3>
<p>Setup</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb273-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb273-3" data-line-number="3"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb273-4" data-line-number="4"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb273-5" data-line-number="5"></a>
<a class="sourceLine" id="cb273-6" data-line-number="6">url &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&quot;</span></a>
<a class="sourceLine" id="cb273-7" data-line-number="7">us &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url)</a></code></pre></div>
<p>Packages</p>
<ul>
<li><code>install.packages()</code> versus <code>library()</code></li>
<li>Symbol resolution: <code>dplyr::filter()</code></li>
</ul>
<p>The <code>tibble</code></p>
<ul>
<li>Compact, informative display</li>
<li><p>Generally, no rownames</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb274-2" data-line-number="2"><span class="st">    </span><span class="kw">as_tibble</span>(<span class="dt">rownames =</span> <span class="st">&quot;model&quot;</span>)</a>
<a class="sourceLine" id="cb274-3" data-line-number="3"><span class="co">## # A tibble: 32 x 12</span></a>
<a class="sourceLine" id="cb274-4" data-line-number="4"><span class="co">##    model         mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></a>
<a class="sourceLine" id="cb274-5" data-line-number="5"><span class="co">##    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb274-6" data-line-number="6"><span class="co">##  1 Mazda RX4    21       6  160    110  3.9   2.62  16.5     0     1     4     4</span></a>
<a class="sourceLine" id="cb274-7" data-line-number="7"><span class="co">##  2 Mazda RX4 …  21       6  160    110  3.9   2.88  17.0     0     1     4     4</span></a>
<a class="sourceLine" id="cb274-8" data-line-number="8"><span class="co">##  3 Datsun 710   22.8     4  108     93  3.85  2.32  18.6     1     1     4     1</span></a>
<a class="sourceLine" id="cb274-9" data-line-number="9"><span class="co">##  4 Hornet 4 D…  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1</span></a>
<a class="sourceLine" id="cb274-10" data-line-number="10"><span class="co">##  5 Hornet Spo…  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2</span></a>
<a class="sourceLine" id="cb274-11" data-line-number="11"><span class="co">##  6 Valiant      18.1     6  225    105  2.76  3.46  20.2     1     0     3     1</span></a>
<a class="sourceLine" id="cb274-12" data-line-number="12"><span class="co">##  7 Duster 360   14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</span></a>
<a class="sourceLine" id="cb274-13" data-line-number="13"><span class="co">##  8 Merc 240D    24.4     4  147.    62  3.69  3.19  20       1     0     4     2</span></a>
<a class="sourceLine" id="cb274-14" data-line-number="14"><span class="co">##  9 Merc 230     22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2</span></a>
<a class="sourceLine" id="cb274-15" data-line-number="15"><span class="co">## 10 Merc 280     19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4</span></a>
<a class="sourceLine" id="cb274-16" data-line-number="16"><span class="co">## # … with 22 more rows</span></a></code></pre></div></li>
</ul>
<p>Verbs</p>
<ul>
<li><p><code>filter()</code>: filter rows meeting specific criteria</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1">erie &lt;-</a>
<a class="sourceLine" id="cb275-2" data-line-number="2"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb275-3" data-line-number="3"><span class="st">    </span><span class="kw">filter</span>(county <span class="op">==</span><span class="st"> &quot;Erie&quot;</span>, state <span class="op">==</span><span class="st"> &quot;New York&quot;</span>)</a></code></pre></div></li>
<li><code>select()</code>: select column</li>
<li><p><code>summarize()</code>: summarize column(s) to a single value</p>
<ul>
<li><code>n()</code>: number of rows in the tibble</li>
</ul></li>
<li><code>mutate()</code>: modify and create new columns</li>
<li><p><code>arrange()</code>: arrange rows so that specific columns are in order</p>
<ul>
<li><code>desc()</code>: arrange in descending order. Applies to individual columns</li>
</ul></li>
<li><p><code>group_by()</code> / <code>ungroup()</code>: identify groups of data, e.g., for <code>summarize()</code> operations</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" data-line-number="1">us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-2" data-line-number="2"><span class="st">    </span><span class="co">## group by county &amp; state, summarize by MAX (total) cases,</span></a>
<a class="sourceLine" id="cb276-3" data-line-number="3"><span class="st">    </span><span class="co">## deaths across each date</span></a>
<a class="sourceLine" id="cb276-4" data-line-number="4"><span class="st">    </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-5" data-line-number="5"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">max</span>(cases), <span class="dt">deaths =</span> <span class="kw">max</span>(deaths)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-6" data-line-number="6"><span class="st">    </span><span class="co">## group the _result_ by state, summarize by SUM of cases,</span></a>
<a class="sourceLine" id="cb276-7" data-line-number="7"><span class="st">    </span><span class="co">## deaths in each county</span></a>
<a class="sourceLine" id="cb276-8" data-line-number="8"><span class="st">    </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-9" data-line-number="9"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases), <span class="dt">deaths =</span> <span class="kw">sum</span>(deaths)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb276-10" data-line-number="10"><span class="st">    </span><span class="co">## arrange from most to least affected states</span></a>
<a class="sourceLine" id="cb276-11" data-line-number="11"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cases))</a>
<a class="sourceLine" id="cb276-12" data-line-number="12"><span class="co">## # A tibble: 55 x 3</span></a>
<a class="sourceLine" id="cb276-13" data-line-number="13"><span class="co">##    state          cases deaths</span></a>
<a class="sourceLine" id="cb276-14" data-line-number="14"><span class="co">##    &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb276-15" data-line-number="15"><span class="co">##  1 New York      347919  28628</span></a>
<a class="sourceLine" id="cb276-16" data-line-number="16"><span class="co">##  2 New Jersey    145764   9723</span></a>
<a class="sourceLine" id="cb276-17" data-line-number="17"><span class="co">##  3 Illinois       85260   3820</span></a>
<a class="sourceLine" id="cb276-18" data-line-number="18"><span class="co">##  4 Massachusetts  81214   5325</span></a>
<a class="sourceLine" id="cb276-19" data-line-number="19"><span class="co">##  5 California     73250   3018</span></a>
<a class="sourceLine" id="cb276-20" data-line-number="20"><span class="co">##  6 Pennsylvania   62211   4107</span></a>
<a class="sourceLine" id="cb276-21" data-line-number="21"><span class="co">##  7 Michigan       48366   4716</span></a>
<a class="sourceLine" id="cb276-22" data-line-number="22"><span class="co">##  8 Texas          43863   1209</span></a>
<a class="sourceLine" id="cb276-23" data-line-number="23"><span class="co">##  9 Florida        42424   1862</span></a>
<a class="sourceLine" id="cb276-24" data-line-number="24"><span class="co">## 10 Connecticut    35142   3127</span></a>
<a class="sourceLine" id="cb276-25" data-line-number="25"><span class="co">## # … with 45 more rows</span></a></code></pre></div>
<ul>
<li><code>ungroup()</code> to remove grouping</li>
</ul></li>
<li><p>In scripts, it seems like the best strategy, for legibility, is to evaluate one verb per line, and to chain not too many verbs together into logical ‘phrases’.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1"><span class="co">## worst?</span></a>
<a class="sourceLine" id="cb277-2" data-line-number="2">state &lt;-<span class="st"> </span>us <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">max</span>(cases), <span class="dt">deaths =</span> <span class="kw">max</span>(deaths)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases), <span class="dt">deaths =</span> <span class="kw">sum</span>(deaths)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cases))</a>
<a class="sourceLine" id="cb277-3" data-line-number="3"></a>
<a class="sourceLine" id="cb277-4" data-line-number="4"><span class="co">## better?</span></a>
<a class="sourceLine" id="cb277-5" data-line-number="5">state &lt;-</a>
<a class="sourceLine" id="cb277-6" data-line-number="6"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-7" data-line-number="7"><span class="st">    </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-8" data-line-number="8"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">max</span>(cases), <span class="dt">deaths =</span> <span class="kw">max</span>(deaths)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-9" data-line-number="9"><span class="st">    </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-10" data-line-number="10"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases), <span class="dt">deaths =</span> <span class="kw">sum</span>(deaths)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-11" data-line-number="11"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cases))</a>
<a class="sourceLine" id="cb277-12" data-line-number="12"></a>
<a class="sourceLine" id="cb277-13" data-line-number="13"><span class="co">## best?</span></a>
<a class="sourceLine" id="cb277-14" data-line-number="14">county_state &lt;-</a>
<a class="sourceLine" id="cb277-15" data-line-number="15"><span class="st">    </span>us <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-16" data-line-number="16"><span class="st">    </span><span class="kw">group_by</span>(county, state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-17" data-line-number="17"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">max</span>(cases), <span class="dt">deaths =</span> <span class="kw">max</span>(deaths))</a>
<a class="sourceLine" id="cb277-18" data-line-number="18"></a>
<a class="sourceLine" id="cb277-19" data-line-number="19">state &lt;-</a>
<a class="sourceLine" id="cb277-20" data-line-number="20"><span class="st">    </span>county_state <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-21" data-line-number="21"><span class="st">    </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-22" data-line-number="22"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases), <span class="dt">deaths =</span> <span class="kw">sum</span>(deaths)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-23" data-line-number="23"><span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cases))</a></code></pre></div></li>
</ul>
<p>Cleaning: <code>tidyr::pivot_longer()</code></p>
<ul>
<li><p><code>cases</code> and <code>deaths</code> are both ‘counts’, so could perhaps be represented in a single ‘value’ column with a corresponding ‘key’ (name) column telling us whether the count is a ‘case’ or ‘death’</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" data-line-number="1">erie <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb278-2" data-line-number="2"><span class="st">    </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb278-3" data-line-number="3">        <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;deaths&quot;</span>),</a>
<a class="sourceLine" id="cb278-4" data-line-number="4">        <span class="dt">names_to =</span> <span class="st">&quot;event&quot;</span>,</a>
<a class="sourceLine" id="cb278-5" data-line-number="5">        <span class="dt">values_to =</span> <span class="st">&quot;count&quot;</span></a>
<a class="sourceLine" id="cb278-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb278-7" data-line-number="7"><span class="co">## # A tibble: 120 x 6</span></a>
<a class="sourceLine" id="cb278-8" data-line-number="8"><span class="co">##    date       county state    fips  event  count</span></a>
<a class="sourceLine" id="cb278-9" data-line-number="9"><span class="co">##    &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb278-10" data-line-number="10"><span class="co">##  1 2020-03-15 Erie   New York 36029 cases      3</span></a>
<a class="sourceLine" id="cb278-11" data-line-number="11"><span class="co">##  2 2020-03-15 Erie   New York 36029 deaths     0</span></a>
<a class="sourceLine" id="cb278-12" data-line-number="12"><span class="co">##  3 2020-03-16 Erie   New York 36029 cases      6</span></a>
<a class="sourceLine" id="cb278-13" data-line-number="13"><span class="co">##  4 2020-03-16 Erie   New York 36029 deaths     0</span></a>
<a class="sourceLine" id="cb278-14" data-line-number="14"><span class="co">##  5 2020-03-17 Erie   New York 36029 cases      7</span></a>
<a class="sourceLine" id="cb278-15" data-line-number="15"><span class="co">##  6 2020-03-17 Erie   New York 36029 deaths     0</span></a>
<a class="sourceLine" id="cb278-16" data-line-number="16"><span class="co">##  7 2020-03-18 Erie   New York 36029 cases      7</span></a>
<a class="sourceLine" id="cb278-17" data-line-number="17"><span class="co">##  8 2020-03-18 Erie   New York 36029 deaths     0</span></a>
<a class="sourceLine" id="cb278-18" data-line-number="18"><span class="co">##  9 2020-03-19 Erie   New York 36029 cases     28</span></a>
<a class="sourceLine" id="cb278-19" data-line-number="19"><span class="co">## 10 2020-03-19 Erie   New York 36029 deaths     0</span></a>
<a class="sourceLine" id="cb278-20" data-line-number="20"><span class="co">## # … with 110 more rows</span></a></code></pre></div></li>
</ul>
<p>Visualization</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
<ul>
<li><code>ggplot()</code>: where does the data come from?</li>
<li><p><code>aes()</code>: what parts of the data are we going to plot</p>
<ul>
<li>a tibble and <code>aes()</code> are enough to know the overall layout of the plot</li>
</ul>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" data-line-number="1"><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases))</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p></li>
<li><p><code>geom_*()</code>: how to plot the aesthetics</p>
<ul>
<li>‘add’ to other plot components</li>
</ul>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb281-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p></li>
<li><p>Additional ways to decorate the data</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1"><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb282-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb282-3" data-line-number="3"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Erie county cases&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p></li>
<li><p>Plots can be captured as a variable, and subsequently modified</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1">p &lt;-</a>
<a class="sourceLine" id="cb283-2" data-line-number="2"><span class="st">    </span><span class="kw">ggplot</span>(erie, <span class="kw">aes</span>(date, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb283-4" data-line-number="4"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Erie county cases&quot;</span>)</a>
<a class="sourceLine" id="cb283-5" data-line-number="5">p <span class="op">+</span></a>
<a class="sourceLine" id="cb283-6" data-line-number="6"><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb283-7" data-line-number="7"><span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Erie county cases (log 10)&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p></li>
</ul>
<p>Global data</p>
<ul>
<li><p><code>get_world_data()</code></p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1">get_world_data &lt;-</a>
<a class="sourceLine" id="cb284-2" data-line-number="2"><span class="st">    </span><span class="cf">function</span>()</a>
<a class="sourceLine" id="cb284-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb284-4" data-line-number="4">    <span class="co">## read data from Hopkins&#39; github repository</span></a>
<a class="sourceLine" id="cb284-5" data-line-number="5">    hopkins =<span class="st"> &quot;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv&quot;</span></a>
<a class="sourceLine" id="cb284-6" data-line-number="6">    csv &lt;-<span class="st"> </span><span class="kw">read_csv</span>(hopkins)</a>
<a class="sourceLine" id="cb284-7" data-line-number="7"></a>
<a class="sourceLine" id="cb284-8" data-line-number="8">    <span class="co">## &#39;tidy&#39; the data</span></a>
<a class="sourceLine" id="cb284-9" data-line-number="9">    world &lt;-</a>
<a class="sourceLine" id="cb284-10" data-line-number="10"><span class="st">        </span>csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-11" data-line-number="11"><span class="st">        </span><span class="kw">pivot_longer</span>(<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">names_to =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;cases&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-12" data-line-number="12"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(date, <span class="dt">format =</span> <span class="st">&quot;%m/%d/%y&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-13" data-line-number="13"><span class="st">        </span><span class="kw">rename</span>(<span class="dt">country =</span> <span class="st">&quot;Country/Region&quot;</span>)</a>
<a class="sourceLine" id="cb284-14" data-line-number="14"></a>
<a class="sourceLine" id="cb284-15" data-line-number="15">    <span class="co">## sum cases across regions within aa country</span></a>
<a class="sourceLine" id="cb284-16" data-line-number="16">    world &lt;-</a>
<a class="sourceLine" id="cb284-17" data-line-number="17"><span class="st">        </span>world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-18" data-line-number="18"><span class="st">        </span><span class="kw">group_by</span>(country, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-19" data-line-number="19"><span class="st">        </span><span class="kw">summarize</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases))</a>
<a class="sourceLine" id="cb284-20" data-line-number="20"></a>
<a class="sourceLine" id="cb284-21" data-line-number="21">    <span class="co">## add `new_cases`, and return the result</span></a>
<a class="sourceLine" id="cb284-22" data-line-number="22">    world <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-23" data-line-number="23"><span class="st">        </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-24" data-line-number="24"><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">new_cases =</span> <span class="kw">diff</span>(<span class="kw">c</span>(<span class="dv">0</span>, cases))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-25" data-line-number="25"><span class="st">        </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb284-26" data-line-number="26">}</a></code></pre></div></li>
<li><p><code>plot_country()</code></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1">plot_country &lt;-</a>
<a class="sourceLine" id="cb285-2" data-line-number="2"><span class="st">    </span><span class="cf">function</span>(tbl, <span class="dt">view_country =</span> <span class="st">&quot;US&quot;</span>)</a>
<a class="sourceLine" id="cb285-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb285-4" data-line-number="4">    country_title &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Country:&quot;</span>, view_country)</a>
<a class="sourceLine" id="cb285-5" data-line-number="5"></a>
<a class="sourceLine" id="cb285-6" data-line-number="6">    <span class="co">## subset to just this country</span></a>
<a class="sourceLine" id="cb285-7" data-line-number="7">    country_data &lt;-</a>
<a class="sourceLine" id="cb285-8" data-line-number="8"><span class="st">        </span>tbl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb285-9" data-line-number="9"><span class="st">        </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> </span>view_country)</a>
<a class="sourceLine" id="cb285-10" data-line-number="10"></a>
<a class="sourceLine" id="cb285-11" data-line-number="11">    <span class="co">## plot</span></a>
<a class="sourceLine" id="cb285-12" data-line-number="12">    country_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb285-13" data-line-number="13"><span class="st">        </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>new_cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb285-14" data-line-number="14"><span class="st">        </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb285-15" data-line-number="15"><span class="st">        </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb285-16" data-line-number="16"><span class="st">        </span><span class="co">## add method and formula to quieten message</span></a>
<a class="sourceLine" id="cb285-17" data-line-number="17"><span class="st">        </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x) <span class="op">+</span></a>
<a class="sourceLine" id="cb285-18" data-line-number="18"><span class="st">        </span><span class="kw">ggtitle</span>(country_title)</a>
<a class="sourceLine" id="cb285-19" data-line-number="19">}</a></code></pre></div></li>
<li><em>functions</em> to encapsulate common operations</li>
<li><p>typically saved as <em>scripts</em> that can be easily <code>source()</code>’ed into <em>R</em></p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1">world &lt;-<span class="st"> </span><span class="kw">get_world_data</span>()</a>
<a class="sourceLine" id="cb286-2" data-line-number="2"><span class="co">## Parsed with column specification:</span></a>
<a class="sourceLine" id="cb286-3" data-line-number="3"><span class="co">## cols(</span></a>
<a class="sourceLine" id="cb286-4" data-line-number="4"><span class="co">##   .default = col_double(),</span></a>
<a class="sourceLine" id="cb286-5" data-line-number="5"><span class="co">##   `Province/State` = col_character(),</span></a>
<a class="sourceLine" id="cb286-6" data-line-number="6"><span class="co">##   `Country/Region` = col_character()</span></a>
<a class="sourceLine" id="cb286-7" data-line-number="7"><span class="co">## )</span></a>
<a class="sourceLine" id="cb286-8" data-line-number="8"><span class="co">## See spec(...) for full column specifications.</span></a>
<a class="sourceLine" id="cb286-9" data-line-number="9">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;US&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p></li>
</ul>
</div>
<div id="weekend-activities-15-minutes" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Weekend activities (15 minutes)</h3>
<ul>
<li>Explore global pandemic data</li>
<li>Critically reflect on data resources and interpretation</li>
</ul>
</div>
</div>
<div id="day-20-exploring-the-course-of-pandemic-in-different-regions" class="section level2">
<h2><span class="header-section-number">3.6</span> Day 20 Exploring the course of pandemic in different regions</h2>
<p>Use the data and functions from quarantine day 18 to place the pandemic into quantitative perspective. Start by retrieving the current data</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" data-line-number="1">world &lt;-<span class="st"> </span><span class="kw">get_world_data</span>()</a></code></pre></div>
<p>Start with the United States</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;US&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<ul>
<li><p>When did ‘stay at home’ orders come into effect? Did they appear to be effective?</p></li>
<li><p>When would the data suggest that the pandemic might be considered ‘under control’, and country-wide stay-at-home orders might be relaxed?</p></li>
</ul>
<p>Explore other countries.</p>
<ul>
<li><p>The longest trajectory is probably displayed by China</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;China&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p></li>
<li><p>Italy and Spain were hit very hard, and relatively early, by the pandemic</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Italy&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb291-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Spain&quot;</span>)</a>
<a class="sourceLine" id="cb291-2" data-line-number="2"><span class="co">## Warning in self$trans$transform(x): NaNs produced</span></a>
<a class="sourceLine" id="cb291-3" data-line-number="3"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb291-4" data-line-number="4"><span class="co">## Warning in self$trans$transform(x): NaNs produced</span></a>
<a class="sourceLine" id="cb291-5" data-line-number="5"><span class="co">## Warning: Transformation introduced infinite values in continuous y-axis</span></a>
<a class="sourceLine" id="cb291-6" data-line-number="6"><span class="co">## Warning: Removed 1 rows containing non-finite values (stat_smooth).</span></a>
<a class="sourceLine" id="cb291-7" data-line-number="7"><span class="co">## Warning: Removed 1 rows containing missing values (geom_point).</span></a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-82-2.png" width="672" /></p></li>
<li><p>Austria relaxed quarantine very early, in the middle of April; does that seem like a good idea?</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Austria&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p></li>
<li><p>Germany also had strong leadership (e.g., chancellor Angela Merkel provided clear and unambiguous rules for Germans to follow, and then self-isolated when her doctor, whom she had recently visited, tested positive) and an effective screening campaign (e.g., to make effective use of limited testing resources, in some instances pools of samples were screened, and only if the pool indicated infection were the individuals in the pool screened.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Germany&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p></li>
<li><p>At the start of the pandemic, Singapore had excellent surveillance (detecting individuals with symptoms) and contact tracing (identifying and placing in quarantine those individuals coming in contact with the infected individuals). New cases were initially very low, despite proximity to China, and Singapore managed the pandemic through only moderate social distancing (e.g., workers were encouraged to operate in shifts; stores and restaurants remained open). Unfortunately, Singaporeans returning from Europe (after travel restrictions were in place there) introduced new cases that appear to have overwhelmed the surveillance network. Later, the virus spread to large, densely populated migrant work housing. Singapore’s initial success at containing the virus seems to have fallen apart in the face of this wider spread, and more severe restrictions on economic and social life were imposed.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Singapore&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p></li>
<li><p>South Korea had a very ‘acute’ spike in cases associated with a large church. The response was to deploy very extensive testing and use modern approaches to tracking (e.g., cell phone apps) coupled with transparent accounting. South Korea imposed relatively modest social and economic restrictions. It seems like this has effectively ‘flattened the curve’ without pausing the economy.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1">world <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">plot_country</span>(<span class="st">&quot;Korea, South&quot;</span>)</a></code></pre></div>
<p><img src="03-Packages_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p></li>
</ul>
<p>Where does your own exploration of the data take you?</p>
</div>
<div id="day-21-critical-evaluation" class="section level2">
<h2><span class="header-section-number">3.7</span> Day 21 Critical evaluation</h2>
<p>The work so far has focused on the mechanics of processing and visualizing the COVID-19 state and global data. Use today for reflecting on interpretation of the data. For instance</p>
<ul>
<li><p>To what extent is the exponential increase in COVID presence in early stages of the pandemic simply due to increased availability of testing?</p></li>
<li><p>How does presentation of data influence interpretation? It might be interesting to visualize, e.g., US cases on linear as well as log scale, and to investigate different ways of ‘smoothing’ the data, e.g., the trailing 7-day average case number. For the latter, one could write a function</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" data-line-number="1">seven_day_average &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb296-2" data-line-number="2">    x &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">filter</span>(x, <span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">7</span>), <span class="dt">sides =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb296-3" data-line-number="3">    <span class="kw">as.vector</span>(x)</a>
<a class="sourceLine" id="cb296-4" data-line-number="4">}</a></code></pre></div>
<p>and apply this to <code>new_cases</code> prior to visualization. Again this could be presented as log-transformed or on a linear scale.</p></li>
<li><p>Can you collect additional data, e.g., on population numbers from the <a href="https://www.census.gov/data/datasets/time-series/demo/popest/2010s-state-total.html">US census</a>, to explore the relationship between COVID impact and socioeconomic factors?</p></li>
<li><p>How has COVID response been influenced by social and political factors in different parts of the world? My (Martin) narratives were sketched out to some extend on Day 20. What are your narratives?</p></li>
<li><p>What opportunities are there to intentionally or unintentionally mis-represent or mis-interpret the seemingly ‘hard facts’ of COVID infection?</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="two.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="four.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["QuaRantine.pdf", "QuaRantine.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
