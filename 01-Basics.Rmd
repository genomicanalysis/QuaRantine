# Basics {#one}

## Day 1 (Monday) Zoom orientation

### Logistics

Course material

- Available at https://mtmorgan.github.io/QuaRantine

Cadence

- Daily independent activities -- most of your learning will happen here!
- Monday and Friday group zoom sessions -- these will review and troubleshoot previous material, and outline goals for the next set of independent activities.

Communicating

- We'll use Microsoft Teams (if most participants have access to the course) or slack (if teams access turns out to be difficult).
- Visit Microsoft [teams][]  and sign in with your Roswell username (e.g., `MA38727@RoswellPark.org`) and the password you use to check email, etc. Join the 'QuaRantine' team.
- Sign up on the [QuaRantine][slack] slack.

[slack]: https://quarantinecourse.slack.com/archives/C011GGP4K62
[teams]: https://teams.microsoft.org

### Installing _R_ and _RStudio_ (25 minutes, Shawn)

<img src="images/R_logo.png" style="float:right;">

What is R?

- A programming language for statistical computing, data analysis and scientific graphics.

- Open-source with a large (and growing) user community.

- Currently in the top 10 most popular languages according to the [tiobe index][].

[tiobe index]: https://www.tiobe.com/tiobe-index/

What is [RStudio][]?

[RStudio]: https://rstudio.com/

- RStudio provides an integrated editor and shell environment to make R programming easier. Some of the more useful features include:
    - Syntax highlighting and color coding
    - Easy switching between shell and editor
    - Dynamic help and docs

Installing _R_ and _RStudio_

- Two ways to "get" RStudio:
    - Install on your laptop or desktop
        - Download the free desktop [installer here][]
    - Use the rstudio.cloud resource
        - [Visit rstudio.cloud][], sign-up, and sign-on

[installer here]:  https://rstudio.com/products/rstudio/download/#download

[Visit rstudio.cloud]: https://rstudio.cloud/

The preferred approach for this course is to try to install R and RStudio on your own computer

- Windows Users:
  - [Download R for Windows][] and run the installer. Avoid, if possible, installing as administrator.
  - [Download RStudio for Windows][] and run the installer.
  - Test the installation by launching RStudio. You should end up with a window like the screen shot below.
- Mac Users:
  - [Download R for macOS][] (OS X 10.11, El Capitan, and later) or [older macOS][] and run the installer.
  - [Download RStudio for macOS][] and run the installer.
  - Test the installation by launching RStudio. You should end up with a window like the screen shot below.

[Download R for Windows]: https://cran.rstudio.com/bin/windows/base/R-3.6.3-win.exe
[Download Rstudio for Windows]: https://download1.rstudio.org/desktop/windows/RStudio-1.2.5033.exe
[Download R for macOS]: https://cran.rstudio.com/bin/macosx/R-3.6.3.pkg
[older macOS]: https://cran.rstudio.com/bin/macosx/R-3.6.3.nn.pkg
[Download Rstudio for macOS]: https://download1.rstudio.org/desktop/macos/RStudio-1.2.5033.dmg

```{r echo = FALSE}
knitr::include_graphics('images/RStudio-screenshot.png')
```

An ALTERNATIVE, if installing on your own computer does not work:

- Do the following only if you are NOT ABLE TO INSTALL R and RStudio.
- Visit [rstudio.cloud][]. Click the 'Get Started' button, and create an account (I used my gmail account...). You should end up at a screen like the following.

    ```{r echo = FALSE}
    knitr::include_graphics('images/RStudio-cloud-screenshot.png')
    ```

- Click on the 'New Project' button, to end up with a screen like the one below. Note the 'Untitled Project' at the top of the screen; click on it to name your project, e.g., 'QuaRantine'.

    ```{r echo = FALSE}
    knitr::include_graphics('images/RStudio-cloud-project.png')
    ```

[rstudio.cloud]: https://rstudio.cloud/

```{r echo = FALSE}
knitr::include_graphics('images/breakout_stop.png')
```

#### Breakout Room {-}

At this point you should have RStudio running either via your desktop installation or through rstudio.cloud. If not, please let us know via the chat window and we'll invite you to a breakout room to troubleshoot your installation.

### Basics of _R_ (25 minutes)

<img src="images/simple_calc.png" style="float:right;">

#### R as a simple calculator {-}

```{r}
1 + 2
```

#### R Console Output {-}

Enter this in the console:

```{r}
2 + 3 * 5
```

Q: what's the `[1]` all about in the output?

A: It's the index of the first entry in each line.

This is maybe a better example:

```{r}
1:30
```

#### Displaying help in the R Console {-}

 `? <command-name>`

- Some examples:

  ```
  ? cat
  ? print
  ```

#### Variables {-}

Naming variables in _R_

- A variable name can contain letters, numbers, and the dot `.` or underline `_` characters. Variables should start with a letter.

- Try entering these in the console:

  ` y = 2`

  `try.this = 33.3`

  `oneMoreTime = "woohoo"`

- Now try these:

  `2y = 2`

  `_z = 33.3`

  `function = "oops, my bad"`

_R_ is case sensitive (R != r)

```{r}
R = 2
r = 3
R == r
```

Variable Assignment

- You may use `=` or `<-` (and even `->`) to assign values to a variable.

  ```{r}
  x <- 2 + 3 * 5
  y =  2 + 3 * 6
  2 + 3 * 7 -> z
  cat(x, y, z)
  ```

_R_'s four basic 'atomic' data types

- Numeric (includes integer, double, etc.)
  - `3.14`, `1`, `2600`
- Character (string)
  - `"hey, I'm a string"`
  - `'single quotes are ok too'`
- Logical
  - `TRUE` or `FALSE` (note all caps)
- `NA`
  - not assigned (no known value)

Use `class()` to query the class of data:

```{r}
a <- 5
class(a)
```

Use `as.` to coerce a variable to a specific data type

```{r}
a <- as.integer(5)
class(a)
```

```{r}
d <- as.logical(a)
d
class(d)
```

#### Using Logical Operators {-}

Equivalence test (`==`):

```{r}
1 == 2
```

Not equal test (`!=`):

```{r}
1 != 2
```

less-than (`<`) and greater-than (`>`):

```{r}
18 > 44
3 < 204
```

Logical Or (`|`):

```{r}
(1 == 2) | (2 == 2)
```

Logical And (`&`):

```{r}
(1 == 2) & (2 == 2)
```

#### Objects and Vectors in R {-}

Objects

- R stores everything, variables included, in 'objects'.

```{r}
x <- 2.71

# print the value of an object
print(x)

# determine class or internal type of an object
class(x)

# TRUE if an object has not been assigned a value
is.na(x)
```

Vectors

- 'Vectors' and 'data frames' are the bread and butter of R
- Vectors consist of several elements of the <b><i>same class</b></i>
  - e.g. a vector of heart rates, one per patient

```{r echo = FALSE}
knitr::include_graphics('images/simple_vector.png')
```

Data frames (`data.frame`)

- Data frames are structures that can contain columns of <b><i>various types</b></i>
  - e.g. height, weight, age, heart rate, etc.
  - Handy containers for experimental data
  - Analogous to spreadsheet data
  - More on Data Frames throughout the week!

#### Working with Vectors {-}

Creating a Vector

- Use the `c()` function

```{r}
name <- c("John Doe", "Jane Smith", "MacGillicuddy Jones", "Echo Shamus")
age <- c(36, 54, 82, 15)
favorite_color <- c("red", "orange", "green", "black")

## print the vectors
name
age
favorite_color
```

Accessing vector data

- Use numerical indexing
- R uses 1-based indexing
  - 1st vector element has index of 1
  - 2nd has an index of 2
  - 3rd has an index of 3
  - and so on

```{r}
name[1]
age[3]
```

- R supports "slicing" (i.e. extracting multiple items)

```{r}
favorite_color[c(2, 3)]
```

- Negative indices are omitted

```{r}
age[-2]
```

Some Useful Vector Operations

- `length()`: number of elements
- `sum()`: sum of all element values
- `unique()`: distinct values
- `sort()`: sort elements, omitting NAs
- `order()`: indices of sorted elements, NAs are last
- `rev()`: reverse the order
- `summary()`: simple statistics

```{r}
a <- c(5, 5, 6, 7, 8, 4)
sum(a)
length(a)
unique(a)
sort(a)
order(a)
a[order(a)]
rev(a)
summary(a)
```

Handling Missing Data

- First consider the <i>reason(s)</i> for the missing data
  - e.g. concentrations that are below detectable levels?
- Sometimes NAs in data require special statistical methods
- Other times we can safely discard / ignore NA entries
- To remove NAs prior to a calculation:

```{r}
y = c(1,NA,3,2,NA)
sum(y, na.rm=TRUE)
```

#### Wrapping up day 1 {-}

The goal for today was to rapidly cover some of the essential aspects of R programming. For the remainder of the week you'll work at your own pace to get more of a hands-on deep dive into this material. If you run into trouble please don't hesiate to ask for help via <a href="https://teams.microsoft.com">Teams</a> (QuaRantine Team), <a href = "https://quarantinecourse.slack.com/archives/C011GGP4K62">slack</a> (QuaRantine Course), or <a href="mailto:Loren.Matott@RoswellPark.org?cc=Martin.Morgan@RoswellPark.org">email</a> (Drs. Matott and Morgan) --- whatever works best for you!

## Day 2: Vectors and variables

Our overall goal for the next few days is to use _R_ to create a daily log of quarantine activities.

Our goal for today is to become familiar with _R_ vectors. Along the way we'll probably make data entry and other errors that will start to get us comfortable with _R_.

If you run into problems, reach out to the slack channel for support!

The astronaut Scott Kelly said that to survive a year on the International Space Station he found it essential to

- Follow a schedule -- plan your day, and stick to the plan
- Pace yourselves -- you've got a long time to accomplish tasks, so don't try to get everything done in the first week.
- Go outside -- if Scott can head out to space, we should be able to make it to the back yard or around the block!
- Get a hobby -- something not work related, and away from that evil little screen. Maybe it's as simple as rediscovering the joy of reading.
- Keep a journal
- Take time to connect -- on a human level, with people you work with and people you don't!
- Listen to experts -- Scott talked about relying on the mission controllers; for us maybe that's watching webinars or taking courses in new topics!
- Wash your hands!

I wanted to emphasize 'follow a schedule' and 'keep a journal'. How can _R_ help? Well, I want to create a short record of how I spend today, day 2 of my quarantine.

My first goal is to create _vectors_ describing things I plan to do today. Let's start with some of these. To get up to speed, type the following into the _R_ console, at the `>` prompt

```{r, eval = FALSE}
1 + 2
```

Press the carriage return and remind yourself that _R_ is a calculator, and knows how to work with numbers!

Now type an activity in your day, for instance I often start with

```{r, eval = FALSE}
"check e-mail"
```

Now try assigning that to a variable, and displaying the variable, e.g.,

```{r}
activity <- "check e-mail"
activity
```

OK, likely you have several activities scheduled. Create a _vector_ of a few of
these by `c`oncatenating individual values

```{r}
c("check e-mail", "breakfast", "conference call", "webinar", "walk")
```

Assign these to a variable

```{r}
activity <- c("check e-mail", "breakfast", "conference call", "webinar", "walk")
activity
```

Create another vector, but this time the vector should contain the minutes spent on each activity

```{r}
minutes <- c(20, 30, 60, 60, 60)
minutes
```

So I spent 20 minutes checking email, 30 minutes having breakfast and things like that, I was in a conference call for 60 minutes, and then attended a webinar where I learned new stuff for another 60 minutes. Finally I went for a walk to clear my head and remember why I'm doing things.

Apply some basic functions to the variables, e.g., use `length()` to demonstrate that you for each `activity` you have recorded the `minutes`.

```{r}
length(activity)
length(minutes)
```

Use `tail()` to select the last two activities (or `head()` to select the first two...)

```{r}
tail(activity, 2)
tail(minutes, 2)
```

_R_ has other types of vectors. Create a logical vector that indicates whether each activity was 'work' activity' or something you did for your own survival. We'll say that checking email is a work-related activity!

```{r}
is_work <- c(TRUE, FALSE, TRUE, TRUE, FALSE)
is_work
```

## Day 3: `factor()` and `Date()` objects

Yesterday we learned about `character`, `numeric`, and `logical` vectors in _R_ (you may need to revisit previous notes and re-create these variables)

```{r}
activity
minutes
is_work
```

Today we will learn about slightly more complicated vectors.

We created the logical vector `is_work` to classify each `activity` as either work-related or not. What if we had several different categories? For instance, we might want to classify the activities into categories inspired by astronaut Kelly's guidance. Categories might include: `connect` with others; go outside and `exercise`; `consult` experts; get a `hobby`; and (my own category, I guess) perform `essential` functions like eating and sleeping. So the values of `activity` could be classified as

```{r}
classification <-
    c("connect", "essential", "connect", "consult", "exercise")
```

I want to emphasize a difference between the `activity` and `classification` variables. I want `activity` to be a character vector that could contain any description of an activity. But I want `classification` to be terms only from a limited set of possibilities. In _R_, I want `classification` to be a special type of vector called a `factor`, with the _values_ of the vector restricted to a set of possible _levels_ that I define. I create a factor by enumerating the possible _levels_ that the factor can take on

```{r}
levels <- c("connect", "exercise", "consult", "hobby", "essential")
```

And then tell _R_ that the vector `classification` should be a factor with values taken from a particular set of levels

```{r}
classification <- factor(
    c("connect", "essential", "connect", "consult", "exercise"),
    levels = levels
)
classification
```

Notice that activity (a character vector) displays differently from classification (a factor)

```{r}
activity
classification
```

Also, some of the levels (e.g., `hobby`) have not been part of our schedule yet, but the factor still 'knows' about the level.

Notice also what happens when I try to use a value (`disconnect`) that is not a level of a factor

```{r}
factor(c("connect", "disconnect"), levels = levels)
```

The value with the unknown level is displayed as `NA`, for 'not known'. `NA` values can be present in any vector, e.g.,

```{r}
c(1, 2, NA, 4)
c("walk", "talk", NA)
c(NA, TRUE, FALSE, TRUE, TRUE)
```

This serves as an indication that the value is simply not available. Use `NA` rather than adopting some special code (e.g., '-99') to indicate when a value is not available.

One other type of vector we will work a lot with are dates. All of my activities are for today, so I'll start with a character vector with the same length as my activity vector, each indicating the date in a consistent month-day-year format

```{r}
dates <- c("04-14-2020", "04-14-2020", "04-14-2020", "04-14-2020", "04-14-2020")
dates
```

Incidentally, I could do this more efficiently using the `rep`licate function

```{r}
rep("04-14-2020", 5)
```

And even better use `length()` to know for sure how many times I should replicate the character vector

```{r}
rep("04-14-2020", length(activity))
```

`dates` is a character vector, but it has specially meaning as a calendar date, _R_ has a `Date` _class_ that knows how to work with dates, for instance to calculate the number of days between two dates. We will _coerce_ `date` to an object of class `Date` using a function `as.Date`. Here's our first attempt...

```{r, eval = FALSE}
as.Date(dates)
```
... but this results in an error:

```
Error in charToDate(x) :
  character string is not in a standard unambiguous format
```

_R_ doesn't know the format (month-day-year) of the dates we provide. The solution is to add a second argument to `as.Date()`. The second argument is a character vector that describes the date format. The format we use is `"%m-%d-%Y"`, which says that we provide the `%m`onth first, then a hyphen, then the `%d`ay, another hyphen, and finally the four-digit `%Y`ear.

```{r}
as.Date(dates, format = "%m-%d-%Y")
```

Notice that the format has been standardized to year-month-day. Also notice that although the original value of `date` and the return from `as.Data()` look the same, they are actually of different _class_.

```{r}
class(date)
class(as.Date(dates, format = "%m-%d-%Y"))
```

_R_ will use the information about class to enable specialized calculation on dates, e.g., to sort them or to determine the number of days between different dates. So here's our `date` vector as a `Date` object.

```{r}
dates <- rep("04-14-2020", length(activity))
date <- as.Date(dates, format = "%m-%d-%Y")
date
```

OK, time for a walk! See you tomorrow!

## Day 4: Working with variables

Remember that _R_ can act as a simple calculator, and that one can create new variables by assignment

```{r}
x <- 1
x + 1
y <- x + 1
y
```

Let's apply these ideaas to our `minutes` vector from earlier in the week.

```{r}
minutes <- c(20, 30, 60, 60, 60)
```

We can perform basic arithmetic on vectors. Suppose we wanted to increase the time of each activity by 5 minutes

```{r}
minutes + 5
```

or to increase the time of the first two activities by 5 minutes, and the last three activities by 10 minutes

```{r}
minutes + c(5, 5, 10, 10, 10)
```

_R_ has a very large number of _functions_ that can be used on vectors. For instance, the average time spent on activities is

```{r}
mean(minutes)
```

while the total amount of time is

```{r}
sum(minutes)
```

Explore other typical mathematical transformations, e.g., `log()`, `log10()`, `sqrt()` (square root), ... Check out the help pages for each, e.g., `?log`.

Explore the consequences of `NA` in a vector for functions like `mean()` and `sum()`.

```{r}
x <- c(1, 2, NA, 3)
mean(x)
```

_R_ is saying that, since there is an unknown (`NA`) value in the vector, it cannot possibly know what the mean is! Tell _R_ to remove the missing values before performing the calculation by adding the `na.rm = TRUE` argument

```{r}
mean(x, na.rm = TRUE)
```

Check out the help page `?mean` to find a description of the `na.rm` and other arguments.

It's possible to perform logical operations on vectors, e.g., to ask which activities lasted 60 minutes or more

```{r}
minutes >= 60
```

Here's our `activity` vector

```{r}
activity <- c("check e-mail", "breakfast", "conference call", "webinar", "walk")
```

The elements of this vector are numbered from 1 to 5. We can create a new vector that is a subset of this vector using `[` and an integer index, e.g., the second activity is

```{r}
activity[2]
```

The index can actually be a vector, so we could choose the second and fourth activity as

```{r}
index <- c(2, 4)
activity[index]
```

In fact, we can use logical vectors for subsetting. Consider the activities that take sixty minutes or longer:

```{r}
index <- minutes >= 60
activity[index]
```

Note that it doesn't make sense to take the `mean()` of a character vector like `activity`, and _R_ signals a warning and returns `NA`

```{r}
mean(activity)
```

Nonetheless, there are many functions that _do_ work on character vectors, e.g., the number of letters in each element `nchar()`, or transformation to upper-case

```{r}
nchar(activity)
toupper(activity)
```

## Day 5 (Friday) Zoom check-in

### Review and trouble shoot (40 minutes)

### Weekend activities (20 minutes)

Writing _R_ scripts

Saving data

#### R Scripts {-}

## Day 6: _R_ scripts

Some of you may have already started saving your R commands as script files. As the material gets more complicated (and more interesting) everyone will want to start doing this. Here is an example to get you started:

- In RStudio, click "File --> New File --> R Script" to create a new script file and open it in the editor

```{r echo = FALSE, fig.align="center", out.width="60%"}
knitr::include_graphics('images/rstudio_new_rscript_file.png')
```

- By convention, R scripts have a .R exstension (e.g. my_script.R)
  - In RStudio, click into your untitled script and click "File --> Save"
  - Name your file something fun like `my_first_script.R` and save it

- Use the `#` character for comments. Enter the following into your R Script file:

```{r}
## This is my first R script
```

- Enter each command on a separate line. It's also possible to enter multiple (short!) commands on a single line, separated by a semi-colon `;`

```{r results="hide"}
x = "Hello world!"
y = 'Today is'; d = format(Sys.Date(), "%b %d, %Y")
cat(x, y, d)
```

- Use the "Run" button in RStudio to run the highlighted portion of an R script file. Try this on your simple R Script.

```{r echo = FALSE, fig.align="center", out.width="80%"}
knitr::include_graphics('images/rstudio_run_button.png')
```

```{r}
x = "Hello world!"; y = 'Today is'; d = format(Sys.Date(),"%b %d, %Y")
cat(x, y, d, "\n")
```

- Alternatively, use "Run --> Run All" to run an entire script file.

For today's exercise, create a script file that summarizes your quarantine activities over several days. Use comments, white space (blank lines and spaces), and variable names to summarize each day. Here's what I've got...

```{r}
## 'classification' factor levels
levels <- c("connect", "exercise", "consult", "hobby", "essential")

## Quarantine log, day 1

activity_day_1 <-
    c("check e-mail", "breakfast", "conference call", "webinar", "walk")
minutes_day_2 <- c(20, 30, 60, 60, 60)
is_work_day_2 <- c(TRUE, FALSE, TRUE, TRUE, FALSE)
classification_day_2 <- factor(
    c("connect", "essential", "connect", "consult", "exercise"),
    levels = levels
)
date_day_1 <- as.Date(rep("04-14-2020", length(activity_day_1)), "%m-%d-%Y")

## Quarantine log, day 2

activity_day_2 <-
    c("check e-mail", "breakfast", "conference call", "webinar", "read a book")
minutes_day_2 <- c(20, 30, 60, 60, 60)
is_work_day_2 <- c(TRUE, FALSE, TRUE, TRUE, FALSE)
classification_day_2 <- factor(
    c("connect", "essential", "connect", "consult", "hobby"),
    levels = levels
)
date_day_2 <- as.Date(rep("04-15-2020", length(activity_day_2)), "%m-%d-%Y")

## Quarantine log, day 3

activity_day_3 <-
    c("check e-mail", "breakfast", "webinar", "read a book")
minutes_day_3 <- c(20, 30, 60, 60)
is_work_day_3 <- c(TRUE, FALSE, TRUE, FALSE)
classification_day_3 <- factor(
    c("connect", "essential", "connect", "consult", "hobby"),
    levels = levels
)
date_day_3 <- as.Date(rep("04-16-2020", length(activity_day_3)), "%m-%d-%Y")
```

Try `c`oncatenating these values, e.g.,

```{r}
activity <- c(activity_day_1, activity_day_2, activity_day_3)
activity
```

Save your script, quit _R_ and _RStudio_, and restart _R_. Re-open and run the script to re-do your original work.

Think about how this makes your work _reproducible_ from one day to the next, and how making your scientific work reproducible would be advantageous.

## Day 7: Saving data

`writeLines()` / `readLines()`

`saveRDS()` / `loadRDS()`

Sneak peak: `data.frame()` / `write.csv()` / `read.csv()`
